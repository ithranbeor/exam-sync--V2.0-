import{a as As,A as _s,u as Ot,r as t,j as e,F as Qt,b as Ut,I as Rs,y as a,M as is,c as bt,L as ft,d as zt,e as Jt,S as lt,f as Ms,g as bs,h as js,i as rs,k as Es,l as ys,C as qt,m as Ts,n as Ps,o as Ls,E as Fs,p as Bs,T as Us,W as cs,B as Kt,P as Os,q as zs,s as Ys,t as qs,v as Hs,w as Ws,x as Gs,z as tt,D as It,G as Vs,H as Js,J as Ks,K as Ct,N as Zs,O as Xs,Q as Qs,R as ea,U as Rt,V as es,X as ta,Y as Ss,Z as vs,_ as ws,$ as sa,a0 as Ht,a1 as ds,a2 as Zt,a3 as as,a4 as us,a5 as os,a6 as Wt,a7 as aa,a8 as Lt,a9 as Ft,aa as Et,ab as At,ac as oa,ad as ms,ae as la,af as na,ag as Bt,ah as ra,ai as ia,aj as ca,ak as da,al as ua,am as ma,an as ha,ao as pa,ap as ga,aq as Gt,ar as xa,as as fa,at as _a}from"./vendor-vLw90_9u.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const R of document.querySelectorAll('link[rel="modulepreload"]'))F(R);new MutationObserver(R=>{for(const C of R)if(C.type==="childList")for(const O of C.addedNodes)O.tagName==="LINK"&&O.rel==="modulepreload"&&F(O)}).observe(document,{childList:!0,subtree:!0});function i(R){const C={};return R.integrity&&(C.integrity=R.integrity),R.referrerPolicy&&(C.referrerPolicy=R.referrerPolicy),R.crossOrigin==="use-credentials"?C.credentials="include":R.crossOrigin==="anonymous"?C.credentials="omit":C.credentials="same-origin",C}function F(R){if(R.ep)return;R.ep=!0;const C=i(R);fetch(R.href,C)}})();const ss={},ba=(ss==null?void 0:ss.VITE_API_BASE_URL)||"http://localhost:8000/api",g=As.create({baseURL:ba,headers:new _s({"Content-Type":"application/json"})});g.interceptors.request.use(o=>{const l=localStorage.getItem("accessToken");return o.headers||(o.headers=new _s),l&&o.headers.set("Authorization",`Token ${l}`),o},o=>Promise.reject(o));const ja=()=>{const o=new Date().getHours();return o>=22||o<4?"Late Night Access":o<12?"Rise and Shine":o<18?"Midday Welcome":"Evening Welcome"},ya={proctor:"/faculty-dashboard",faculty:"/faculty-dashboard",scheduler:"/faculty-dashboard","bayanihan leader":"/faculty-dashboard",dean:"/faculty-dashboard",admin:"/admin-dashboard"},Sa=()=>{const o=Ot(),[l,i]=t.useState(!0),[F,R]=t.useState({id:"",password:""}),[C,O]=t.useState(!1),[ee,P]=t.useState(""),[ie,ne]=t.useState(!1),ce=t.useRef(!1),[,H]=t.useState(!1),Q=t.useMemo(()=>ja(),[]),pe=t.useCallback(n=>{const{id:f,value:r}=n.target;R(b=>({...b,[f]:r}))},[]),D=t.useCallback(()=>{ce.current=!ce.current,H(n=>!n)},[]),te=t.useCallback(()=>{i(n=>!n),P(""),R({id:"",password:""})},[]),ge=t.useCallback(async n=>{var b,L,W,q;n.preventDefault(),P(""),ne(!0);const f=new AbortController,r="/login/";try{const{data:E}=await g.post(r,{user_id:F.id,password:F.password},{signal:f.signal});if(!(E!=null&&E.token)){P("Invalid credentials.");return}const se=((L=(b=E.roles)==null?void 0:b.filter(c=>{var U;return((U=c.status)==null?void 0:U.toLowerCase())==="active"}))==null?void 0:L.map(c=>{var U;return(U=c.role_name)==null?void 0:U.toLowerCase()}))||[];if(se.length===0){P("You do not have any active roles.");return}let k=se[0];if(l)k=se.includes("admin")?"admin":se[0];else{if(!se.includes("admin")){P("You must have an 'admin' role to log in as Admin.");return}k="admin"}const de=ya[k];if((!de||!l&&de!=="/admin-dashboard"||l&&de==="/admin-dashboard"&&k!=="admin")&&!de){P(`No dashboard found for role: ${k}`);return}const $={user_id:E.user_id,email_address:E.email,first_name:E.first_name,last_name:E.last_name,token:E.token,roles:E.roles};(C?localStorage:sessionStorage).setItem("user",JSON.stringify($)),o(de)}catch(E){console.error("Login error:",E);const se=l?"Employee":"Admin";P(((q=(W=E.response)==null?void 0:W.data)==null?void 0:q.message)||`Invalid ${se} ID or password.`)}finally{ne(!1)}return()=>f.abort()},[F,C,o,l]),w=l?"Login as Faculty":"Login as Admin",M=l?"Employee ID":"Admin ID";return e.jsxs("div",{className:"login-container",children:[e.jsx("div",{className:"background-gradient",children:e.jsx("div",{className:"greeting-text",children:e.jsxs("p",{children:[Q,"!"]})})}),e.jsx("div",{className:"logo-section",children:e.jsxs("div",{className:"e-graphic-logo",children:[e.jsx("img",{src:"../../static/logo/Exam.png",alt:"ExamSync Logo",className:"examsync-logo"}),e.jsx("p",{className:"logo-text",children:"ExamSync"})]})}),e.jsxs("form",{className:"login-form-card",onSubmit:ge,children:[e.jsx("h2",{children:w}),e.jsxs("div",{className:"input-field",children:[e.jsx("input",{type:"text",id:"id",placeholder:"",value:F.id,onChange:pe,required:!0,autoComplete:"username"}),e.jsx("label",{htmlFor:"id",children:M})]}),e.jsxs("div",{className:"input-field password-field",children:[e.jsx("input",{type:ce.current?"text":"password",id:"password",placeholder:"",value:F.password,onChange:pe,required:!0,autoComplete:"current-password"}),e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsx("span",{className:"toggle-password",onClick:D,children:ce.current?e.jsx(Qt,{style:{color:"white"}}):e.jsx(Ut,{style:{color:"white"}})})]}),e.jsxs("div",{className:"form-actions",children:[e.jsxs("label",{className:"modern-checkbox-container",children:["Remember me",e.jsx("input",{type:"checkbox",checked:C,onChange:n=>O(n.target.checked)}),e.jsx("span",{className:"checkmark"})]}),e.jsx("span",{className:`error-text ${ee?"":"hidden"}`,children:ee||"‎"})]}),e.jsx("button",{type:"submit",className:"submit-button",disabled:ie,"aria-label":`Log in as ${l?"Faculty":"Admin"}`,children:ie?e.jsx("span",{className:"spinner"}):"Login"})]}),e.jsx("div",{className:"admin-toggle-button",onClick:te,children:e.jsx(Rs,{size:24})})]})},va=()=>{const o=new Date().getHours();return o<12?"Good morning":o<18?"Good afternoon":"Good evening"},wa=()=>{const o=Ot(),[l,i]=t.useState({id:"",password:""}),[F,R]=t.useState(!1),[C,O]=t.useState(!1),[ee,P]=t.useState(""),ie=t.useRef(!1),[,ne]=t.useState(!1),ce=t.useCallback(pe=>{const{id:D,value:te}=pe.target;i(ge=>({...ge,[D]:te}))},[]),H=t.useCallback(()=>{ie.current=!ie.current,ne(pe=>!pe)},[]),Q=t.useCallback(async pe=>{var te,ge;pe.preventDefault(),P(""),R(!0);const D=new AbortController;try{const{data:w}=await g.post("/login/",{user_id:l.id,password:l.password},{signal:D.signal});if(!(w!=null&&w.token)){P("Invalid user ID or password.");return}if(!w.roles.filter(f=>{var r;return((r=f.status)==null?void 0:r.toLowerCase())==="active"}).map(f=>{var r;return(r=f.role_name)==null?void 0:r.toLowerCase()}).includes("admin")){P("Access denied. Only admins can log in.");return}const n={user_id:w.user_id,email_address:w.email,first_name:w.first_name,last_name:w.last_name,token:w.token,roles:w.roles};(C?localStorage:sessionStorage).setItem("user",JSON.stringify(n)),o("/admin-dashboard")}catch(w){console.error("Unexpected error:",w),P(((ge=(te=w.response)==null?void 0:te.data)==null?void 0:ge.message)||"Invalid user ID or password.")}finally{R(!1)}return()=>D.abort()},[l,C,o]);return e.jsxs("div",{className:"main-container",children:[e.jsx("div",{className:"left-panel",children:e.jsx("div",{className:"e-graphic"})}),e.jsxs("div",{className:"right-panel",children:[e.jsxs("div",{className:"header-section",children:[e.jsxs("div",{className:"greeting",children:[e.jsx("p",{children:"Hello Admin!"}),e.jsx("p",{className:"good-morning",children:va()})]}),e.jsx("div",{className:"logo",children:e.jsx("img",{src:"../../static/logo/Exam.png",alt:"ExamSync Logo"})})]}),e.jsxs("div",{className:"login-section",children:[e.jsxs("h2",{children:["Login as ",e.jsx("span",{className:"faculty-text",children:"Admin"})]}),e.jsxs("form",{className:"login-form",onSubmit:Q,children:[e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:"id",children:"Admin ID"}),e.jsx("input",{type:"text",id:"id",placeholder:"Admin ID",value:l.id,onChange:ce,className:"login-input",required:!0})]}),e.jsxs("div",{className:"input-group password-group",children:[e.jsx("label",{htmlFor:"password",children:"Password"}),e.jsxs("div",{className:"password-wrapper",children:[e.jsx("input",{type:ie.current?"text":"password",id:"password",placeholder:"Password",value:l.password,onChange:ce,className:"login-input",required:!0}),e.jsx("span",{className:"toggle-password",onClick:H,children:ie.current?e.jsx(Qt,{}):e.jsx(Ut,{})})]})]}),e.jsx("div",{className:"form-error-row",children:e.jsx("span",{className:`error-text ${ee?"":"hidden"}`,children:ee||"‎"})}),e.jsxs("div",{className:"remember-me-container",children:[e.jsx("input",{type:"checkbox",id:"rememberMe",checked:C,onChange:pe=>O(pe.target.checked)}),e.jsx("label",{htmlFor:"rememberMe",children:"Remember me"})]}),e.jsx("button",{type:"submit",className:"login-button",disabled:F,children:F?e.jsx("span",{className:"spinner"}):"Login"})]})]}),e.jsx("div",{className:"admin-login-link",children:e.jsx("button",{type:"button",className:"admin-login-btn",onClick:()=>o("/"),children:"Sign in as Faculty"})})]})]})},Ns=({user:o})=>{const[l,i]=t.useState(null),[F,R]=t.useState(null),[C,O]=t.useState(!1),[ee,P]=t.useState(null),[ie,ne]=t.useState([]),[ce,H]=t.useState(!0),[Q,pe]=t.useState(!1),D=t.useCallback(async()=>{if(o!=null&&o.user_id){H(!0);try{const{data:r}=await g.get(`/users/${o.user_id}/`),b={user_id:r.user_id,first_name:r.first_name||"",middle_name:r.middle_name||"",last_name:r.last_name||"",email_address:r.email_address||o.email_address,contact_number:r.contact_number||"",avatar_url:r.avatar_url||null};i(b),R(b),P(b.avatar_url)}catch(r){console.error("Error fetching profile:",r),a.error("Failed to load profile.")}finally{H(!1)}}},[o]),te=t.useCallback(async()=>{if(o!=null&&o.user_id)try{const{data:r}=await g.get(`/user-roles/${o.user_id}/roles/`),b=r.map(L=>({user_role_id:L.user_role_id,role_name:L.role_name,college:L.college??null,department:L.department??null,status:L.status??null}));ne(b)}catch(r){console.error("Error fetching roles:",r),a.error("Failed to load roles.")}},[o]);t.useEffect(()=>{D(),te()},[D,te]);const ge=r=>{l&&i({...l,[r.target.name]:r.target.value})},w=async r=>{var L;const b=(L=r.target.files)==null?void 0:L[0];if(!(!b||!(o!=null&&o.user_id)))try{const W=new FormData;W.append("avatar",b);const q=await g.post(`/users/${o.user_id}/avatar/`,W,{headers:{"Content-Type":"multipart/form-data"}});i(E=>E&&{...E,avatar_url:q.data.avatar_url}),P(q.data.avatar_url),a.success("Profile picture updated!")}catch(W){console.error("Avatar upload failed:",W),a.error("Avatar upload failed.")}},M=async()=>{if(o!=null&&o.user_id)try{await g.delete(`/users/${o.user_id}/avatar/`),i(r=>r&&{...r,avatar_url:null}),P(null),a.success("Avatar deleted.")}catch(r){console.error("Error deleting avatar:",r),a.error("Failed to delete avatar.")}},n=async()=>{if(l){H(!0);try{const r={first_name:l.first_name,middle_name:l.middle_name,last_name:l.last_name,contact_number:l.contact_number,email_address:l.email_address},{data:b}=await g.patch(`/users/${l.user_id}/`,r);i(b),R(b),a.success("Profile updated successfully!"),O(!1)}catch(r){console.error("Error updating profile:",r),a.error("Failed to update profile.")}finally{H(!1)}}},f=async()=>{if(!(l!=null&&l.email_address)){a.error("Missing email address.");return}pe(!0);try{await g.post("/auth/request-password-change/",{email:l.email_address}),a.success("Password reset email sent! Please check your inbox.")}catch(r){console.error("Password change request error:",r),a.error("Failed to send password reset email.")}finally{pe(!1)}};return ce||!l?e.jsx("div",{className:"profile-container",children:e.jsx("p",{children:"Loading profile..."})}):e.jsxs("div",{className:"profile-container",children:[e.jsx("div",{className:"profile-header-title",children:"Profile Details"}),e.jsxs("div",{className:"profile-section profile-info-card",children:[e.jsxs("div",{className:"profile-avatar-wrapper",children:[e.jsx("img",{src:ee||"../../static/Images/default-pp.jpg",alt:"Profile Avatar",className:"profile-avatar"}),C&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{htmlFor:"avatar-upload",className:"profile-avatar-edit-icon",children:[e.jsx(is,{size:24}),e.jsx("input",{id:"avatar-upload",type:"file",accept:"image/*",onChange:w,hidden:!0})]}),ee&&e.jsx("button",{type:"button",className:"delete-avatar-btn",onClick:M,children:e.jsx(bt,{})})]})]}),e.jsxs("div",{className:"profile-name-details",children:[e.jsxs("div",{className:"profile-full-name",children:[l.first_name," ",l.middle_name," ",l.last_name]}),e.jsx("div",{className:"profile-user-type",children:ie.length?ie.map(r=>e.jsxs("div",{children:[e.jsxs("strong",{children:[r.role_name," - "]}),r.college&&e.jsx("span",{className:"info-badge college-badge",children:r.college}),r.department&&e.jsx("span",{className:"info-badge dept-badge",children:r.department})]},r.user_role_id)):e.jsx("span",{children:"No roles assigned"})})]})]}),e.jsxs("div",{className:"profile-section personal-details-card",children:[e.jsxs("div",{className:"personal-details-header",children:[e.jsx("h3",{children:"Personal Details"}),!C&&e.jsx("button",{type:"button",className:"edit-details-btn",onClick:()=>O(!0),disabled:ce,children:e.jsx(is,{})})]}),e.jsxs("div",{className:"personal-details-grid",children:[e.jsxs("div",{className:"profile-field-group",children:[e.jsx("label",{children:"User ID"}),e.jsx("input",{name:"user_id",value:l.user_id,disabled:!0})]}),e.jsxs("div",{className:"profile-field-group",children:[e.jsx("label",{children:"First Name"}),e.jsx("input",{name:"first_name",value:l.first_name,onChange:ge,disabled:!C})]}),e.jsxs("div",{className:"profile-field-group",children:[e.jsx("label",{children:"Middle Name"}),e.jsx("input",{name:"middle_name",value:l.middle_name,onChange:ge,disabled:!C})]}),e.jsxs("div",{className:"profile-field-group",children:[e.jsx("label",{children:"Last Name"}),e.jsx("input",{name:"last_name",value:l.last_name,onChange:ge,disabled:!C})]}),e.jsxs("div",{className:"profile-field-group",children:[e.jsx("label",{children:"Contact No."}),e.jsx("input",{name:"contact_number",value:l.contact_number,onChange:ge,disabled:!C})]}),e.jsxs("div",{className:"profile-field-group span-2-columns",children:[e.jsx("label",{children:"Email Address"}),e.jsx("input",{name:"email_address",value:l.email_address,onChange:ge,disabled:!C})]})]}),C&&e.jsxs("div",{className:"personal-details-actions",children:[e.jsx("button",{type:"button",className:"btn cancel-personal-details",onClick:()=>{O(!1),i(F)},children:"Cancel"}),e.jsx("button",{type:"button",className:"btn save-changes-global",onClick:n,children:"Save"})]})]}),e.jsx("div",{className:"profile-section password-change-card",children:e.jsx("button",{type:"button",className:"btn change-password-btn",onClick:f,disabled:Q,children:Q?"Sending...":"Change Password"})}),e.jsx(ft,{position:"top-center",autoClose:3e3})]})},ls=()=>{const[o,l]=t.useState(new Date),[i,F]=t.useState([]),[R,C]=t.useState({}),[O,ee]=t.useState(!1),[P,ie]=t.useState(null),[ne,ce]=t.useState(!1),[H,Q]=t.useState({academicYear:"",examCategory:"",collegeName:"",termId:""}),pe=new Date,D=o.getFullYear(),te=o.getMonth();t.useEffect(()=>{(async()=>{try{const U=JSON.parse(localStorage.getItem("user")||sessionStorage.getItem("user")||"{}");if(!(U!=null&&U.user_id))return;const u=U.user_id,{data:V}=await g.get("/tbl_user_role",{params:{user_id:u}});console.log("User roles fetched:",V);const J=V.find(T=>T.role===3||T.role_id===3);if(!J)return;ee(!0);let ue=J.college??J.college_id??null;if(!ue){const{data:T}=await g.get(`/tbl_users/${u}`);ue=(T==null?void 0:T.college_id)??null}ue?ie(ue):console.warn("Scheduler college not found in either role or user record")}catch(U){console.error("Error fetching role/college:",U)}})()},[]),t.useEffect(()=>{const c=async()=>{try{const{data:u}=await g.get("/tbl_examperiod");u&&F(u);const{data:V}=await g.get("/tbl_term");if(V){const J={};V.forEach(ue=>J[ue.term_id]=ue.term_name),C(J)}}catch(u){console.error("Error fetching exam periods or terms:",u)}};c();const U=setInterval(c,2e3);return()=>clearInterval(U)},[]);const ge=async c=>{if(!(!O||!ne))try{const U=T=>`${T.getFullYear()}-${String(T.getMonth()+1).padStart(2,"0")}-${String(T.getDate()).padStart(2,"0")}`,u=i.filter(T=>new Date(T.start_date).toDateString()===c.toDateString());console.log("Existing periods on this date:",u),console.log("My scheduler college ID:",P);const V=Array.from(new Set(u.map(T=>T.college_id).filter(T=>T!=null)));console.log("Unique college IDs assigned:",V);const J=V.includes(P);if(console.log("Is my college assigned?",J),J){console.log("Removing my college ID:",P);const T={updates:[{start_date:U(c),college_name:null,college_to_remove:P}]};await g.put("/tbl_examperiod/bulk_update/",T)}else{const T=V.length;if(console.log("Other colleges count:",T),T>=2){alert("Cannot assign more than 2 colleges on the same day.");return}const N={updates:[{start_date:U(c),college_name:P}]};console.log("Adding my college ID:",P),await g.put("/tbl_examperiod/bulk_update/",N)}const{data:ue}=await g.get("/tbl_examperiod");ue&&F(ue)}catch(U){console.error("Error updating exam period:",U),alert("An error occurred. Check console for details.")}},w=()=>{ce(!ne)},M=c=>{const U=parseInt(c.target.value),u=new Date(o);u.setMonth(U),l(u)},n=c=>{const U=parseInt(c.target.value),u=new Date(o);u.setFullYear(U),l(u)},f=()=>{const c=new Date(o);c.setMonth(c.getMonth()-1),l(c)},r=()=>{const c=new Date(o);c.setMonth(c.getMonth()+1),l(c)},b=()=>{l(new Date)},L=(c,U)=>new Date(U,c+1,0).getDate(),W=(c,U)=>new Date(U,c,1).getDay(),q=L(te,D),E=W(te,D),se=[];for(let c=0;c<E;c++)se.push(e.jsx("div",{className:"calendar-cell empty"},`empty-${c}`));for(let c=1;c<=q;c++){const U=new Date(D,te,c),u=i.filter(ue=>{if(H.academicYear&&ue.academic_year!==H.academicYear||H.examCategory&&ue.exam_category!==H.examCategory||H.collegeName&&ue.college_name!==H.collegeName||H.termId&&String(ue.term_id)!==H.termId)return!1;const T=new Date(ue.start_date);return U.toDateString()===T.toDateString()});let V="calendar-cell";ne&&O&&(V+=" editable"),U.getFullYear()===pe.getFullYear()&&U.getMonth()===pe.getMonth()&&U.getDate()===pe.getDate()&&(V+=" today"),se.push(e.jsxs("div",{className:V,onClick:()=>ge(U),style:{cursor:ne&&O?"pointer":"default"},children:[e.jsx("span",{className:"day-number",children:c}),u.length>0&&e.jsxs("div",{className:"event-details",children:[Array.from(new Set(u.map(ue=>ue.college_id||""))).filter(ue=>ue).map((ue,T)=>e.jsx("div",{className:`college-badge ${ue.toLowerCase()}`,children:ue},T)),e.jsx("div",{className:"semester",children:R[String(u[0].term_id)]||"Unknown Term"}),e.jsx("div",{className:"semester",children:u[0].academic_year}),e.jsx("div",{className:"exam",children:u[0].exam_category})]})]},`day-${c}`))}const k=["CSM","CITC","COT","CEA","CSTE","SHS"],de=["January","February","March","April","May","June","July","August","September","October","November","December"],$=[];for(let c=2020;c<=2030;c++)$.push(c);return e.jsxs("div",{className:"dashboard",children:[e.jsxs("div",{className:"dashboard-header",children:[e.jsx("div",{className:"left-date-label",children:e.jsxs("h2",{children:[de[te]," ",D]})}),e.jsxs("div",{className:"filters",children:[e.jsx("select",{className:"dropdown",value:te,onChange:M,children:de.map((c,U)=>e.jsx("option",{value:U,children:c},U))}),e.jsx("select",{className:"dropdown",value:D,onChange:n,children:$.map(c=>e.jsx("option",{value:c,children:c},c))}),e.jsxs("select",{className:"dropdown",value:H.termId,onChange:c=>Q({...H,termId:c.target.value}),children:[e.jsx("option",{value:"",children:"All Semesters"}),Object.entries(R).map(([c,U])=>e.jsx("option",{value:c,children:U},c))]}),e.jsxs("select",{className:"dropdown",value:H.examCategory,onChange:c=>Q({...H,examCategory:c.target.value}),children:[e.jsx("option",{value:"",children:"All Categories"}),e.jsx("option",{value:"Preliminary",children:"Preliminary"}),e.jsx("option",{value:"Midterm",children:"Midterm"}),e.jsx("option",{value:"Prefinal",children:"Prefinal"}),e.jsx("option",{value:"Final",children:"Final"})]}),O?e.jsxs("span",{className:"scheduler-college-label",children:["College: ",e.jsx("strong",{children:P})]}):e.jsxs("select",{className:"dropdown",value:H.collegeName,onChange:c=>Q({...H,collegeName:c.target.value}),children:[e.jsx("option",{value:"",children:"All Colleges"}),k.map(c=>e.jsx("option",{value:c,children:c},c))]}),O&&e.jsx("div",{className:"save-section",children:e.jsx("button",{type:"button",className:`now-button ${ne?"active":""}`,onClick:w,children:ne?"Done Editing":"Edit"})}),e.jsx("button",{type:"button",className:"now-button",onClick:b,children:"Now"})]})]}),e.jsx("div",{className:"calendar-weekdays",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map((c,U)=>e.jsx("div",{className:"weekday",children:c},U))}),e.jsx("div",{className:"calendar-grid",children:se}),e.jsxs("div",{className:"bottom-navigation",children:[e.jsx("button",{type:"button",className:"nav-arrow",onClick:f,children:e.jsx(zt,{})}),e.jsx("button",{type:"button",className:"nav-arrow",onClick:r,children:e.jsx(Jt,{})})]}),e.jsx("div",{className:"legend",children:k.map((c,U)=>e.jsx("div",{className:`legend-item ${c.toLowerCase()}`,children:e.jsx("div",{className:"legend-colored-box-with-text",children:c})},U))})]})},Na={Morning:"7 AM - 1 PM (Morning)",Afternoon:"1 PM - 6 PM (Afternoon)",Evening:"6 PM - 9 PM (Evening)"},Ca=({user:o})=>{const[l,i]=t.useState([]),[F,R]=t.useState([]),[C,O]=t.useState(""),[ee,P]=t.useState(""),[ie,ne]=t.useState([]),[ce,H]=t.useState({}),[Q,pe]=t.useState("available"),[D,te]=t.useState(""),[ge,w]=t.useState("unavailable"),[M,n]=t.useState(""),[f,r]=t.useState(!1),[b,L]=t.useState(new Date),[W,q]=t.useState([]),[E,se]=t.useState(null),[k,de]=t.useState(!1),[$,c]=t.useState(!1),[U,u]=t.useState([]),[V,J]=t.useState(!1),[ue,T]=t.useState(!1),[N,_e]=t.useState(!1),K=new Date;t.useEffect(()=>{(async()=>{if(o!=null&&o.user_id){T(!0);try{const{data:h}=await g.get("/tbl_availability/",{params:{user_id:o.user_id}});if(Array.isArray(h)){const A=h.map(p=>({days:Array.isArray(p.days)?p.days:[],time_slots:Array.isArray(p.time_slots)?p.time_slots:[],status:p.status,remarks:p.remarks??void 0}));u(A);const he={};A.forEach(p=>{p.days.forEach(B=>{he[B]||(he[B]=[]),p.time_slots.forEach(re=>{he[B].includes(re)||he[B].push(re)})})}),H(he),ne(Object.keys(he))}else console.error("Unexpected API response format:",h),u([]),ne([]),H({})}catch(h){console.error("Error fetching availability:",h)}finally{T(!1)}}})()},[o.user_id]),t.useEffect(()=>{const j=new Date;j.setHours(12,0,0,0),L(new Date(j.getFullYear(),j.getMonth(),1))},[]),t.useEffect(()=>{(async()=>{_e(!0);try{if(!(o!=null&&o.user_id))return;const{data:h}=await g.get("/tbl_user_role",{params:{user_id:o.user_id}});if(console.log("User roles fetched:",h),!Array.isArray(h)||h.length===0){console.error("No roles found for user"),se(null),q([]);return}const A=h.find(Z=>Z.role===5||Z.role_id===5);if(!A){console.warn("User is not a proctor"),se(null),q([]);return}console.log("Proctor role found:",A);let he=A.college??A.college_id??null;if(!he){const{data:Z}=await g.get(`/tbl_users/${o.user_id}`);he=(Z==null?void 0:Z.college_id)??null}if(!he){console.warn("College not found for proctor"),se(null),q([]);return}se(he),console.log("Proctor college ID:",he);const{data:p}=await g.get("/tbl_examperiod");if(!Array.isArray(p)){console.error("Unexpected examperiod response:",p),q([]);return}console.log("All exam periods:",p);const B=p.filter(Z=>String(Z.college_id)===String(he));if(console.log("Filtered exam periods for college:",B),B.length===0){console.warn(`No exam periods found for college_id=${he}`),q([]);return}const re=[];B.forEach(Z=>{if(!Z.start_date||!Z.end_date)return;const we=new Date(Z.start_date),Re=new Date(Z.end_date);for(let d=new Date(we);d<=Re;d.setDate(d.getDate()+1))re.push(new Date(d).toLocaleDateString("en-CA"))}),re.sort(),q(re),console.log("Allowed dates for proctor:",re)}catch(h){console.error("Error fetching user role or exam schedule:",h),q([])}finally{_e(!1)}})()},[o.user_id]),t.useEffect(()=>{const j=async()=>{if(!E){c(!1);return}try{const{data:A}=await g.get(`/tbl_college/${E}/`);if(!(A!=null&&A.college_name)){console.error("Could not fetch college name"),c(!1);return}const{data:he}=await g.get("/tbl_scheduleapproval/",{params:{college_name:A.college_name,status:"approved"}});c(Array.isArray(he)&&he.length>0)}catch(A){console.error("Error checking approved schedule:",A),c(!1)}};j();const h=setInterval(j,5e3);return()=>clearInterval(h)},[E]);const be=(j,h)=>new Date(j,h+1,0).getDate(),z=(j,h)=>new Date(j,h,1).getDay(),G=()=>{const j=b.getFullYear(),h=b.getMonth(),A=be(j,h),he=z(j,h),p=[];for(let B=0;B<he;B++)p.push(null);for(let B=1;B<=A;B++)p.push(B);return p},y=j=>{if(!j)return;const A=new Date(b.getFullYear(),b.getMonth(),j).toLocaleDateString("en-CA");W.includes(A)&&i(he=>he.includes(A)?he.filter(p=>p!==A):[...he,A])},I=()=>L(j=>new Date(j.getFullYear(),j.getMonth()-1,1)),je=()=>L(j=>new Date(j.getFullYear(),j.getMonth()+1,1)),Ce=async j=>{var re;if(j.preventDefault(),k)return;de(!0);const h=o==null?void 0:o.user_id;if(!h){a.info("User is not logged in."),de(!1);return}if(l.length===0||F.length===0){a.info("Please select at least one date and one time slot."),de(!1);return}let A=0,he=!1;const p={...ce};for(const Z of l){const we=p[Z]||[];for(const Re of F)we.includes(Re)?he=!0:A++}if(he){a.error("Some selected date and time slot combinations already exist."),de(!1);return}if(A>6){a.error("You can only add a maximum of 6 availability slots."),de(!1);return}const B={days:l,time_slots:F,status:Q||"available",remarks:D||null,user_id:h};try{const Z=await g.post("/tbl_availability/",B);if(Z.status>=200&&Z.status<300){a.success("Availability set successfully!");const we={days:B.days,time_slots:B.time_slots,status:B.status,remarks:B.remarks??void 0};u(Re=>[...Re,we]),H(Re=>{const d={...Re};return l.forEach(_=>{d[_]||(d[_]=[]),F.forEach(Y=>{d[_].includes(Y)||d[_].push(Y)})}),d}),ne(Re=>Array.from(new Set([...Re,...l]))),i([]),R([]),pe("available"),te("")}else a.error(`Failed to submit availability: ${((re=Z.data)==null?void 0:re.message)||"Unknown error"}`)}catch(Z){console.error("API error:",Z),a.error(`Failed to process availability: ${(Z==null?void 0:Z.message)||"Unknown error"}`)}de(!1)},m=async j=>{var p;if(j.preventDefault(),k)return;de(!0);const h=C.split(",").filter(Boolean),A=ee.split(",").filter(Boolean);if(h.length===0||A.length===0){a.info("Please select at least one day and one time slot."),de(!1);return}const he=o==null?void 0:o.user_id;if(!he){a.info("User is not logged in."),de(!1);return}try{const B={user_id:he,days:h,time_slots:A,status:ge,remarks:M||null},re=await g.post("/tbl_availability/",B);re.status>=200&&re.status<300?(a.success("Change request submitted successfully!"),n(""),w("unavailable"),O(""),P("")):a.error(`Failed to submit change request: ${((p=re.data)==null?void 0:p.message)||"Unknown error"}`)}catch(B){console.error("Error submitting change request:",B),a.error(`Failed to submit change request: ${(B==null?void 0:B.message)||"Unknown error"}`)}de(!1)},me=["available","unavailable"];return e.jsxs("div",{className:"set-availability-container",children:[e.jsxs("div",{className:"availability-sections",children:[e.jsxs("div",{className:"availability-card",children:[e.jsx("div",{className:"card-header-set",children:"Set Availability"}),e.jsx("div",{className:"subtitle",children:"(Choose your availability for the exam schedule)"}),e.jsxs("form",{onSubmit:Ce,className:"availability-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"day",children:"Day(s)"}),e.jsxs("div",{className:"custom-select-wrapper",children:[e.jsx("input",{type:"text",id:"day",value:N?"Loading...":l.length>0?l.map(j=>new Date(j).toLocaleDateString("en-US")).join(", "):"Click to select dates",readOnly:!0,onClick:()=>{!N&&W.length>0&&!k&&r(!f)},className:"date-input-field",style:{cursor:N||k?"not-allowed":"pointer",color:N?"#6c757d":"black"}}),e.jsx("span",{className:"dropdown-arrow",onClick:()=>{!N&&W.length>0&&!k&&r(!f)},children:"▼"}),f&&!N&&e.jsxs("div",{className:"date-picker",children:[e.jsxs("div",{className:"date-picker-header",children:[e.jsx("button",{type:"button",onClick:I,children:e.jsx(zt,{})}),e.jsx("span",{children:b.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),e.jsx("button",{type:"button",onClick:je,children:e.jsx(Jt,{})})]}),e.jsxs("div",{className:"date-picker-grid",children:[["S","M","T","W","T","F","S"].map((j,h)=>e.jsx("div",{className:"day-name",children:j},h)),G().map((j,h)=>{const A=j?new Date(b.getFullYear(),b.getMonth(),j,12):null,he=A?A.toISOString().split("T")[0]:"",p=W.includes(he)&&!k,B=l.includes(he),re=A&&A.toDateString()===K.toDateString();return e.jsx("div",{className:`calendar-day ${j?"selectable":""} ${B?"selected":""} ${re?"today":""} ${p?"allowed":"disabled"}`,onClick:()=>p&&y(j),style:{pointerEvents:p?"auto":"none",opacity:p?1:.3},children:j},h)})]}),e.jsx("div",{className:"date-picker-footer",children:e.jsx("button",{type:"button",onClick:()=>r(!1),children:"Close"})})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"timeSlot",children:"Time Slot(s)"}),e.jsx(lt,{id:"timeSlot",value:F.map(j=>({value:j,label:j})),onChange:j=>R(j?j.map(h=>h.value):[]),options:Object.values(Na).map(j=>({value:j,label:j})),isMulti:!0,isDisabled:k,classNamePrefix:"react-select",placeholder:"Select Time Slot(s)",isSearchable:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"status",children:"Status"}),e.jsx(lt,{id:"status",value:{value:Q,label:Q.charAt(0).toUpperCase()+Q.slice(1)},onChange:j=>pe((j==null?void 0:j.value)||"available"),options:me.map(j=>({value:j,label:j.charAt(0).toUpperCase()+j.slice(1)})),isDisabled:k,classNamePrefix:"react-select",placeholder:"Select Status",isSearchable:!1})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"remarks",children:"Remarks"}),e.jsx("textarea",{id:"remarks",value:D,onChange:j=>te(j.target.value),placeholder:"Type here...",disabled:k})]}),e.jsx("div",{style:{textAlign:"center",marginTop:"20px"},children:e.jsx("button",{type:"submit",className:"submit-button",disabled:k,children:k?"Submitting...":"Submit"})}),e.jsx("div",{style:{textAlign:"center",marginTop:"10px"},children:e.jsx("span",{style:{color:"#092C4C",cursor:"pointer",textDecoration:"underline"},onClick:()=>J(!0),children:"Click here to view all submitted availabilities"})})]})]}),V&&e.jsx("div",{className:"availability-modal-overlay",children:e.jsxs("div",{className:"availability-modal-box",children:[e.jsx("h2",{className:"availability-modal-title",children:"All Submitted Availabilities"}),ue?e.jsx("div",{className:"modal-loading",children:e.jsx("p",{children:"Loading submitted availabilities..."})}):e.jsx(e.Fragment,{children:U.length>0?e.jsx("div",{className:"availability-modal-body",children:U.map((j,h)=>e.jsxs("div",{className:"availability-entry",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Days:"})," ",j.days.join(", ")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Time Slots:"})," ",j.time_slots.join(", ")]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Status:"})," ",j.status]}),j.remarks&&e.jsxs("p",{children:[e.jsx("strong",{children:"Remarks:"})," ",j.remarks]}),e.jsx("hr",{})]},h))}):e.jsx("div",{className:"modal-empty",children:e.jsx("p",{style:{color:"black"},children:"No availability info found."})})}),e.jsx("button",{type:"button",onClick:()=>J(!1),className:"availability-modal-close-btn",children:"Close"})]})}),e.jsxs("div",{className:"availability-card",children:[e.jsx("div",{className:"card-header-request",children:"Request Change of Availability"}),e.jsx("div",{className:"subtitle",children:$?"(only available after the release of exam schedule)":"(waiting for schedule approval from your dean)"}),$?e.jsxs("form",{onSubmit:m,className:"availability-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"originalDays",children:"Select Schedule Day(s)"}),e.jsx(lt,{id:"originalDays",value:C.split(",").filter(Boolean).map(j=>({value:j,label:new Date(j).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})),onChange:j=>{const h=(j==null?void 0:j.map(A=>A.value))||[];O(h.join(",")),P("")},options:ie.map(j=>({value:j,label:new Date(j).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})),isMulti:!0,placeholder:"Select one or more days",isDisabled:k||ie.length===0,classNamePrefix:"react-select",isSearchable:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"originalTimeSlots",children:"Select Time Slot(s)"}),e.jsx(lt,{id:"originalTimeSlots",value:ee?ee.split(",").map(j=>({value:j,label:j})):[],onChange:j=>{const h=(j==null?void 0:j.map(A=>A.value))||[];P(h.join(","))},options:C?Array.from(new Set(C.split(",").flatMap(j=>ce[j]||[]))).map(j=>({value:j,label:j})):[],placeholder:C?"Select one or more time slots":"Select days first",isDisabled:!C||k,isMulti:!0,classNamePrefix:"react-select",isSearchable:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"changeStatus",children:"New Status"}),e.jsx(lt,{id:"changeStatus",value:{value:ge,label:ge.charAt(0).toUpperCase()+ge.slice(1)},onChange:j=>w((j==null?void 0:j.value)||"unavailable"),options:me.map(j=>({value:j,label:j.charAt(0).toUpperCase()+j.slice(1)})),isDisabled:k,classNamePrefix:"react-select",placeholder:"Select Status",isSearchable:!1})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"reason",children:"Reason/s"}),e.jsx("textarea",{id:"reason",value:M,onChange:j=>n(j.target.value),placeholder:"Type here...",disabled:k})]}),e.jsx("button",{type:"submit",className:"submit-button",disabled:k,children:k?"Submitting...":"Submit"})]}):e.jsxs("div",{style:{textAlign:"center",padding:"40px 20px",color:"#666",fontSize:"14px",border:"1px dashed #ccc",borderRadius:"8px",margin:"20px 0",backgroundColor:"#f9f9f9"},children:[e.jsx("p",{style:{marginBottom:"10px",fontWeight:"bold",color:"#092C4C"},children:"Change requests are currently unavailable"}),e.jsx("p",{children:"This feature will be enabled once your college's exam schedule has been approved by the dean."})]})]})]}),e.jsx(ft,{position:"top-right",autoClose:3e3,hideProgressBar:!0})]})},$a=[],Xt=["9-203","9-204","9-205","9-206","9-207","9-208","9-209"],hs=["2023-2024 2nd Semester","2023-2024 1st Semester","2022-2023 2nd Semester","2022-2023 1st Semester","2021-2022 2nd Semester","2021-2022 1st Semester"],Da=()=>{const o=[];for(let l=7;l<=21;l++)o.push({display:`${l.toString().padStart(2,"0")}:00 - ${l.toString().padStart(2,"0")}:30`,startHour:l,startMinute:0,endHour:l,endMinute:30}),l<21?o.push({display:`${l.toString().padStart(2,"0")}:30 - ${(l+1).toString().padStart(2,"0")}:00`,startHour:l,startMinute:30,endHour:l+1,endMinute:0}):o.push({display:"21:30 - 22:00",startHour:21,startMinute:30,endHour:22,endMinute:0});return o},ns=()=>{const[o,l]=t.useState("day"),[i,F]=t.useState(new Date),[R,C]=t.useState([]),[O,ee]=t.useState(!0),[P,ie]=t.useState(hs[0]);t.useEffect(()=>{(async()=>{ee(!0),await new Promise(r=>setTimeout(r,300));const f=$a.filter(r=>r.semester===P);C(f),ee(!1)})()},[i,P]);const ne=n=>{const f=n.getDay(),r=n.getDate()-f+(f===0?-6:1),b=new Date(n);return b.setDate(r),b.setHours(0,0,0,0),b},ce=n=>{const f=[];for(let r=0;r<7;r++){const b=new Date(n);b.setDate(n.getDate()+r),f.push(b)}return f},H=(n,f=!1)=>{const r={weekday:"long",month:"long",day:"numeric"};return f&&(r.year="numeric"),n.toLocaleDateString("en-US",r)},Q=n=>n.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),pe=(n,f,r,b,L,W)=>{const q=n.toISOString().split("T")[0];return R.filter(E=>{const se=new Date(`${E.date}T${E.startTime}`),k=new Date(`${E.date}T${E.endTime}`),de=new Date(n),$=new Date(n);return de.setHours(r,b,0,0),$.setHours(L,W,0,0),E.date===q&&(!f||E.building===f)&&se<$&&k>de})},D=()=>{const n=new Date(i);n.setDate(i.getDate()-(o==="week"?7:1)),F(n)},te=()=>{const n=new Date(i);n.setDate(i.getDate()+(o==="week"?7:1)),F(n)},ge=o==="week"?ce(ne(i)):Xt,w={gridTemplateColumns:o==="week"?"100px repeat(7, 1fr)":`100px repeat(${Xt.length}, 1fr)`},M=new Date;return e.jsx("div",{className:"set-availability-container",children:e.jsx("div",{className:"availability-sections",style:{flexDirection:"column",gap:25},children:e.jsxs("div",{className:"availability-card",style:{width:"100%"},children:[e.jsxs("div",{className:"form-group",style:{flexDirection:"row",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("div",{children:e.jsx("label",{style:{fontSize:"1.1em"},children:H(i,!0)})}),e.jsx("div",{children:e.jsx("select",{className:"custom-select",value:P,onChange:n=>ie(n.target.value),children:hs.map(n=>e.jsx("option",{value:n,children:n},n))})})]}),e.jsxs("div",{className:"form-group",style:{flexDirection:"row",gap:10,justifyContent:"space-between"},children:[e.jsxs("div",{className:"view-mode-controls",children:[e.jsx("button",{type:"button",className:`submit-button ${o==="week"?"":"inactive"}`,onClick:()=>l("week"),children:"Week View"}),e.jsx("button",{type:"button",className:`submit-button ${o==="day"?"":"inactive"}`,onClick:()=>l("day"),children:"Day View"})]}),e.jsxs("div",{children:[e.jsx("button",{type:"button",className:"submit-button",onClick:D,children:"<"}),e.jsx("button",{type:"button",className:"submit-button",onClick:te,children:">"})]})]}),O?e.jsx("p",{children:"Loading exams..."}):e.jsxs("div",{className:"grid-container",children:[e.jsxs("div",{className:"grid-header",style:w,children:[e.jsx("div",{className:"cell time-header",children:"Time"}),o==="week"?ge.map((n,f)=>e.jsx("div",{className:"cell day-header",children:Q(n)},f)):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"building-group-header",style:{gridColumn:`span ${Xt.length}`},children:"ICT - BUILDING (BLDG 9)"}),Xt.map((n,f)=>e.jsx("div",{className:"cell building-header",children:n},f))]})]}),e.jsx("div",{className:"grid-body",style:w,children:Da().map((n,f)=>e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"cell time-cell",children:n.display}),ge.map((r,b)=>{const L=o==="week"?r:i,W=o==="day"?r:null,q=L.toDateString()===M.toDateString()&&M.getHours()===n.startHour&&M.getMinutes()>=n.startMinute&&M.getMinutes()<n.endMinute,E=pe(L,W,n.startHour,n.startMinute,n.endHour,n.endMinute).length>0;return e.jsx("div",{className:`cell schedule-cell ${E?"occupied-cell":"empty-cell"} ${q?"current-time-slot":""}`},b)})]},f))})]})]})})})},ka=({user:o})=>{const[l,i]=t.useState([]),[F,R]=t.useState(!0),[C,O]=t.useState(new Set),[ee,P]=t.useState(!1),ie=Ot(),ne=async()=>{if(!(o!=null&&o.user_id)){R(!1);return}try{const M=(await g.get(`/notifications/${o.user_id}/`)).data.map(n=>({notification_id:n.notification_id,user_id:n.user_id,sender_id:n.sender_id,title:n.title,message:n.message,type:n.type,status:n.status,link_url:n.link_url,is_seen:n.is_seen??!1,created_at:n.created_at,read_at:n.read_at,priority:n.priority??0,sender_name:n.sender_full_name||"System"}));i(M)}catch(w){console.error("Fetch notifications error:",w)}finally{R(!1)}};t.useEffect(()=>{ne();const w=setInterval(ne,1e4);return()=>clearInterval(w)},[o]),t.useEffect(()=>{O(w=>{const M=new Set;return l.forEach(n=>{w.has(n.notification_id)&&M.add(n.notification_id)}),M})},[l]);const ce=async w=>{try{await g.patch(`/notifications/${w.notification_id}/update/`,{is_seen:!0}),i(M=>M.map(n=>n.notification_id===w.notification_id?{...n,is_seen:!0,read_at:new Date().toISOString()}:n)),w.link_url&&ie(w.link_url)}catch(M){console.error("Error marking notification as read:",M)}},H=async()=>{if(o!=null&&o.user_id)try{await g.patch(`/notifications/${o.user_id}/mark-all-unread/`),i(w=>w.map(M=>({...M,is_seen:!1,read_at:null})))}catch(w){console.error("Error marking all unread:",w)}},Q=l.filter(w=>!w.is_seen).length,pe=l.length>0&&C.size===l.length,D=w=>{O(M=>{const n=new Set(M);return n.has(w)?n.delete(w):n.add(w),n})},te=()=>{if(pe){O(new Set);return}O(new Set(l.map(w=>w.notification_id)))},ge=async()=>{const w=Array.from(C);if(w.length===0){window.alert("No notifications selected.");return}if(window.confirm(`Delete ${w.length} selected notification${w.length===1?"":"s"}? This action cannot be undone.`)){P(!0);try{await Promise.allSettled(w.map(M=>g.delete(`/notifications/${M}/delete/`))),O(new Set),ne()}catch(M){console.error("Bulk delete notifications error:",M)}finally{P(!1)}}};return F?e.jsxs("div",{className:"notification-container",children:[e.jsx("div",{className:"notification-banner",children:"Notifications"}),e.jsx("p",{className:"notification-message",children:"Loading notifications..."})]}):e.jsxs("div",{className:"notification-container",children:[e.jsxs("div",{className:"notification-banner",children:[e.jsx("span",{children:"Notifications"}),Q>0&&e.jsx("span",{className:"notif-badge",children:Q}),e.jsxs("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:"1px"},children:[e.jsx("button",{className:"notif-btn",title:"Mark all as unread",onClick:H,children:e.jsx(Ms,{})}),e.jsx("button",{className:"notif-btn",title:"Delete selected",onClick:ge,disabled:C.size===0||ee,children:e.jsx(bt,{})}),e.jsx("input",{type:"checkbox",className:"notif-btn",checked:pe,onChange:te,disabled:l.length===0,"aria-label":"Select all notifications"})]})]}),e.jsxs("p",{className:"notification-message",children:["You have ",Q," unread notification(s)",l.length>0&&` (Total: ${l.length})`]}),l.length===0?e.jsx("div",{style:{textAlign:"center",padding:"40px 20px",color:"#666",fontSize:"14px"},children:"No notifications yet"}):l.map(w=>e.jsxs("div",{className:"notification-card",onClick:()=>ce(w),style:{backgroundColor:w.is_seen?"#f9f9f9":"#fff",fontWeight:w.is_seen?"normal":"bold",borderLeft:w.is_seen?"3px solid #ccc":"3px solid #092C4C",cursor:"pointer"},children:[e.jsxs("div",{className:"notif-left",children:[e.jsx("span",{className:"notif-icon",children:w.priority===2?e.jsx(bs,{style:{color:"#f44336"}}):w.priority===1?e.jsx(js,{style:{color:"#4CAF50"}}):"⏵"}),e.jsx("span",{className:"notif-sender",children:w.sender_name||"System"})]}),e.jsxs("div",{className:"notif-center",children:[w.title&&e.jsxs(e.Fragment,{children:[e.jsx("strong",{children:w.title}),e.jsx("br",{})]}),w.message]}),e.jsxs("div",{className:"notif-right",onClick:M=>M.stopPropagation(),children:[e.jsx("div",{className:"notif-date",children:new Date(w.created_at).toLocaleString()}),e.jsx("input",{type:"checkbox",checked:C.has(w.notification_id),onChange:()=>D(w.notification_id),"aria-label":`Select notification from ${w.sender_name||"System"}`})]})]},w.notification_id))]})},Ia={"Written (Lecture)":"Lecture","Written (Laboratory)":"Laboratory","PIT or Projects":"No Room",Pitching:"No Room","Hands-on":"Laboratory"},Cs=({user:o})=>{var h,A,he;const[l,i]=t.useState({modality:"",rooms:[],roomType:"",program:"",sections:[],course:"",remarks:""}),[F,R]=t.useState([]),[C,O]=t.useState([]),[ee,P]=t.useState([]),[ie,ne]=t.useState([]),[ce,H]=t.useState([]),[Q,pe]=t.useState(!1),[D,te]=t.useState(!1),[ge,w]=t.useState(!0),[M,n]=t.useState(!1),[f,r]=t.useState(null),[b,L]=t.useState([]),[W,q]=t.useState({visible:!1,roomId:null}),[E,se]=t.useState(!1),[k,de]=t.useState([]),[$,c]=t.useState([]),[U,u]=t.useState(!1),V=t.useCallback(async()=>{if(o!=null&&o.user_id)try{const{data:p}=await g.get("/tbl_modality/",{params:{user_id:o.user_id}});de(p||[]),console.log("User modalities loaded:",(p==null?void 0:p.length)||0)}catch(p){console.error("Error fetching user modalities:",p),a.error("Failed to load your modalities")}},[o]);t.useEffect(()=>{V()},[V]);const J=async()=>{if($.length===0){a.warn("Please select modalities to delete");return}u(!0);try{await Promise.all($.map(p=>g.delete(`/tbl_modality/${p}/`))),a.success(`Successfully deleted ${$.length} modality/modalities`),c([]),se(!1),await V()}catch(p){console.error("Error deleting modalities:",p),a.error("Failed to delete some modalities")}finally{u(!1)}},ue=async()=>{if(k.length===0){a.warn("No modalities to delete");return}if(window.confirm(`⚠️ WARNING: You are about to delete ALL ${k.length} modalities you created.

This action cannot be undone. Continue?`)){u(!0);try{await Promise.all(k.map(B=>g.delete(`/tbl_modality/${B.modality_id}/`))),a.success(`Successfully deleted all ${k.length} modalities`),de([]),c([]),se(!1)}catch(B){console.error("Error deleting all modalities:",B),a.error("Failed to delete all modalities")}finally{u(!1)}}},T=p=>{c(B=>B.includes(p)?B.filter(re=>re!==p):[...B,p])},N=()=>{$.length===k.length?c([]):c(k.map(p=>p.modality_id))},[_e,K]=t.useState({}),be=p=>e.jsxs(rs.Option,{...p,children:[e.jsx("input",{type:"checkbox",checked:p.isSelected,readOnly:!0,style:{marginRight:8}}),e.jsx("label",{children:p.label})]}),z=t.useCallback(async p=>{if(!_e[p])try{const{data:B}=await g.get("/tbl_examdetails",{params:{room_id:p}}),re=B.map(Z=>({start:Z.exam_start_time,end:Z.exam_end_time}));K(Z=>({...Z,[p]:{occupiedTimes:re}}))}catch(B){console.error("Error loading room occupancy:",B)}},[_e]),G=t.useMemo(()=>l.program?C.filter(p=>ee.some(B=>B.program_id===l.program&&B.course_id===p.course_id)):[],[C,ee,l.program]),y=t.useMemo(()=>l.course?ee.filter(p=>p.course_id===l.course).map(p=>({value:p.section_name,label:p.section_name})):[],[ee,l.course]);t.useEffect(()=>{(async()=>{if(o!=null&&o.user_id){w(!0);try{const[{data:B},{data:re},{data:Z},{data:we},{data:Re},{data:d}]=await Promise.all([g.get("/tbl_user_role",{params:{user_id:o.user_id}}),g.get("/programs/"),g.get("/courses/"),g.get("/tbl_sectioncourse/"),g.get("/departments/"),g.get("/tbl_buildings")]);if(!B||B.length===0){w(!1);return}if(B.some(le=>le.role===2||le.role_id===2)){R(re),O(Z);const le=we.map(fe=>{var Pe,Ve;return{course_id:fe.course_id||((Pe=fe.course)==null?void 0:Pe.course_id),program_id:fe.program_id||((Ve=fe.program)==null?void 0:Ve.program_id),section_name:fe.section_name}});P(le);const{data:ke}=await g.get("/tbl_rooms");ne(ke),H(ke.map(fe=>fe.room_id)),L((d==null?void 0:d.map(fe=>({id:fe.building_id,name:fe.building_name})))??[]),console.log("Admin access: All rooms available (not filtered by scheduler)"),w(!1);return}const Y=B.filter(le=>le.role===4||le.role_id===4);if(!Y||Y.length===0){a.warn("You are not assigned as a Bayanihan Leader."),w(!1);return}const ye=Y.map(le=>le.department_id||le.department).filter(Boolean);if(ye.length===0){a.warn("No department assigned to your Bayanihan Leader role."),w(!1);return}const Ee=Re.filter(le=>ye.includes(le.department_id)),Ne=Ee.map(le=>le.college_id||le.college).filter(Boolean);if(Ne.length===0){a.warn("No associated college found for your department."),w(!1);return}const Ue=Ne.map(le=>String(le.college_id||le)).filter(Boolean),et=Ee.map(le=>le.department_name).filter(Boolean);console.log("=== BAYANIHAN LEADER DEBUG ==="),console.log("Leader Department IDs:",ye),console.log("Department Names:",et),console.log("College IDs (objects):",Ne),console.log("College ID Strings:",Ue);const Ge=re.filter(le=>{const ke=String(le.department||le.department_name||""),fe=String(le.department_id||""),Pe=String(le.college_id||le.college||""),Ve=ye.includes(fe)||et.some(De=>ke.includes(De)),Me=Ue.includes(Pe);return Ve||Me});console.log("Total Programs:",re.length),console.log("Filtered Programs:",Ge.length),console.log("Sample Program:",re[0]),console.log("=============================="),R(Ge);const{data:s}=await g.get("/tbl_course_users/",{params:{user_id:o.user_id,is_bayanihan_leader:!0}}),x=(s==null?void 0:s.map(le=>le.course_id))??[],v=Z.filter(le=>x.includes(le.course_id));O(v);const X=(we==null?void 0:we.filter(le=>{var ke;return x.includes(le.course_id||((ke=le.course)==null?void 0:ke.course_id))}).map(le=>{var ke,fe;return{course_id:le.course_id||((ke=le.course)==null?void 0:ke.course_id),program_id:le.program_id||((fe=le.program)==null?void 0:fe.program_id),section_name:le.section_name}}))??[];P(X),console.log("Fetching available rooms for colleges:",Ue);const Se=Ue.map(le=>g.get("/tbl_available_rooms/",{params:{college_id:le}})),qe=(await Promise.all(Se)).flatMap(le=>le.data);console.log("Available rooms data:",qe);const $e=qe.map(le=>{var ke;return((ke=le.room)==null?void 0:ke.room_id)||le.room_id||le.room}).filter(le=>le);if(console.log("Extracted room IDs:",$e),H($e.map(String)),$e.length>0){const{data:le}=await g.get("/tbl_rooms"),ke=le.filter(fe=>$e.includes(fe.room_id));ne(ke),console.log("Filtered rooms for Bayanihan Leader:",ke)}else ne([]),console.log("No available rooms found for Bayanihan Leader");L((d==null?void 0:d.map(le=>({id:le.building_id,name:le.building_name})))??[]),console.log("Bayanihan Leader - Available Room IDs (set by scheduler):",$e)}catch(B){console.error("Unexpected error fetching data:",B),a.error("An unexpected error occurred while loading data")}finally{w(!1)}}})()},[o]),t.useEffect(()=>{const p=Ia[l.modality];if(p){if(p==="No Room"){i(B=>({...B,rooms:[],roomType:"No Room"}));return}i(B=>({...B,roomType:p}))}},[l.modality]);const I=p=>{const{name:B,value:re}=p.target;i(B==="program"?Z=>({...Z,program:re}):Z=>({...Z,[B]:re}))},je=async p=>{if(p.preventDefault(),D||!(o!=null&&o.user_id))return;if(!l.sections.length){a.warn("Please select at least one section.");return}if(l.sections.length!==l.rooms.length){a.error(`Number of sections must be equal to the number of rooms! (${l.sections.length} of ${l.rooms.length} selected)`);return}te(!0);const B=l.sections.map(async d=>{const _=ee.find(Y=>Y.course_id===l.course&&Y.section_name===d);if(!_)return{status:"rejected",reason:`Section ${d} not found`};try{const{data:Y}=await g.get("/tbl_modality/",{params:{course_id:_.course_id,program_id:_.program_id,section_name:_.section_name,modality_type:l.modality,room_type:l.roomType}});return Y&&Y.length>0?{status:"skipped",section:d}:(await g.post("/tbl_modality/",{modality_type:l.modality,room_type:l.roomType,modality_remarks:l.remarks,course_id:_.course_id,program_id:_.program_id,section_name:_.section_name,possible_rooms:l.rooms,user_id:o.user_id,created_at:new Date().toISOString()}),{status:"success",section:d})}catch(Y){return{status:"error",section:d,error:Y}}}),re=await Promise.allSettled(B);let Z=0,we=0,Re=0;re.forEach(d=>{if(d.status==="fulfilled"){const _=d.value;_.status==="success"?Z++:_.status==="skipped"?we++:Re++}else Re++}),Z>0&&a.success(`Successfully saved ${Z} section(s)`),we>0&&a.info(`Skipped ${we} section(s) (already submitted)`),Re>0&&a.error(`Failed to save ${Re} section(s)`),te(!1),i({modality:"",rooms:[],roomType:"",program:"",sections:[],course:"",remarks:""})},Ce=t.useCallback(p=>{const B=new Date;B.setHours(7,30,0,0);const re=new Date;re.setHours(21,0,0,0);const Z=_e[String(p)],we=(Z==null?void 0:Z.occupiedTimes.map(_=>({start:new Date(_.start),end:new Date(_.end)})).sort((_,Y)=>_.start.getTime()-Y.start.getTime()))||[],Re=[];let d=new Date(B);for(const _ of we)d.getTime()<_.start.getTime()&&Re.push({start:new Date(d),end:new Date(_.start),occupied:!1}),Re.push({start:new Date(_.start),end:new Date(_.end),occupied:!0}),d=new Date(_.end);return d.getTime()<re.getTime()&&Re.push({start:new Date(d),end:new Date(re),occupied:!1}),Re},[_e]),m=({roomId:p})=>{t.useEffect(()=>{z(p)},[p]);const B=Ce(p);return _e[p]?e.jsx("div",{className:"occupancy-timeslots",children:B.map((re,Z)=>e.jsxs("div",{className:`timeslot-entry ${re.occupied?"occupied":"vacant"}`,children:[e.jsx("div",{className:"timeslot-status",children:re.occupied?"Occupied":"Available"}),e.jsxs("div",{className:"timeslot-time",children:[re.start.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})," -"," ",re.end.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]},Z))}):e.jsx("div",{style:{textAlign:"center",padding:"1rem"},children:"Loading occupancy..."})},me=ie,j=t.useMemo(()=>me.filter(p=>!f||p.building_id===f).sort((p,B)=>p.room_type===l.roomType&&B.room_type!==l.roomType?-1:p.room_type!==l.roomType&&B.room_type===l.roomType?1:p.room_name.localeCompare(B.room_name)),[me,f,l.roomType]);return e.jsxs("div",{className:"set-availability-container",children:[e.jsx("div",{className:"availability-sections",children:e.jsxs("div",{className:"availability-card",children:[e.jsx("div",{className:"card-header-set",children:"Modality Submission"}),e.jsx("p",{className:"subtitle",children:"Please fill in all fields before submitting."}),ge?e.jsx("div",{style:{backgroundColor:"#e3f2fd",border:"1px solid #2196F3",padding:"12px",borderRadius:"4px",marginBottom:"20px",color:"#1565C0",textAlign:"center"},children:"Loading available rooms..."}):ce.length===0?e.jsx("div",{style:{backgroundColor:"#fff3cd",border:"1px solid #ffc107",padding:"12px",borderRadius:"4px",marginBottom:"20px",color:"#856404"},children:"⚠️ No rooms are currently available for selection. Please contact the administrator to set up available rooms in the Room Management page."}):null,e.jsxs("form",{className:"availability-form",onSubmit:je,children:[e.jsxs("div",{className:"availability-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Modality Type"}),e.jsx(lt,{options:[{value:"Hands-on",label:"Hands-on"},{value:"Written (Lecture)",label:"Written (Lecture)"},{value:"Written (Laboratory)",label:"Written (Laboratory)"},{value:"PIT or Projects",label:"PIT or Projects"},{value:"Pitching",label:"Pitching"}],value:l.modality?{value:l.modality,label:l.modality}:null,onChange:p=>i(B=>({...B,modality:(p==null?void 0:p.value)||""})),placeholder:"Select modality...",isClearable:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Building-Room"}),e.jsx("button",{type:"button",className:"open-modal-btn",disabled:!l.roomType||l.roomType==="No Room"||ce.length===0||ge,onClick:()=>n(!0),children:ge?"Loading...":"Select Room"}),l.rooms.length>0&&e.jsx("div",{className:"selected-rooms",children:l.rooms.map(p=>{const B=ie.find(re=>re.room_id===p);return e.jsx("div",{className:"room-card",children:B==null?void 0:B.room_id},p)})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Room Type"}),e.jsx("input",{type:"text",name:"roomType",value:l.roomType,readOnly:!0,className:"custom-select",placeholder:"Auto-filled"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Program"}),e.jsx(lt,{options:F.map(p=>({value:p.program_id,label:`${p.program_id} - ${p.program_name}`})),value:F.filter(p=>p.program_id===l.program).map(p=>({value:p.program_id,label:`${p.program_id} - ${p.program_name}`})),onChange:p=>i(B=>({...B,program:(p==null?void 0:p.value)||"",course:"",sections:[]})),placeholder:"Select program...",isClearable:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Course"}),e.jsx(lt,{isDisabled:!l.program,options:G.map(p=>({value:p.course_id,label:`${p.course_id} (${p.course_name})`})),value:l.course?{value:l.course,label:`${(h=G.find(p=>p.course_id===l.course))==null?void 0:h.course_id} (${(A=G.find(p=>p.course_id===l.course))==null?void 0:A.course_name})`}:null,onChange:p=>i(B=>({...B,course:(p==null?void 0:p.value)||"",sections:[]})),placeholder:"Select course...",isClearable:!0})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{children:"Sections"}),l.course?e.jsx(lt,{isMulti:!0,closeMenuOnSelect:!1,hideSelectedOptions:!1,components:{Option:be},options:[{value:"select_all",label:"Select All Sections"},...y],value:l.sections.map(p=>({value:p,label:p})),onChange:p=>{if(!p){i(we=>({...we,sections:[]}));return}const B=y.map(we=>we.value);if(p.some(we=>we.value==="select_all")){if(l.rooms.length===0){a.warn('Please select rooms first before using "Select All".');return}const we=B.slice(0,l.rooms.length);i(Re=>({...Re,sections:we})),a.info(`Only ${l.rooms.length} section(s) selected.`);return}const Z=p.map(we=>we.value);if(Z.length>l.rooms.length){a.error(`You can only select ${l.rooms.length} section(s) because ${l.rooms.length} room(s) are selected.`);return}i(we=>({...we,sections:Z}))},placeholder:"Select sections..."}):e.jsx("p",{style:{color:"#888"},children:"Select a course first"}),l.rooms.length>0&&e.jsxs("small",{style:{marginTop:"4px",display:"block",color:l.sections.length!==l.rooms.length?"red":"#666"},children:["⚠️ Number of sections must be equal to the number of rooms! ",l.sections.length," of ",l.rooms.length," section(s) selected."]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Remarks"}),e.jsx("textarea",{name:"remarks",value:l.remarks,onChange:I,placeholder:"Enter any notes or remarks here..."})]})]}),e.jsx("button",{type:"submit",disabled:D,children:"Submit"}),e.jsx("div",{style:{marginTop:"20px",textAlign:"center"},children:e.jsx("button",{type:"button",onClick:()=>se(!0),className:"delete-button",title:"Delete all modalities",style:{backgroundColor:"#dc3545",color:"white",border:"none",padding:"10px",borderRadius:"50px",cursor:"pointer",fontSize:"16px",fontWeight:"bold",display:"inline-flex",alignItems:"center"},children:e.jsx(bt,{})})})]})]})}),M&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-contents-modality",children:[e.jsx("h3",{children:"Select Room"}),e.jsx(lt,{options:b.map(p=>({value:p.id,label:`${p.name} (${p.id})`})),value:f?{value:f,label:`${(he=b.find(p=>p.id===f))==null?void 0:he.name} (${f})`}:null,onChange:p=>r((p==null?void 0:p.value)||null),placeholder:"-- Select Building --",isClearable:!0}),e.jsxs("div",{className:"room-grid",children:[j.map(p=>{const B=p.room_type!==l.roomType,re=l.rooms.includes(p.room_id);return e.jsxs("div",{className:`room-box ${re?"selected":""} ${B?"disabled":""}`,onClick:()=>{B||i(Z=>({...Z,rooms:re?Z.rooms.filter(we=>we!==p.room_id):[...Z.rooms,p.room_id]}))},children:[e.jsxs("div",{className:"room-label",children:[p.room_id," ",e.jsxs("small",{children:["(",p.room_type,")"]})]}),!B&&e.jsx("button",{type:"button",className:"view-occupancy",onClick:Z=>{Z.stopPropagation(),q({visible:!0,roomId:p.room_id})},children:e.jsx("small",{children:"View Vacancy"})})]},p.room_id)}),j.length===0&&e.jsx("div",{className:"no-rooms",children:"No available rooms for this room type"})]}),e.jsx("div",{className:"modal-actions",children:e.jsx("button",{type:"button",className:"close-modal",onClick:()=>n(!1),children:"Done"})})]})}),W.visible&&W.roomId&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-contents-modality",children:[e.jsx("h3",{children:"Room Occupancy"}),e.jsx(m,{roomId:W.roomId}),e.jsx("div",{className:"modal-actions",children:e.jsx("button",{type:"button",className:"close-modal",onClick:()=>q({visible:!1,roomId:null}),children:"Close"})})]})}),e.jsx(ft,{position:"top-right",autoClose:2e3}),E&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-contents-modality",style:{maxWidth:"800px",maxHeight:"80vh",overflow:"auto"},children:[e.jsx("h3",{children:"Delete Your Modalities"}),k.length===0?e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{textAlign:"center",padding:"2rem",color:"#666"},children:"You haven't created any modalities yet."}),e.jsx("div",{style:{marginTop:"1rem",display:"flex",justifyContent:"center"},children:e.jsx("button",{type:"button",className:"close-modal",onClick:()=>se(!1),style:{backgroundColor:"#6c757d",color:"white",padding:"10px 20px",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Close"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:$.length===k.length,onChange:N,style:{marginRight:"8px"}}),e.jsxs("strong",{children:["Select All (",k.length,")"]})]}),e.jsxs("span",{style:{color:"#666",fontSize:"14px"},children:[$.length," selected"]})]}),e.jsx("div",{style:{maxHeight:"400px",overflowY:"auto",border:"1px solid #ddd",borderRadius:"4px",padding:"10px"},children:k.map(p=>{const B=C.find(Z=>Z.course_id===p.course_id),re=F.find(Z=>Z.program_id===p.program_id);return e.jsx("div",{style:{padding:"12px",marginBottom:"8px",border:"1px solid #e0e0e0",borderRadius:"4px",backgroundColor:$.includes(p.modality_id)?"#fff3cd":"white",cursor:"pointer",transition:"all 0.2s"},onClick:()=>T(p.modality_id),children:e.jsxs("label",{style:{display:"flex",alignItems:"start",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:$.includes(p.modality_id),onChange:()=>T(p.modality_id),style:{marginRight:"12px",marginTop:"4px"},onClick:Z=>Z.stopPropagation()}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:p.section_name||"No Section"}),e.jsxs("div",{style:{fontSize:"14px",color:"#666"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Course:"})," ",(B==null?void 0:B.course_id)||"N/A"," - ",(B==null?void 0:B.course_name)||"Unknown"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Program:"})," ",(re==null?void 0:re.program_id)||"N/A"," - ",(re==null?void 0:re.program_name)||"Unknown"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Modality:"})," ",p.modality_type]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Room Type:"})," ",p.room_type]}),p.possible_rooms&&p.possible_rooms.length>0&&e.jsxs("div",{children:[e.jsx("strong",{children:"Possible Rooms:"})," ",p.possible_rooms.join(", ")]}),p.modality_remarks&&e.jsxs("div",{children:[e.jsx("strong",{children:"Remarks:"})," ",p.modality_remarks]})]})]})]})},p.modality_id)})}),e.jsxs("div",{style:{marginTop:"1rem",display:"flex",gap:"10px",justifyContent:"flex-end",flexWrap:"wrap"},children:[e.jsx("button",{type:"button",className:"close-modal",onClick:()=>{se(!1),c([])},disabled:U,style:{backgroundColor:"#6c757d",color:"white",padding:"10px 20px",border:"none",borderRadius:"4px",cursor:U?"not-allowed":"pointer",opacity:U?.6:1},children:"Cancel"}),e.jsx("button",{type:"button",onClick:ue,disabled:U||k.length===0,style:{backgroundColor:"#dc3545",color:"white",padding:"10px 20px",border:"none",borderRadius:"4px",cursor:U||k.length===0?"not-allowed":"pointer",opacity:U||k.length===0?.6:1},children:U?"Deleting...":"Delete All"}),e.jsx("button",{type:"button",onClick:J,disabled:U||$.length===0,style:{backgroundColor:"#ffc107",color:"#000",padding:"10px 20px",border:"none",borderRadius:"4px",cursor:U||$.length===0?"not-allowed":"pointer",opacity:U||$.length===0?.6:1,fontWeight:"bold"},children:U?e.jsx("span",{className:"spinner"}):`Delete Selected (${$.length})`})]})]})]})})]})},Vt=({isOpen:o,onClose:l,children:i})=>{const[F,R]=t.useState(!1);if(t.useEffect(()=>{let P=document.getElementById("modal-root");P||(P=document.createElement("div"),P.setAttribute("id","modal-root"),document.body.appendChild(P))},[]),t.useEffect(()=>{R(!!o)},[o]),!o&&!F)return null;const C=()=>{R(!1),setTimeout(()=>{l()},300)},O=e.jsxs(e.Fragment,{children:[e.jsx("div",{onClick:C,style:{position:"fixed",inset:0,background:F?"rgba(0,0,0,0.15)":"rgba(0,0,0,0)",zIndex:900,transition:"background 0.3s ease",pointerEvents:F?"auto":"none"}}),e.jsxs("div",{onClick:P=>P.stopPropagation(),className:"modal-scroll",style:{position:"fixed",top:"70px",left:"52%",transform:`translateX(-50%) translateY(${F?"0":"-20px"})`,zIndex:1e3,pointerEvents:"auto",maxWidth:"90vw",maxHeight:"calc(100vh - 100px)",overflowY:"auto",backgroundColor:"white",borderRadius:"20px",boxShadow:"0 8px 24px rgba(0,0,0,0.3)",padding:"30px",opacity:F?1:0,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",height:"50%",width:"50%"},children:[e.jsx("button",{type:"button",onClick:C,style:{position:"absolute",top:"15px",right:"15px",background:"transparent",border:"none",cursor:"pointer",fontSize:"20px",color:"#092C4C",zIndex:1100,padding:"5px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",transition:"background 0.2s ease"},onMouseEnter:P=>{P.currentTarget.style.backgroundColor="rgba(9, 44, 76, 0.1)"},onMouseLeave:P=>{P.currentTarget.style.backgroundColor="transparent"},children:e.jsx(ys,{})}),e.jsx("div",{style:{marginTop:"10px"},children:i})]})]}),ee=document.getElementById("modal-root");return ee?Es.createPortal(O,ee):null},Aa=({user:o,onScheduleCreated:l})=>{const[i,F]=t.useState({academic_year:"",exam_category:"",selectedPrograms:[],selectedCourses:[],selectedModalities:[],selectedExamDates:[]}),[R,C]=t.useState([]),[O,ee]=t.useState([]),[P,ie]=t.useState([]),[ne,ce]=t.useState([]),[H,Q]=t.useState([]),[pe,D]=t.useState([]),[te,ge]=t.useState([]),[w,M]=t.useState([]),[n,f]=t.useState(""),[r,b]=t.useState(!1),[L,W]=t.useState(""),[q,E]=t.useState([]),[se,k]=t.useState([]),[de,$]=t.useState([]),[c,U]=t.useState({hours:1,minutes:0}),[u,V]=t.useState(""),J=["07:00","07:30","08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30","21:00"],ue=String(c.hours).padStart(2,"0"),T=String(c.minutes).padStart(2,"0"),N=`${ue}:${T}:00`;t.useEffect(()=>{(async()=>{if(!(o!=null&&o.user_id)){console.warn("No user found — cannot fetch data.");return}try{const Y=(await g.get("/tbl_college/")).data;$(Y||[]);const Ee=(await g.get("/tbl_user_role",{params:{user_id:o.user_id,role_id:3}})).data||[];if(!Ee||Ee.length===0){alert("No scheduler role found. Contact administrator.");return}const Ne=Array.from(new Set(Ee.map(S=>String(S.college_id)).filter(Boolean)));if(ge(Ne),Ne.length===0){alert("No college assigned to your role.");return}let Ue="";if(Ne.length>0){const S=Y.find(ae=>String(ae.college_id)===Ne[0]);Ue=(S==null?void 0:S.college_name)||"",W(Ue),console.log("Scheduler College Name:",Ue),console.log("Scheduler College ID:",Ne[0])}const[et,Ge,s,x,v,X,Se]=await Promise.all([g.get("/tbl_examperiod"),g.get("/departments/"),g.get("/programs/"),g.get("/tbl_term"),g.get("/tbl_sectioncourse/"),g.get("/tbl_rooms"),g.get("/tbl_buildings")]),Te=et.data,qe=Ge.data,$e=s.data,le=x.data,ke=v.data,fe=X.data,Pe=Se.data;console.log("All departments:",qe),console.log("All programs:",$e);const Ve=(qe||[]).filter(S=>{const ae=Ne.includes(String(S.college_id));return console.log(`Dept ${S.department_id} - College: ${S.college_id} - Match: ${ae}`),ae});console.log("Filtered departments:",Ve);const Me=Ve.map(S=>String(S.department_id));console.log("Allowed department IDs:",Me);const De=($e||[]).filter(S=>{const ae=Me.includes(String(S.department_id));return console.log(`Program ${S.program_id} - Dept: ${S.department_id} - Match: ${ae}`),ae});console.log("Filtered Programs for dropdown:",De);const He=(Te||[]).filter(S=>Ne.includes(String(S.college_id))),at=(ke||[]).filter(S=>De.find(Ie=>Ie.program_id===S.program_id)!==void 0);C(He),M(Ve),ie(De),Q(le||[]),D(at),E(fe||[]),k(Pe||[]),console.log("Programs state set with:",De.length,"programs")}catch(_){console.error("Failed to fetch data:",_),alert("Failed to fetch data")}})()},[o]),t.useEffect(()=>{(async()=>{if(i.selectedPrograms.length===0){ce([]);return}try{const _=pe.filter(Ue=>i.selectedPrograms.includes(Ue.program_id)),Y=Array.from(new Set(_.map(Ue=>Ue.course_id)));if(Y.length===0){ce([]);return}const Ne=((await g.get("/courses/")).data||[]).filter(Ue=>Y.includes(Ue.course_id));ce(Ne),console.log(`Lazy loaded ${Ne.length} courses for selected programs`)}catch(_){console.error("Error lazy loading courses:",_),ce([])}})()},[i.selectedPrograms,pe]),t.useEffect(()=>{console.log("Programs state updated. Count:",P.length),console.log("Programs:",P)},[P]),t.useEffect(()=>{(async()=>{if(i.selectedPrograms.length===0||i.selectedCourses.length===0){ee([]);return}try{const _={program_id:i.selectedPrograms.join(","),course_id:i.selectedCourses.join(",")},ye=(await g.get("/tbl_modality/",{params:_})).data||[];console.log("Raw modalities from API:",ye.length),console.log("First modality sample:",ye[0]),console.log("Selected programs:",i.selectedPrograms),console.log("Programs array:",P),console.log("Departments array:",w),console.log("Scheduler college name:",L);const Ee=ye.filter(Ne=>i.selectedPrograms.includes(Ne.program_id)?!0:(console.log(`Modality ${Ne.modality_id} filtered out - program ${Ne.program_id} not in selected programs`),!1));ee(Ee),console.log(`Lazy loaded ${Ee.length} modalities for college: ${L}`)}catch(_){console.error("Error lazy loading modalities:",_),ee([])}})()},[i.selectedPrograms,i.selectedCourses,P,w,de,L]);const _e=async d=>{try{const ye=(await g.get("/tbl_examdetails",{params:{modality_id:d.join(",")}})).data.filter(Ee=>d.includes(Ee.modality_id));return new Set(ye.map(Ee=>Ee.modality_id)||[])}catch(_){return console.error("Error checking existing schedules:",_),new Set}},K=t.useMemo(()=>{const d=new Map;return H.forEach(_=>d.set(_.term_id,_.term_name??String(_.term_id))),d},[H]),be=t.useMemo(()=>{const d=new Set,_=[];return R.forEach(Y=>{const ye=K.get(Y.term_id)??"Term",Ee=`${Y.academic_year}||${ye}`;d.has(Ee)||(d.add(Ee),_.push({key:Ee,label:`${Y.academic_year} | ${ye}`,value:`${Y.academic_year} | ${ye}`}))}),_},[R,K]),z=t.useMemo(()=>Array.from(new Set(R.map(d=>d.exam_category).filter(Boolean))),[R]),G=t.useMemo(()=>{if(!R.length||!te.length)return[];const d=R.filter(ye=>te.includes(String(ye.college_id))),_=[];d.forEach(ye=>{if(!ye.start_date||!ye.end_date)return;const Ee=new Date(ye.start_date),Ne=new Date(ye.end_date);for(let Ue=new Date(Ee);Ue<=Ne;Ue.setDate(Ue.getDate()+1)){const et=Ue.toISOString().slice(0,10),Ge=Ue.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});_.push({key:`${ye.examperiod_id}-${et}`,iso:et,label:Ge})}});const Y=new Set;return _.filter(ye=>Y.has(ye.iso)?!1:(Y.add(ye.iso),!0))},[R,te]),y=t.useMemo(()=>i.selectedPrograms.length===0?[]:ne,[i.selectedPrograms,ne]),I=t.useMemo(()=>i.selectedPrograms.length===0||i.selectedCourses.length===0?[]:O.filter(d=>i.selectedPrograms.includes(d.program_id)&&i.selectedCourses.includes(d.course_id)),[i.selectedPrograms,i.selectedCourses,O]);t.useEffect(()=>{be.length>0&&!i.academic_year&&F(d=>({...d,academic_year:be[0].value})),z.length>0&&!i.exam_category&&F(d=>({...d,exam_category:z[0]}))},[be,z]);const je=d=>{const[_,Y]=d.split(":").map(Number);return _*60+Y},Ce=(d,_,Y,ye)=>d<ye&&Y<_,m=d=>{if(!d)return"Unknown";const _=d.match(/(\d)/);return _?_[1]:"Unknown"},me=(d,_)=>{const[Y,ye]=d.split(":").map(Number),Ee=[];for(let Ne=0;Ne<_;Ne+=30){const Ue=Y+Math.floor((ye+Ne)/60),et=(ye+Ne)%60;Ee.push(`${String(Ue).padStart(2,"0")}:${String(et).padStart(2,"0")}`)}return Ee},j=(d,_,Y,ye,Ee,Ne,Ue,et,Ge)=>{const s=[],x=new Map,v=new Map,X=new Set,Se=new Map,Te=new Map;d.forEach($e=>{const ke=$e.is_night_class==="YES"?`${$e.course_id}_NIGHT`:$e.course_id;Te.has(ke)||Te.set(ke,[]),Te.get(ke).push($e)});const qe=new Map;return Te.forEach(($e,le)=>{const ke=$e[0],Pe=ke.is_night_class==="YES"?ye.filter(at=>{const[S,ae]=at.split(":").map(Number);return S*60+ae+Ne<=21*60}):Y.filter(at=>!ye.includes(at)),Ve=ke.course_id;let Me=Ge.get(Ve);(!Me||!_.includes(Me))&&(Me=_[Math.floor(Math.random()*_.length)],Ge.set(Ve,Me));let De=!1;const He=Pe.length*3;for(let at=0;at<He&&!De;at++){const S=Pe[Math.floor(Math.random()*Pe.length)],ae=je(S),Ie=ae+Ne;let Oe=0;for(const Ae of $e){const Ye=Ee.get(Ae.modality_id)||[];for(const Ze of Ye){const Je=`${Me}|${Ze}`;if(!(x.get(Je)||[]).some(xe=>Ce(ae,Ie,xe.start,xe.end))){Oe++;break}}}Oe>=$e.length&&(qe.set(le,{date:Me,timeSlot:S}),De=!0)}if(!De&&Pe.length>0){const at=Pe[Math.floor(Math.random()*Pe.length)];qe.set(le,{date:Me,timeSlot:at})}}),d.forEach($e=>{if(X.has($e.modality_id))return;if(!et.has($e.modality_id)){console.warn(`Section ${$e.modality_id} not found in sectionMap. Skipping.`);return}const le=$e.is_night_class==="YES",ke=le?`${$e.course_id}_NIGHT`:$e.course_id,fe=qe.get(ke);if(!fe){console.warn(`No time slot assigned for course ${ke}`);return}const{date:Pe,timeSlot:Ve}=fe,Me=je(Ve),De=Me+Ne;let He="";const at=Ee.get($e.modality_id)||[];for(const ze of at){const xe=`${Pe}|${ze}`;if(!(x.get(xe)||[]).some(Le=>Ce(Me,De,Le.start,Le.end))){He=ze,x.has(xe)||x.set(xe,[]),x.get(xe).push({start:Me,end:De});break}}!He&&at.length>0&&(He=at[Math.floor(Math.random()*at.length)]);const S=m($e.section_name),ae=$e.program_id,Ie=P.find(ze=>ze.program_id===ae),Oe=Ie?String(Ie.department_id):"unknown",Ae=w.find(ze=>String(ze.department_id)===Oe),Ye=Ae?String(Ae.college_id):"unknown",Ze=[];for(let ze=0;ze<Ne;ze+=30){const xe=Me+ze,Fe=Math.floor(xe/60),Le=xe%60;Ze.push(`${String(Fe).padStart(2,"0")}:${String(Le).padStart(2,"0")}`)}for(const ze of Ze){const xe=`${Pe}|${ze}`;Se.has(xe)||Se.set(xe,new Map);const Fe=Se.get(xe);Fe.has(Ye)||Fe.set(Ye,new Set),Fe.get(Ye).add(S)}let Je=-1;if(le&&$e.instructor_id&&Ue(Pe,Ve).includes($e.instructor_id)){const xe=`${Pe}|${$e.instructor_id}`;(v.get(xe)||[]).some(Le=>Ce(Me,De,Le.start,Le.end))||(Je=$e.instructor_id,v.has(xe)||v.set(xe,[]),v.get(xe).push({start:Me,end:De}))}if(Je===-1){const ze=Ue(Pe,Ve);if(ze.length>0){for(const xe of ze){const Fe=`${Pe}|${xe}`;if(!(v.get(Fe)||[]).some(Ke=>Ce(Me,De,Ke.start,Ke.end))){Je=xe,v.has(Fe)||v.set(Fe,[]),v.get(Fe).push({start:Me,end:De});break}}Je===-1&&(Je=ze[Math.floor(Math.random()*ze.length)])}}X.add($e.modality_id),s.push({sectionId:$e.modality_id,date:Pe,timeSlot:Ve,roomId:He,proctorId:Je})}),s},h=(d,_,Y,ye,Ee)=>{let Ne=0;const Ue=new Map,et=new Map,Ge=new Map,s=new Map,x=new Map,v=new Map,X=new Map;return d.forEach(Se=>{const Te=_.get(Se.sectionId);if(!Te)return;const{date:qe,timeSlot:$e,roomId:le,proctorId:ke}=Se,fe=je($e),Pe=fe+Y,Ve=m(Te.section_name),Me=Te.course_id,De=Te.program_id,He=ye.find(Je=>Je.program_id===De),at=He?String(He.department_id):"unknown",S=Ee.find(Je=>String(Je.department_id)===at),ae=S?String(S.college_id):"unknown";s.set(Se.sectionId,(s.get(Se.sectionId)||0)+1),s.get(Se.sectionId)>1&&(Ne-=1e4),v.has(Me)||v.set(Me,new Set),v.get(Me).add(qe),v.get(Me).size>1&&(Ne-=25e3),X.has(Me)||X.set(Me,new Map),X.get(Me).has(qe)||X.get(Me).set(qe,new Set);const Ie=X.get(Me).get(qe);Ie.size>0&&Array.from(Ie)[0]!==$e&&(Ne-=15e3),Ie.add($e);const Oe=`${Ve}-${De}`;me($e,Y).forEach(Je=>{const ze=`${qe}|${Je}`;Ge.has(ze)||Ge.set(ze,new Set),Ge.get(ze).has(Oe)&&(Ne-=5e3),Ge.get(ze).add(Oe)});const Ye=`${qe}|${$e}`;x.has(Ye)||x.set(Ye,new Map);const Ze=x.get(Ye);if(Ze.has(ae)||Ze.set(ae,new Set),Ze.get(ae).add(Ve),Ze.get(ae).size>1&&(Ne-=8e3),!le)Ne-=8e3;else{const Je=`${qe}|${le}`;Ue.has(Je)||Ue.set(Je,[]);const ze=Ue.get(Je);ze.forEach(xe=>{Ce(fe,Pe,xe.start,xe.end)&&(Ne-=2e4)}),ze.push({start:fe,end:Pe,sectionId:Se.sectionId})}if(ke===-1)Ne-=6e3;else{const Je=`${qe}|${ke}`;et.has(Je)||et.set(Je,[]);const ze=et.get(Je);ze.forEach(xe=>{if(Ce(fe,Pe,xe.start,xe.end))Ne-=3e4;else if(xe.end===fe)xe.deptId===at&&(Ne-=12e3);else if(fe>xe.end&&fe<xe.end+Y&&xe.deptId===at){const Fe=fe-xe.end,Ke=Y-Fe;Ne-=Ke*100}}),ze.push({start:fe,end:Pe,sectionId:Se.sectionId,deptId:at})}le&&ke!==-1&&(Ne+=1e3)}),Ne},A=(d,_,Y=3)=>{let ye=Math.floor(Math.random()*d.length);for(let Ee=1;Ee<Y;Ee++){const Ne=Math.floor(Math.random()*d.length);_[Ne]>_[ye]&&(ye=Ne)}return d[ye].map(Ee=>({...Ee}))},he=(d,_)=>{const Y=[],ye=[];return d.forEach((Ee,Ne)=>{Math.random()<.5?(Y.push({...d[Ne]}),ye.push({..._[Ne]})):(Y.push({..._[Ne]}),ye.push({...d[Ne]}))}),[Y,ye]},p=(d,_,Y,ye,Ee,Ne,Ue,et)=>{const Ge=new Map;return d.forEach(s=>{const x=_.get(s.sectionId);if(x){const X=x.is_night_class==="YES"?`${x.course_id}_NIGHT`:x.course_id;Ge.has(X)||Ge.set(X,{date:s.date,timeSlot:s.timeSlot})}}),d.map(s=>{if(Math.random()<et){const x=_.get(s.sectionId);if(!x)return{...s};const v=x.is_night_class==="YES",X=v?`${x.course_id}_NIGHT`:x.course_id,Se=Math.floor(Math.random()*4),Te=Ne.get(s.sectionId)||[],qe=v?Ee.filter($e=>{const[le,ke]=$e.split(":").map(Number),fe=c.hours*60+c.minutes;return le*60+ke+fe<=21*60}):ye;if(Se===0&&Math.random()<.3){const $e=Y[Math.floor(Math.random()*Y.length)];Ge.set(X,{date:$e,timeSlot:s.timeSlot});const le=Ue($e,s.timeSlot);let ke=-1;return v&&x.instructor_id&&le.includes(x.instructor_id)?ke=x.instructor_id:ke=le.length>0?le[Math.floor(Math.random()*le.length)]:-1,{...s,date:$e,proctorId:ke}}else if(Se===1){const $e=qe[Math.floor(Math.random()*qe.length)];Ge.set(X,{date:s.date,timeSlot:$e});const le=Ue(s.date,$e);let ke=-1;return v&&x.instructor_id&&le.includes(x.instructor_id)?ke=x.instructor_id:ke=le.length>0?le[Math.floor(Math.random()*le.length)]:-1,{...s,timeSlot:$e,proctorId:ke}}else if(Se===2){const $e=Te.length>0?Te[Math.floor(Math.random()*Te.length)]:"";return{...s,roomId:$e}}else{const $e=Ue(s.date,s.timeSlot);let le=-1;return v&&x.instructor_id&&$e.includes(x.instructor_id)?le=x.instructor_id:le=$e.length>0?$e[Math.floor(Math.random()*$e.length)]:-1,{...s,proctorId:le}}}return{...s}})},B=async()=>{var jt,it;const Ne=c.hours*60+c.minutes;let Ue=null,et=null;if(i.academic_year){const[oe,ve]=i.academic_year.split("|").map(We=>We.trim());Ue=oe??null,et=ve??null}const Ge=[...i.selectedExamDates].sort(),s=Ge.length>1?`${new Date(Ge[0]).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})} - ${new Date(Ge[Ge.length-1]).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})}`:new Date(Ge[0]).toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"});let x=[];try{x=(await g.get("/tbl_availability/",{params:{status:"available"}})).data}catch(oe){console.error("Error fetching availability:",oe),a.error("Failed to fetch proctor availability");return}const v={"7 AM - 1 PM (Morning)":["07:00","07:30","08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30"],"1 PM - 6 PM (Afternoon)":["13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30"],"6 PM - 9 PM (Evening)":["18:00","18:30","19:00","19:30","20:00","20:30"]},X=[...v["7 AM - 1 PM (Morning)"],...v["1 PM - 6 PM (Afternoon)"],...v["6 PM - 9 PM (Evening)"]];console.log("✅ Available time slots for scheduling:",X);const Se=new Map;x==null||x.forEach(oe=>{const ve=oe.user_id,We=oe.days||[],ot=oe.time_slots||[];We.forEach(nt=>{const st=nt.split("T")[0];ot.forEach(ct=>{(v[ct]||[]).forEach(pt=>{const gt=`${st}|${pt}`;Se.has(gt)||Se.set(gt,new Set),Se.get(gt).add(ve)})})})});const Te=(oe,ve)=>{const We=oe.split("T")[0],nt=me(ve,Ne).map(st=>{const ct=`${We}|${st}`;return Se.get(ct)||new Set});return nt.length===0?[]:Array.from(nt[0]).filter(st=>nt.every(ct=>ct.has(st)))},qe=new Map;q.forEach(oe=>qe.set(oe.room_id,oe.room_capacity));const $e=new Map;se.forEach(oe=>$e.set(oe.building_id,oe.building_name));const le=new Map;q.forEach(oe=>le.set(oe.room_id,oe.building_id));const ke=te[0],fe=de==null?void 0:de.find(oe=>oe.college_id===ke),Pe=(fe==null?void 0:fe.college_name)??"Unknown College",Ve=await _e(i.selectedModalities);if(Ve.size>0){const oe=Ve.size;a.error(`${oe} section${oe>1?"s are":" is"} already scheduled. Please deselect them.`,{autoClose:5e3});return}const Me=[],De=new Map;i.selectedModalities.forEach(oe=>{const ve=O.find(We=>We.modality_id===oe);if(ve){const We=pe.find(nt=>nt.program_id===ve.program_id&&nt.course_id===ve.course_id&&nt.section_name===ve.section_name),ot={...ve,is_night_class:(We==null?void 0:We.is_night_class)??null,instructor_id:(We==null?void 0:We.user_id)??null};Me.push(ot),De.set(oe,ot)}});const He=v["6 PM - 9 PM (Evening)"],at=v["7 AM - 1 PM (Morning)"],S=v["1 PM - 6 PM (Afternoon)"];console.log("🌅 Morning slots:",at),console.log("🌤️ Afternoon slots:",S),console.log("🌙 Evening slots:",He);const ae=(oe,ve)=>{if(!X.includes(oe))return!1;const[We,ot]=oe.split(":").map(Number),nt=We*60+ot+Ne,st=21*60;return nt>st?!1:ve?He.includes(oe):!0},Ie=X.filter(oe=>ae(oe,!1));console.log(`✅ Valid start times for day classes (${Ie.length} slots):`,Ie),console.log(`✅ Valid start times for night classes (${He.filter(oe=>ae(oe,!0)).length} slots):`,He.filter(oe=>ae(oe,!0)));const Oe=new Map;Me.forEach(oe=>{const ve=oe.enrolled_students??0,We=oe.possible_rooms??[],ot=Array.from(qe.entries()).filter(([rt,pt])=>pt>=ve).map(([rt,pt])=>rt).sort((rt,pt)=>{const gt=qe.get(rt)||0,yt=qe.get(pt)||0,Qe=Math.abs(gt-ve),dt=Math.abs(yt-ve);return Qe-dt}),nt=We.filter(rt=>ot.includes(rt)),st=ot.filter(rt=>!nt.includes(rt)),ct=[...nt,...st];Oe.set(oe.modality_id,ct),console.log(`📍 Section ${oe.modality_id} can use ${ct.length} rooms (${nt.length} preferred, ${st.length} others)`)});const Ae=[],Ye=Math.max(...Array.from(qe.values()));Me.forEach(oe=>{const ve=oe.enrolled_students??0;ve>Ye&&Ae.push(`Section ${oe.course_id} - ${oe.section_name} (${ve} students) exceeds maximum room capacity (${Ye})`),(Oe.get(oe.modality_id)||[]).length===0&&Ae.push(`Section ${oe.course_id} - ${oe.section_name} has no available rooms (needs capacity for ${ve} students)`)});const Ze=[];if(Ge.forEach(oe=>{const ve=oe.split("T")[0];let We=!1;for(const ot of Ie)if(Te(ve,ot).length>0){We=!0;break}if(!We){const ot=new Date(oe).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});Ze.push(ot)}}),Ze.length>0){const oe=Ze.join(", ");Ae.push(`No proctors available for: ${oe}

Please ensure proctors have set their availability for these specific dates and time slots.`)}if(Me.forEach(oe=>{if(oe.is_night_class==="YES"){const ve=He.filter(We=>{const[ot,nt]=We.split(":").map(Number);return ot*60+nt+Ne<=1260});if(ve.length===0&&Ae.push(`Night class ${oe.course_id} - ${oe.section_name} cannot be scheduled: exam duration (${Ne} min) too long for evening slots (must end by 9 PM)`),oe.instructor_id){let We=!1;for(const ot of Ge){const nt=ot.split("T")[0];for(const st of ve)if(Te(nt,st).includes(oe.instructor_id)){We=!0;break}if(We)break}We||Ae.push(`Night class ${oe.course_id} - ${oe.section_name}: Instructor (ID: ${oe.instructor_id}) has no evening availability`)}}}),Ae.length>0){alert(`Cannot generate schedule:

${Ae.join(`

`)}`);return}const Je=new Map,ze=new Map;Me.forEach(oe=>{const ve=oe.course_id;ze.has(ve)||ze.set(ve,[]),ze.get(ve).push(oe)}),Array.from(ze.keys()).forEach(oe=>{const ve=Ge[Math.floor(Math.random()*Ge.length)];Je.set(oe,ve)}),console.log("🧬 Starting genetic algorithm..."),console.log(`📊 Scheduling ${Me.length} sections across ${Ge.length} dates`),console.log(`⏰ Valid time slots: ${Ie.length} slots`),console.log(`🏫 Total rooms available: ${qe.size}`),a.info("Generating schedule... This may take a moment.",{autoClose:2e3});let xe=[];for(let oe=0;oe<50;oe++)xe.push(j(Me,Ge,Ie,He,Oe,Ne,Te,De,Je));let Fe=null,Le=-1/0;for(let oe=0;oe<100;oe++){oe%10===0&&await new Promise(st=>setTimeout(st,0));const ve=xe.map(st=>h(st,De,Ne,P,w)),We=ve.indexOf(Math.max(...ve));ve[We]>Le&&(Le=ve[We],Fe=xe[We],oe%20===0&&console.log(`Generation ${oe}: Best fitness = ${Le}`));const ot=[],nt=ve.map((st,ct)=>({fit:st,idx:ct})).sort((st,ct)=>ct.fit-st.fit).map(st=>st.idx);for(let st=0;st<5;st++)ot.push(xe[nt[st]].map(ct=>({...ct})));for(;ot.length<50;){const st=A(xe,ve),ct=A(xe,ve),[rt,pt]=he(st,ct);ot.push(p(rt,De,Ge,Ie,He,Oe,Te,.25)),ot.length<50&&ot.push(p(pt,De,Ge,Ie,He,Oe,Te,.25))}xe=ot}if(!Fe){alert("Could not find a valid schedule.");return}console.log(`✅ Evolution complete! Final best fitness: ${Le}`);const Ke=[],Xe=[],Be=new Map,_t=new Map,ht=new Map;for(const oe of Fe){const ve=De.get(oe.sectionId);if(!ve)continue;const{date:We,timeSlot:ot,roomId:nt,proctorId:st}=oe,ct=ve.course_id;if(!X.includes(ot)){console.error(`❌ Invalid time slot ${ot} for section ${ve.modality_id}`),Xe.push(`${ve.course_id} - ${ve.section_name} (invalid time slot: ${ot})`);continue}const[rt,pt]=ot.split(":").map(Number),gt=je(ot),yt=gt+Ne;if(yt>21*60){console.error(`❌ Exam would end after 21:00 for section ${ve.modality_id}`),Xe.push(`${ve.course_id} - ${ve.section_name} (would end after 9 PM)`);continue}if(!nt||st===-1){Xe.push(`${ve.course_id} - ${ve.section_name}`);continue}if(ht.has(ct)||ht.set(ct,new Set),ht.get(ct).add(We),ht.get(ct).size>1){console.warn(`⚠️ Course split across dates: ${ct}`),Xe.push(`${ve.course_id} - ${ve.section_name} (course split across multiple dates)`);continue}const Qe=R.find(Dt=>{const ks=new Date(Dt.start_date),Is=new Date(Dt.end_date);return new Date(We)>=ks&&new Date(We)<=Is});if(!Qe){Xe.push(`${ve.course_id} - ${ve.section_name} (no matching exam period)`);continue}const dt=rt+Math.floor((pt+Ne)/60),xt=(pt+Ne)%60,$t=`${String(dt).padStart(2,"0")}:${String(xt).padStart(2,"0")}`;let St=!1;const vt=`${We}|${nt}`,kt=Be.get(vt)||[];for(const Dt of kt)if(Ce(gt,yt,Dt.start,Dt.end)){console.warn("⚠️ Room overlap detected"),St=!0;break}const Tt=`${We}|${st}`,Mt=_t.get(Tt)||[];for(const Dt of Mt)if(Ce(gt,yt,Dt.start,Dt.end)){console.warn("⚠️ Proctor overlap detected"),St=!0;break}if(St){Xe.push(`${ve.course_id} - ${ve.section_name} (time overlap conflict)`);continue}Be.has(vt)||Be.set(vt,[]),Be.get(vt).push({start:gt,end:yt,course:ve.course_id,section:ve.section_name}),_t.has(Tt)||_t.set(Tt,[]),_t.get(Tt).push({start:gt,end:yt,course:ve.course_id,section:ve.section_name});const mt=`${We}T${ot}:00`,Pt=`${We}T${$t}:00`,Yt=pe.find(Dt=>Dt.program_id===ve.program_id&&Dt.course_id===ve.course_id&&Dt.section_name===ve.section_name),$s=(Yt==null?void 0:Yt.user_id)??null,ts=le.get(nt),Ds=ts?$e.get(ts):"Unknown Building";if(!nt||nt.trim()===""){console.error(`❌ Empty room_id for section ${ve.modality_id}`),Xe.push(`${ve.course_id} - ${ve.section_name} (no available room)`);continue}Ke.push({program_id:ve.program_id,course_id:ve.course_id,modality_id:ve.modality_id,room_id:nt,section_name:ve.section_name,proctor_id:st,examperiod_id:Qe.examperiod_id,exam_date:We,exam_start_time:mt,exam_end_time:Pt,exam_duration:N,academic_year:Ue,semester:et,exam_category:i.exam_category??null,exam_period:s,college_name:Pe,building_name:`${Ds} (${ts})`,instructor_id:$s,proctor_timein:null,proctor_timeout:null})}if(Xe.length>0){const oe=`Could not schedule ${Xe.length} section(s):

${Xe.slice(0,10).join(`
`)}${Xe.length>10?`
... and ${Xe.length-10} more`:""}

Scheduled: ${Ke.length}/${Me.length} sections`;if(Ke.length===0){alert(oe+`

No schedules to save. Please adjust constraints or add more resources.`);return}if(!globalThis.confirm(oe+`

Do you want to save the partial schedule?`))return}const wt=Ke.filter(oe=>!oe.room_id||oe.room_id.trim()==="");if(wt.length>0){console.error("❌ Found schedules with empty room_id:",wt),alert(`Error: ${wt.length} schedule(s) have no room assigned. Cannot save.`);return}if(Ke.length===0){alert("No valid schedules to save. Please adjust constraints.");return}console.log(`💾 Saving ${Ke.length} exam schedules...`),console.log("📊 Time slot distribution:",Ke.reduce((oe,ve)=>{const We=ve.exam_start_time.slice(11,16);return oe[We]=(oe[We]||0)+1,oe},{}));try{await g.post("/tbl_examdetails",Ke),a.success(`Successfully scheduled ${Ke.length}/${Me.length} sections!`),console.log(`✅ Successfully saved ${Ke.length} exam schedules`),l&&setTimeout(()=>{l()},1e3)}catch(oe){console.error("Database error:",oe);const ve=((it=(jt=oe.response)==null?void 0:jt.data)==null?void 0:it.error)||oe.message||"Unknown error";alert("Error saving schedule: "+ve)}},re=async()=>{if(!i.selectedPrograms.length||!i.selectedCourses.length||!i.selectedModalities.length){alert("Please complete program, course, and modality selection.");return}if(!i.selectedExamDates.length){alert("Please select at least one exam date.");return}b(!0);try{await B()}finally{b(!1)}},Z=d=>{const{name:_,value:Y}=d.target;typeof _>"u"||F(ye=>({...ye,[_]:Y}))},we=d=>e.jsxs(rs.Option,{...d,children:[e.jsx("input",{type:"checkbox",checked:d.isSelected,onChange:()=>null})," ",e.jsx("label",{children:d.label})]}),Re=(d,_="Select All")=>[{value:"__all__",label:_},...d];return e.jsxs("div",{className:"scheduler-container",children:[e.jsx("h2",{className:"scheduler-header",children:"Generate Schedule"}),e.jsxs("div",{className:"main-content-layout",children:[e.jsxs("div",{className:"form-column",children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{className:"label",children:"Academic Year & Semester"}),e.jsx(qt,{name:"academic_year",value:i.academic_year?{value:i.academic_year,label:i.academic_year}:null,onChange:d=>Z({target:{name:"academic_year",value:d?d.value:""}}),options:be.map(d=>({value:d.value,label:d.label})),placeholder:"Select or type Academic Year & Semester",classNamePrefix:"select",isClearable:!0,formatCreateLabel:d=>`Use custom value: "${d}"`})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{className:"label",children:"Exam Term"}),e.jsx(qt,{name:"exam_category",value:i.exam_category?{value:i.exam_category,label:i.exam_category}:null,onChange:d=>Z({target:{name:"exam_category",value:d?d.value:""}}),options:z.map(d=>({value:d,label:d})),placeholder:"Select or type Exam Term",classNamePrefix:"select",isClearable:!0,formatCreateLabel:d=>`Use custom value: "${d}"`})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{className:"label",children:"Select Exam Dates"}),e.jsx(lt,{options:Re(G.map(d=>({value:d.iso,label:d.label}))),isMulti:!0,closeMenuOnSelect:!1,hideSelectedOptions:!1,components:{Option:we},onChange:d=>{let _=d.map(Y=>Y.value);_.includes("__all__")&&(_=[...G.map(Y=>Y.iso)]),F(Y=>({...Y,selectedExamDates:_.filter(ye=>ye!=="__all__")}))},value:i.selectedExamDates.map(d=>{const _=G.find(Y=>Y.iso===d);return{value:d,label:(_==null?void 0:_.label)??d}})})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{className:"label",children:"Program"}),e.jsx(lt,{options:Re(P.map(d=>({value:d.program_id,label:`${d.program_id} | ${d.program_name}`}))),isMulti:!0,closeMenuOnSelect:!1,hideSelectedOptions:!1,components:{Option:we},onChange:d=>{let _=d.map(Y=>Y.value);_.includes("__all__")&&(_=[...P.map(Y=>Y.program_id)]),F(Y=>({...Y,selectedPrograms:_.filter(ye=>ye!=="__all__"),selectedCourses:[],selectedModalities:[]}))},value:i.selectedPrograms.map(d=>{const _=P.find(Y=>Y.program_id===d);return{value:d,label:_?`${_.program_id} | ${_.program_name}`:d}})})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{className:"label",children:"Course"}),e.jsx(lt,{options:Re(y.map(d=>({value:d.course_id,label:`${d.course_id} | ${d.course_name}`}))),isMulti:!0,closeMenuOnSelect:!1,hideSelectedOptions:!1,components:{Option:we},onChange:d=>{let _=d.map(Y=>Y.value);_.includes("__all__")&&(_=[...y.map(Y=>Y.course_id)]),F(Y=>({...Y,selectedCourses:_.filter(ye=>ye!=="__all__"),selectedModalities:[]}))},value:i.selectedCourses.map(d=>{const _=y.find(Y=>Y.course_id===d);return{value:d,label:_?_.course_id:d}}),styles:{valueContainer:d=>({...d,maxHeight:"120px",overflowY:"auto"})}})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{className:"label",children:"Modality"}),e.jsx(lt,{options:Re(I.map(d=>({value:d.modality_id,label:`${d.modality_type}${d.section_name?` – ${d.section_name}`:""}`}))),isMulti:!0,closeMenuOnSelect:!1,hideSelectedOptions:!1,components:{Option:we},onChange:d=>{let _=d.map(Y=>Y.value);_.includes("__all__")?_=[...I.map(Y=>Y.modality_id)]:_=[...I.map(Y=>Y.modality_id)],F(Y=>({...Y,selectedModalities:_.filter(ye=>ye!=="__all__")}))},value:i.selectedModalities.map(d=>{const _=I.find(Y=>Y.modality_id===d);return{value:d,label:_?`${_.modality_type}${_.section_name?` – ${_.section_name}`:""}`:String(d)}}),styles:{valueContainer:d=>({...d,maxHeight:"120px",overflowY:"auto"})}})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{className:"label",children:"Exam Duration"}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx(qt,{value:c.hours?{value:c.hours,label:`${c.hours} hr`}:null,onChange:d=>U(_=>({..._,hours:Number((d==null?void 0:d.value)||0)})),options:[...Array(6)].map((d,_)=>({value:_,label:`${_} hour${_!==1?"s":""}`})),placeholder:"Hours",classNamePrefix:"select",isClearable:!0}),e.jsx(qt,{value:c.minutes?{value:c.minutes,label:`${c.minutes} min`}:null,onChange:d=>U(_=>({..._,minutes:Number((d==null?void 0:d.value)||0)})),options:[0,15,30,45].map(d=>({value:d,label:`${d} min`})),placeholder:"Minutes",classNamePrefix:"select",isClearable:!0})]})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{className:"label",children:"Exam Start Time"}),e.jsx(qt,{value:u?{value:u,label:u}:{value:"07:00",label:"07:00"},onChange:d=>V(d?d.value:""),options:J.map(d=>({value:d,label:d})),placeholder:"Select or type time",classNamePrefix:"select",isClearable:!0,formatCreateLabel:d=>`Use custom time: "${d}"`})]})]}),e.jsxs("div",{className:"preview-column",children:[e.jsxs("h3",{className:"preview-header",children:["Selected Modality Preview (",i.selectedModalities.length,")"]}),e.jsx("input",{type:"text",placeholder:"Search within selected modalities",value:n,onChange:d=>f(d.target.value),className:"input preview-search-input"}),i.selectedModalities.length>0?e.jsx("div",{className:"modality-list",children:i.selectedModalities.map(d=>{const _=I.find(Ee=>Ee.modality_id===d),Y=y.find(Ee=>Ee.course_id===(_==null?void 0:_.course_id)),ye=[Y==null?void 0:Y.course_id,_==null?void 0:_.section_name,_==null?void 0:_.modality_type].join(" ").toLowerCase();return{modality:_,course:Y,searchString:ye,modalityId:d}}).filter(d=>!n||d.searchString.includes(n.toLowerCase())).map(({modality:d,course:_,modalityId:Y})=>e.jsxs("div",{className:"modality-item",children:[e.jsxs("p",{className:"modality-detail",children:["Course: ",_?_.course_id:"N/A"]}),e.jsxs("p",{className:"modality-detail",children:["Section: ",(d==null?void 0:d.section_name)??"N/A"]}),e.jsxs("p",{className:"modality-detail",children:["Modality Type: ",(d==null?void 0:d.modality_type)??"N/A"]}),e.jsxs("p",{className:"modality-detail",children:["Remarks: ",(d==null?void 0:d.modality_remarks)??"N/A"]}),e.jsx("hr",{className:"modality-divider"})]},Y))}):e.jsx("p",{className:"helper",children:"Select one or more modalities to see a preview."})]})]}),e.jsx("div",{className:"save-button-wrapper",children:e.jsx("button",{type:"button",onClick:re,className:"btn-save",disabled:r,style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",fontSize:"20px",width:"45px"},children:r?e.jsx(Ts,{className:"spin"}):e.jsx(Ps,{})})}),e.jsx(ft,{position:"top-center",autoClose:3e3})]})},Ra=({onClose:o,collegeName:l,user:i,approvalStatus:F,examData:R=[]})=>{const[C,O]=t.useState([]),[ee,P]=t.useState([]),[ie,ne]=t.useState(""),[ce,H]=t.useState(!1),[Q,pe]=t.useState({});t.useEffect(()=>{(async()=>{try{if(!(i!=null&&i.user_id))return;if(console.log("🔍 SmsSender - Approval Status:",F),console.log("📊 SmsSender - Exam Data Count:",(R==null?void 0:R.length)||0),console.log("🏛️ SmsSender - College Name:",l),F==="approved"&&R&&R.length>0){console.log("✅ Loading proctors from APPROVED schedule for college:",l);const f=R.filter(E=>E.college_name===l);if(console.log(`🔍 Filtered to ${f.length} exams for college: ${l}`),f.length===0){console.warn("⚠️ No exams found for this college in approved schedule"),a.warn(`No exams found for ${l} in the approved schedule`),O([]);return}const r=Array.from(new Set(f.map(E=>E.proctor_id).filter(Boolean)));if(console.log(`👥 Proctor IDs from ${l}:`,r),r.length===0){a.warn(`No proctors assigned in the approved schedule for ${l}`),O([]);return}const W=(await g.get("/users/")).data.filter(E=>r.includes(E.user_id));console.log(`✅ Found ${W.length} proctor users for ${l}:`,W.map(E=>`${E.first_name} ${E.last_name}`)),O(W);const q={};W.forEach(E=>{const se=f.filter(k=>k.proctor_id===E.user_id);q[E.user_id]=se.map(k=>({exam_date:k.exam_date,exam_start_time:k.exam_start_time,exam_end_time:k.exam_end_time,room_id:k.room_id,building_name:k.building_name,course_id:k.course_id,section_name:k.section_name})),console.log(`📅 ${E.first_name} ${E.last_name}: ${q[E.user_id].length} exam(s) for ${l}`)}),pe(q)}else{console.log("⚠️ Using fallback: Loading all proctors from college");const r=(await g.get("/tbl_user_role",{params:{user_id:i.user_id,role_id:3}})).data;if(!r||r.length===0){a.error("No scheduler role found");return}const b=r.map(k=>k.college_id).filter(Boolean),q=(await g.get("/tbl_user_role",{params:{role_id:5}})).data.filter(k=>b.includes(k.college_id)).map(k=>k.user_id);if(q.length===0){O([]),a.warn("No proctors found under your college");return}const se=(await g.get("/users/")).data.filter(k=>q.includes(k.user_id));O(se||[])}}catch(f){console.error("Error loading users:",f),a.error("Failed to load users")}})()},[i,F,R,l]);const D=n=>{const f=n.slice(11,16),[r,b]=f.split(":");let L=Number(r);const W=L>=12?"PM":"AM";return L=L%12||12,`${L}:${b} ${W}`},te=n=>new Date(n).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),ge=n=>{const f=Q[n.user_id]||[],r=i?`${i.first_name||""} ${i.middle_name?i.middle_name+" ":""}${i.last_name||""}`.trim():"Scheduler";if(f.length===0){let L=`Hi ${n.first_name},

`;return L+=`You have been assigned as a proctor for ${l}.

`,ie.trim()&&(L+=`${ie}

`),L+=`- ${r}`,L}let b=`Hi ${n.first_name},

`;return b+=`You are assigned as proctor for:

`,f.forEach((L,W)=>{b+=`${W+1}. ${L.course_id}-${L.section_name}
`,b+=`${te(L.exam_date)}, ${D(L.exam_start_time)}-${D(L.exam_end_time)}
`,b+=`Room: ${L.room_id}, ${L.building_name}

`}),ie.trim()&&(b+=`Note: ${ie}

`),b+=`Please arrive 15 mins early.

- ${r}, ${l}`,b},w=async()=>{var f,r;if(ee.length===0){a.warn("Please select at least one user");return}const n=ee.filter(b=>!b.contact_number);if(n.length>0){a.error(`${n.length} proctor(s) don't have contact numbers!`);return}H(!0);try{const b=ee.map(E=>{var k;const se=ge(E);return console.log(`Preparing SMS for ${E.first_name} ${E.last_name}`),console.log(`   Number: ${E.contact_number}`),console.log(`   Schedules: ${((k=Q[E.user_id])==null?void 0:k.length)||0}`),console.log(`   Message length: ${se.length} chars`),{user_id:E.user_id,contact_number:E.contact_number,name:`${E.first_name} ${E.last_name}`,message:se}});console.log(`📬 Sending ${b.length} real SMS messages...`);const L=await g.post("/send-proctor-sms/",{sms_list:b,sender_id:i==null?void 0:i.user_id}),{sent_count:W,failed_sms:q}=L.data;W>0&&(a.success(`Successfully sent ${W} SMS message(s)!`),console.log(`✅ Successfully sent ${W} SMS messages`)),q&&q.length>0&&(console.error("❌ Failed SMS:",q),a.warn(`${q.length} SMS message(s) failed to send`),q.forEach(E=>{console.error(`   - ${E.name} (${E.contact_number}): ${E.reason}`)})),W===b.length&&o()}catch(b){console.error("Error sending SMS:",b),a.error(((r=(f=b==null?void 0:b.response)==null?void 0:f.data)==null?void 0:r.error)||"Failed to send SMS messages")}finally{H(!1)}},M=C.map(n=>({value:n.user_id,label:`${n.first_name} ${n.last_name}${n.contact_number?` - ${n.contact_number}`:" (No number)"}${Q[n.user_id]?` (${Q[n.user_id].length} exam${Q[n.user_id].length>1?"s":""})`:""}`,user:n}));return e.jsxs("div",{className:"message-sender-container",children:[e.jsxs("div",{className:"message-sender-header",children:[e.jsx("h3",{children:F==="approved"?"Send Approved Schedule via SMS":"Send SMS to Proctors"}),F==="approved"&&e.jsx("p",{style:{fontSize:"12px",color:"#666",marginTop:"5px"},children:"Schedule approved - SMS will be sent to proctors with their exam schedules."})]}),e.jsxs("div",{className:"message-sender-body",children:[e.jsxs("div",{className:"message-section",children:[e.jsx("label",{children:"Select Proctors:"}),e.jsx(lt,{options:[{value:"select_all",label:"- Select All -"},...M],isMulti:!0,closeMenuOnSelect:!1,hideSelectedOptions:!1,onChange:n=>{if(!n){P([]);return}const f=n[n.length-1];if((f==null?void 0:f.value)==="select_all")ee.length<C.length?P(C):P([]);else{const r=n.filter(b=>b.value!=="select_all").map(b=>b.user);P(r)}},value:[...ee.length===C.length&&C.length>0?[{value:"select_all",label:"- Select All -"}]:[],...ee.map(n=>({value:n.user_id,label:`${n.first_name} ${n.last_name}${n.contact_number?` - ${n.contact_number}`:" (No number)"}${Q[n.user_id]?` (${Q[n.user_id].length} exam${Q[n.user_id].length>1?"s":""})`:""}`,user:n}))],styles:{valueContainer:n=>({...n,maxHeight:"120px",overflowY:"auto"})}})]}),e.jsxs("div",{className:"message-section",children:[e.jsx("label",{children:"Additional Message (Optional):"}),e.jsx("textarea",{value:ie,onChange:n=>ne(n.target.value),placeholder:F==="approved"?"Add any additional instructions or notes...":"Enter your SMS message here...",rows:6,maxLength:320}),e.jsxs("div",{className:"char-count",children:[ie.length,"/320 characters"]}),F==="approved"&&e.jsx("p",{style:{fontSize:"11px",color:"#666",marginTop:"5px"},children:"Note: Real SMS will be sent via ITExmo with personalized exam schedules"})]})]}),e.jsxs("div",{className:"message-sender-footer",children:[e.jsx("button",{type:"button",onClick:o,className:"btn-cancel",children:"Cancel"}),e.jsx("button",{type:"button",onClick:w,className:"btn-send",disabled:ce||ee.length===0,children:ce?"Sending SMS...":`Send SMS to ${ee.length} proctor(s)`})]})]})},Ma=({onClose:o,collegeName:l,user:i,approvalStatus:F,examData:R=[]})=>{const[C,O]=t.useState([]),[ee,P]=t.useState([]),[ie,ne]=t.useState(""),[ce,H]=t.useState(""),[Q,pe]=t.useState(!1),[D,te]=t.useState({});t.useEffect(()=>{(async()=>{try{if(!(i!=null&&i.user_id))return;if(console.log("🔍 EmailSender - Approval Status:",F),console.log("📊 EmailSender - Exam Data Count:",(R==null?void 0:R.length)||0),console.log("🏛️ EmailSender - College Name:",l),F==="approved"&&R&&R.length>0){console.log("✅ Loading proctors from APPROVED schedule for college:",l);const b=R.filter(k=>k.college_name===l);if(console.log(`🔍 Filtered to ${b.length} exams for college: ${l}`),b.length===0){console.warn("⚠️ No exams found for this college in approved schedule"),a.warn(`No exams found for ${l} in the approved schedule`),O([]);return}const L=Array.from(new Set(b.map(k=>k.proctor_id).filter(Boolean)));if(console.log(`👥 Proctor IDs from ${l}:`,L),L.length===0){a.warn(`No proctors assigned in the approved schedule for ${l}`),O([]);return}const E=(await g.get("/users/")).data.filter(k=>L.includes(k.user_id));console.log(`✅ Found ${E.length} proctor users for ${l}:`,E.map(k=>`${k.first_name} ${k.last_name}`)),O(E);const se={};E.forEach(k=>{const de=b.filter($=>$.proctor_id===k.user_id);se[k.user_id]=de.map($=>({exam_date:$.exam_date,exam_start_time:$.exam_start_time,exam_end_time:$.exam_end_time,room_id:$.room_id,building_name:$.building_name,course_id:$.course_id,section_name:$.section_name})),console.log(`📅 ${k.first_name} ${k.last_name}: ${se[k.user_id].length} exam(s) for ${l}`)}),te(se)}else{console.log("⚠️ Using fallback: Loading all proctors from college");const L=(await g.get("/tbl_user_role",{params:{user_id:i.user_id,role_id:3}})).data;if(!L||L.length===0){a.error("No scheduler role found");return}const W=L.map($=>$.college_id).filter(Boolean),se=(await g.get("/tbl_user_role",{params:{role_id:5}})).data.filter($=>W.includes($.college_id)).map($=>$.user_id);if(se.length===0){O([]),a.warn("No proctors found under your college");return}const de=(await g.get("/users/")).data.filter($=>se.includes($.user_id));O(de||[])}}catch(b){console.error("Error loading users:",b),a.error("Failed to load users")}})()},[i,F,R]);const ge=r=>{const b=r.slice(11,16),[L,W]=b.split(":");let q=Number(L);const E=q>=12?"PM":"AM";return q=q%12||12,`${q}:${W} ${E}`},w=r=>new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),M=r=>{const b=D[r.user_id]||[],L=i?`${i.first_name||""} ${i.middle_name?i.middle_name+" ":""}${i.last_name||""}`.trim():"Scheduler",W=(i==null?void 0:i.email_address)||"";if(b.length===0)return`Dear ${r.first_name} ${r.last_name},

You have been assigned as a proctor for ${l}.

${ce}`;let q=`Dear ${r.first_name} ${r.last_name},

`;return q+=`You have been assigned as a proctor for the following examination schedule(s) at ${l}:

`,b.forEach((E,se)=>{q+=`${se+1}. ${E.course_id} - ${E.section_name}
`,q+=`   Date: ${w(E.exam_date)}
`,q+=`   Time: ${ge(E.exam_start_time)} - ${ge(E.exam_end_time)}
`,q+=`   Room: ${E.room_id}, ${E.building_name}

`}),ce.trim()&&(q+=`
Additional Message:
${ce}

`),q+=`Please ensure you arrive at least 15 minutes before the exam starts.

`,q+=`Best regards,
${L}
Scheduler, ${l}
${W}`,q},n=async()=>{var b,L;if(ee.length===0){a.warn("Please select at least one user");return}if(!ee.every(W=>W.email_address)){a.error("Some proctors don't have email addresses!");return}const r=ie.trim()||(F==="approved"?`Proctoring Assignment - ${l}`:"Notification from Scheduler");pe(!0);try{const W=ee.map(k=>{var $;const de=M(k);return console.log(`Preparing email for ${k.first_name} ${k.last_name}`),console.log(`   Email: ${k.email_address}`),console.log(`   Schedules: ${(($=D[k.user_id])==null?void 0:$.length)||0}`),{user_id:k.user_id,email:k.email_address,name:`${k.first_name} ${k.last_name}`,subject:r,message:de}});console.log(`📬 Sending ${W.length} real Gmail emails...`);const q=await g.post("/send-proctor-emails/",{emails:W,sender_id:i==null?void 0:i.user_id}),{sent_count:E,failed_emails:se}=q.data;E>0&&(a.success(`Successfully sent ${E} email(s) to Gmail!`),console.log(`Successfully sent ${E} Gmail emails`)),se&&se.length>0&&(console.error("❌ Failed emails:",se),a.warn(`${se.length} email(s) failed to send`),se.forEach(k=>{console.error(`   - ${k.name} (${k.email}): ${k.reason}`)})),E===W.length&&o()}catch(W){console.error("Error sending emails:",W),a.error(((L=(b=W==null?void 0:W.response)==null?void 0:b.data)==null?void 0:L.error)||"Failed to send emails")}finally{pe(!1)}},f=C.map(r=>({value:r.user_id,label:`${r.first_name} ${r.last_name}${r.email_address?` - ${r.email_address}`:" (No email)"}${D[r.user_id]?` (${D[r.user_id].length} exam${D[r.user_id].length>1?"s":""})`:""}`,user:r}));return e.jsxs("div",{className:"message-sender-container",children:[e.jsxs("div",{className:"message-sender-header",children:[e.jsx("h3",{children:F==="approved"?"Send Approved Schedule to Proctors":"Send Email to Proctors"}),F==="approved"&&e.jsx("p",{style:{fontSize:"12px",color:"#666",marginTop:"5px"},children:"Schedule approved - Emails will be sent to proctors."})]}),e.jsxs("div",{className:"message-sender-body",children:[e.jsxs("div",{className:"message-section",children:[e.jsx("label",{children:"Select Proctors:"}),e.jsx(lt,{options:[{value:"select_all",label:"- Select All -"},...f],isMulti:!0,closeMenuOnSelect:!1,hideSelectedOptions:!1,onChange:r=>{if(!r){P([]);return}const b=r[r.length-1];if((b==null?void 0:b.value)==="select_all")ee.length<C.length?P(C):P([]);else{const L=r.filter(W=>W.value!=="select_all").map(W=>W.user);P(L)}},value:[...ee.length===C.length?[{value:"select_all",label:"- Select All -"}]:[],...ee.map(r=>({value:r.user_id,label:`${r.first_name} ${r.last_name}${r.email_address?` - ${r.email_address}`:" (No email)"}${D[r.user_id]?` (${D[r.user_id].length} exam${D[r.user_id].length>1?"s":""})`:""}`,user:r}))],styles:{valueContainer:r=>({...r,maxHeight:"120px",overflowY:"auto"})}})]}),e.jsxs("div",{className:"message-section",children:[e.jsx("label",{children:"Subject:"}),e.jsx("input",{type:"text",value:ie,onChange:r=>ne(r.target.value),placeholder:F==="approved"?`Proctoring Assignment - ${l}`:"Enter email subject...",className:"subject-input"}),e.jsx("label",{children:"Additional Message (Optional):"}),e.jsx("textarea",{value:ce,onChange:r=>H(r.target.value),placeholder:F==="approved"?"Add any additional instructions or notes...":"Enter your email content...",rows:6}),e.jsxs("div",{className:"char-count",children:[ce.length," characters"]}),F==="approved"&&e.jsx("p",{style:{fontSize:"11px",color:"#666",marginTop:"5px"},children:"Note: Real Gmail emails will be sent with personalized exam schedules"})]})]}),e.jsxs("div",{className:"message-sender-footer",children:[e.jsx("button",{type:"button",onClick:o,className:"btn-cancel",children:"Cancel"}),e.jsx("button",{type:"button",onClick:n,className:"btn-send",disabled:Q||ee.length===0,children:Q?"Sending to Gmail...":`Send to ${ee.length} Gmail address(es)`})]})]})},Ea=({onClose:o,collegeName:l,user:i,filteredExamData:F,getUserName:R,examPeriodName:C,termName:O,semesterName:ee,yearName:P,buildingName:ie})=>{const[ne,ce]=t.useState(""),[H,Q]=t.useState(!1),[pe,D]=t.useState(null),[te,ge]=t.useState(null);t.useEffect(()=>{(async()=>{if(i!=null&&i.user_id)try{console.log("🔍 Fetching dean for user:",i.user_id);const n=await g.get("/tbl_user_role",{params:{user_id:i.user_id,role_id:3}});if(console.log("📋 Scheduler roles:",n.data),!n.data||n.data.length===0){console.error("❌ No scheduler role found"),D("No College Assigned");return}const f=n.data[0].college_id;console.log("🏛️ Scheduler's college ID:",f);const r=await g.get("/tbl_user_role",{params:{college_id:f,role_id:1}});if(console.log("👔 Dean roles:",r.data),!r.data||r.data.length===0){console.error("❌ No dean found for college"),D("No Dean Assigned");return}const b=r.data[0];ge(b.user_id);const L=await g.get(`/users/${b.user_id}/`);console.log("👤 Dean user data:",L.data);const W=L.data;D(`${W.first_name} ${W.last_name}`)}catch(n){console.error("❌ Error fetching dean info:",n),D("Error Loading Dean")}})()},[i]);const w=async()=>{var M,n,f,r,b,L,W,q,E,se;if(!(i!=null&&i.user_id)){a.error("User not found");return}if(!l||l==="Add schedule first"){a.error("College information is missing");return}if(F.length===0){a.warn("No schedules to send"),console.log("📊 Debug - filteredExamData:",F);return}if(!te){a.error("Dean not found for your college");return}Q(!0);try{console.log("📤 Sending schedule to dean..."),console.log("👤 User ID:",i.user_id),console.log("👔 Dean User ID:",te),console.log("📋 College:",l),console.log("📚 Total schedules:",F.length);const k=F.filter(c=>c.course_id&&c.exam_date&&c.exam_start_time&&c.exam_end_time&&c.room_id);if(k.length===0){a.error("All schedules are incomplete");return}k.length<F.length&&a.warn(`${F.length-k.length} incomplete schedules will be skipped`);const de={user_id:i.user_id,college_name:l,exam_period:C||"Not specified",term:O||"Not specified",semester:ee||"Not specified",academic_year:P||"Not specified",building:ie||"Not specified",remarks:ne||"No remarks",schedules:k.map(c=>({course_id:c.course_id,section_name:c.section_name||"N/A",exam_date:c.exam_date,exam_start_time:c.exam_start_time,exam_end_time:c.exam_end_time,room_id:c.room_id,building_name:c.building_name||ie,instructor:R(c.instructor_id),proctor:R(c.proctor_id)}))};console.log("📦 Payload:",{user_id:de.user_id,college_name:de.college_name,total_schedules:de.schedules.length,first_schedule:de.schedules[0]});const $=await g.post("/send_schedule_to_dean/",de);console.log("✅ Response:",$.data),a.success(`Schedule sent successfully! (${k.length} exams sent to ${$.data.dean_name||"dean"})`),setTimeout(()=>{o()},1500)}catch(k){console.error("❌ Error sending to dean:",k),console.error("❌ Error response:",(M=k.response)==null?void 0:M.data),console.error("❌ Error status:",(n=k.response)==null?void 0:n.status);let de="Failed to send to dean";((f=k.response)==null?void 0:f.status)===401?de="Authentication error. Please log in again.":((r=k.response)==null?void 0:r.status)===404?de=((L=(b=k.response)==null?void 0:b.data)==null?void 0:L.error)||"Dean or college not found":(q=(W=k.response)==null?void 0:W.data)!=null&&q.error?de=k.response.data.error:(se=(E=k.response)==null?void 0:E.data)!=null&&se.detail?de=k.response.data.detail:k.message&&(de=k.message),a.error(de)}finally{Q(!1)}};return e.jsxs("div",{className:"message-sender-container",children:[e.jsx("div",{className:"message-sender-header",children:e.jsx("h3",{children:"Send Schedule to Dean"})}),e.jsxs("div",{className:"message-sender-body",children:[e.jsxs("div",{className:"summary-box",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Dean:"})," ",pe||"Loading..."]}),e.jsxs("p",{children:[e.jsx("strong",{children:"College:"})," ",l]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total Exams:"})," ",F.length]}),F.length===0&&e.jsx("p",{style:{color:"orange",marginTop:"10px",fontSize:"14px"},children:"⚠️ No schedules available"}),F.length>0&&(()=>{const M=F.filter(n=>!n.course_id||!n.exam_date||!n.exam_start_time||!n.exam_end_time||!n.room_id);return M.length>0?e.jsxs("p",{style:{color:"orange",marginTop:"10px",fontSize:"14px"},children:["⚠️ ",M.length," incomplete schedule(s) will be skipped"]}):null})()]}),e.jsxs("div",{className:"message-section",style:{marginTop:"15px"},children:[e.jsx("label",{children:"Remarks (optional):"}),e.jsx("textarea",{value:ne,onChange:M=>ce(M.target.value),placeholder:"Add remarks for the dean...",rows:6})]})]}),e.jsxs("div",{className:"message-sender-footer",children:[e.jsx("button",{type:"button",onClick:o,className:"btn-cancel",children:"Cancel"}),e.jsx("button",{type:"button",onClick:w,className:"btn-send",disabled:H||!te||F.length===0,children:H?"Sending...":"Send to Dean"})]})]})},Ta=({onClose:o,collegeName:l})=>{const[i,F]=t.useState(!1),[R,C]=t.useState(0),[O,ee]=t.useState("ALL"),[P,ie]=t.useState(""),[ne,ce]=t.useState([]),H=t.useRef(!1);t.useEffect(()=>{const n=Array.from(document.querySelectorAll(".scheduler-view-card")).map(f=>{var r,b;return(b=(r=f.textContent)==null?void 0:r.match(/\b[A-Za-z]+\s\d{1,2},\s\d{4}/))==null?void 0:b[0]}).filter(f=>!!f);ce([...new Set(n)])},[]);const Q=()=>{H.current=!0,D(),F(!1),a.warn("Export stopped.")},pe=()=>{const M=document.querySelectorAll(".scheduler-view-card");return O==="SPECIFIC"&&P!==""?Array.from(M).filter(n=>{var f;return(f=n.textContent)==null?void 0:f.includes(P)}):Array.from(M)},D=()=>{document.querySelectorAll(".scheduler-view-card").forEach(M=>{M.classList.remove("export-mode")})},te=async()=>{H.current=!1;const M=pe();if(M.length===0)return a.error("No schedule found for the selected date.");F(!0),C(0),a.info("Generating PDF...");try{const n=new Fs({orientation:"portrait",unit:"mm",format:"a4"}),f=n.internal.pageSize.getWidth(),r=n.internal.pageSize.getHeight();for(let b=0;b<M.length;b++){if(H.current)return D();const L=M[b];L.classList.add("export-mode"),await new Promise(E=>setTimeout(E,60));const q=(await Bs(L,{scale:2})).toDataURL("image/jpeg",.92);b>0&&n.addPage(),n.addImage(q,"JPEG",5,5,f-10,r-10),C(Math.round((b+1)/M.length*100))}n.save(`${l}_Schedule.pdf`),a.success("PDF exported successfully!"),o()}catch{a.error("Failed to export PDF")}finally{D(),F(!1)}},ge=async()=>{H.current=!1;const M=pe();if(M.length===0)return a.error("No schedule found for the selected date.");F(!0),C(0),a.info("Generating Word document...");try{const n=[];for(let b=0;b<M.length;b++){if(H.current)return;M[b].querySelectorAll("table.exam-table").forEach(W=>{const q=[];W.querySelectorAll("tr").forEach(se=>{const k=Array.from(se.querySelectorAll("th, td")).map(de=>{var $;return new Us({children:[new Os({text:(($=de.textContent)==null?void 0:$.trim())||"",alignment:zs.CENTER})],borders:{top:{style:Kt.SINGLE,size:1},bottom:{style:Kt.SINGLE,size:1},left:{style:Kt.SINGLE,size:1},right:{style:Kt.SINGLE,size:1}},width:{size:100,type:cs.PERCENTAGE}})});q.push(new Ys({children:k}))}),n.push(new qs({rows:q,width:{size:100,type:cs.PERCENTAGE}}))}),C(Math.round((b+1)/M.length*100)),await new Promise(W=>setTimeout(W,60))}const f=new Hs({sections:[{children:n}]}),r=await Ws.toBlob(f);Gs.saveAs(r,`${l}_Schedule.docx`),a.success("Word exported successfully!"),o()}catch{a.error("Failed to export Word")}finally{D(),F(!1)}},w=async()=>{H.current=!1;const M=pe();if(M.length===0)return a.error("No schedule found for the selected date.");F(!0),C(0),a.info("Generating Excel file...");try{const n=tt.book_new();for(let f=0;f<M.length;f++){if(H.current)return;const r=M[f].querySelectorAll("table.exam-table"),b=[];r.forEach(L=>{L.querySelectorAll("tr").forEach(W=>{const q=W.querySelectorAll("td, th");b.push(Array.from(q).map(E=>{var se;return((se=E.textContent)==null?void 0:se.trim())||""}))})}),tt.book_append_sheet(n,tt.aoa_to_sheet(b),`Page_${f+1}`),C(Math.round((f+1)/M.length*100))}It(n,`${l}_Schedule.xlsx`),a.success("Excel exported successfully!"),o()}catch{a.error("Failed to export Excel")}finally{D(),F(!1)}};return e.jsxs("div",{className:"export-container",children:[e.jsx("h2",{className:"export-title",children:"Export Schedule"}),e.jsxs("div",{className:"export-options",children:[e.jsxs("label",{className:"radio",children:[e.jsx("input",{type:"radio",value:"ALL",checked:O==="ALL",onChange:()=>ee("ALL")}),e.jsx("span",{children:"All Dates"})]}),e.jsxs("label",{className:"radio",children:[e.jsx("input",{type:"radio",value:"SPECIFIC",checked:O==="SPECIFIC",onChange:()=>ee("SPECIFIC")}),e.jsx("span",{children:"Specific Date"})]})]}),O==="SPECIFIC"&&e.jsxs("select",{className:"date-select",value:P,onChange:M=>ie(M.target.value),children:[e.jsx("option",{value:"",children:"Select a Date"}),ne.map((M,n)=>e.jsx("option",{value:M,children:M},n))]}),i&&e.jsx("div",{className:"progress-wrapper",children:e.jsxs("div",{className:"progress-bar",children:[e.jsx("div",{className:"progress-fill",style:{width:`${R}%`}}),e.jsxs("div",{className:"progress-content",children:[e.jsxs("span",{children:[R,"%"]}),e.jsxs("button",{className:"btn stop-inside",onClick:Q,children:[e.jsx(Ls,{}),e.jsx("span",{className:"stop-text"})]})]})]})}),e.jsxs("div",{className:"export-buttons",children:[e.jsx("button",{className:"btn pdf",disabled:i,onClick:te,children:"Export to PDF"}),e.jsx("button",{className:"btn word",disabled:i,onClick:ge,children:"Export to Word"}),e.jsx("button",{className:"btn excel",disabled:i,onClick:w,children:"Export to Excel"})]})]})},Pa=({user:o})=>{var Pe,Ve,Me,De,He,at;const[l,i]=t.useState([]),[F,R]=t.useState([]),[C,O]=t.useState(0),[ee,P]=t.useState({}),[ie,ne]=t.useState(!1),[ce,H]=t.useState(!1),[Q,pe]=t.useState(null),[D,te]=t.useState("all"),[ge,w]=t.useState([]),[M,n]=t.useState([]),[f,r]=t.useState(null),[b,L]=t.useState(!1),[W,q]=t.useState(!1),[E,se]=t.useState(!1),[k,de]=t.useState(!1),[$,c]=t.useState(null),U=t.useRef(null),[u,V]=t.useState(""),[J,ue]=t.useState(!0),T=(u||((Pe=l.find(S=>S.college_name))==null?void 0:Pe.college_name))??"Add schedule first",N=((Ve=l.find(S=>S.exam_period))==null?void 0:Ve.exam_period)??"-",_e=((Me=l.find(S=>S.exam_category))==null?void 0:Me.exam_category)??"-",K=((De=l.find(S=>S.semester))==null?void 0:De.semester)??"-",be=((He=l.find(S=>S.academic_year))==null?void 0:He.academic_year)??"-",z=((at=l.find(S=>S.building_name))==null?void 0:at.building_name)??"-",[G,y]=t.useState(""),I=5,[je,Ce]=t.useState(!1),[m,me]=t.useState(null),[j,h]=t.useState(null),[A,he]=t.useState(!1),[p,B]=t.useState(!1),[re,Z]=t.useState(!1),we=t.useRef(null),Re=()=>{qe(!1),r(null),ne(!1),H(!1),L(!1),B(!1)};t.useEffect(()=>{const S=ae=>{U.current&&!U.current.contains(ae.target)&&L(!1),we.current&&!we.current.contains(ae.target)&&B(!1)};return document.addEventListener("mousedown",S),()=>document.removeEventListener("mousedown",S)},[]),t.useEffect(()=>{(async()=>{var Ie;if(!(o!=null&&o.user_id)){console.log("No user_id found in props"),ue(!1);return}const ae=o.user_id;console.log("========================================"),console.log("Scheduler User ID:",ae);try{const Ae=(await g.get("/tbl_user_role",{params:{user_id:ae,role_id:3}})).data;if(!Ae||Ae.length===0){console.error("No scheduler role found for user"),ue(!1);return}const Ye=Ae[0].college_id;console.log("Scheduler College ID:",Ye);const Je=(Ie=(await g.get(`/tbl_college/${Ye}/`)).data)==null?void 0:Ie.college_name;console.log("Scheduler College Name:",Je),V(Je||"");const xe=(await g.get("/departments/",{params:{college_id:Ye}})).data,Fe=(xe==null?void 0:xe.map(it=>it.department_id))||[];console.log("Department IDs under college:",Fe);const Ke=(await g.get("/tbl_user_role",{params:{role_id:5}})).data;if(!Ke||Ke.length===0){console.log("No proctors found"),n([]),ue(!1);return}console.log("Total proctors fetched:",Ke.length);const Xe=new Set;if(Ke.forEach(it=>{let oe=!1;it.college_id&&String(it.college_id)===String(Ye)?(oe=!0,console.log(`✓ Match (Direct College): User ${it.user_id} - College: ${it.college_id}`)):it.department_id&&Fe.includes(it.department_id)&&(oe=!0,console.log(`✓ Match (Department): User ${it.user_id} - Dept: ${it.department_id}`)),oe||console.log(`✗ No Match: User ${it.user_id} - College: ${it.college_id||"null"}, Dept: ${it.department_id||"null"}`),oe&&Xe.add(it.user_id)}),console.log("Matching User IDs:",Array.from(Xe)),Xe.size===0){console.log("No matching proctors found"),n([]),w([]),ue(!1);return}const ht=(await g.get("/users/")).data.filter(it=>Xe.has(it.user_id));console.log("Final filtered users:",(ht==null?void 0:ht.length)||0),console.log("========================================"),n(ht||[]),w(ht||[]),R(it=>{const oe=new Set(it.map(We=>We.user_id)),ve=(ht||[]).filter(We=>!oe.has(We.user_id));return[...it,...ve]});const jt=(await g.get("/tbl_user_role",{params:{college_id:Ye,role_id:1}})).data;if(jt&&jt.length>0){const it=jt[0],ve=(await g.get("/users/")).data.find(We=>We.user_id===it.user_id);ve&&c({name:`${ve.first_name} ${ve.last_name}`,user_id:ve.user_id})}ue(!1),Z(!0)}catch(Oe){console.error("Error fetching scheduler data:",Oe),ue(!1)}})()},[o]),t.useEffect(()=>{if(!re)return;const S=async()=>{try{const Ie={};u&&u!=="Add schedule first"&&(Ie.college_name=u);const[Oe,Ae]=await Promise.all([g.get("/tbl_examdetails",{params:Ie}),g.get("/users/")]);if(Oe.data){console.log(`✅ Fetched ${Oe.data.length} schedules`);const Ye=Oe.data.filter(Ze=>!Ze.room_id||!Ze.exam_start_time||!Ze.exam_end_time);Ye.length>0&&console.error(`❌ ${Ye.length} schedules have missing data:`,Ye),i(Oe.data)}Ae.data&&R(Ae.data)}catch(Ie){console.error("Error fetching data:",Ie)}};S();const ae=setInterval(S,2e3);return()=>clearInterval(ae)},[o,u,re]),t.useEffect(()=>{const S=async()=>{if(!(!(o!=null&&o.user_id)||!T||T==="Add schedule first"))try{const Ie=await g.get("/tbl_scheduleapproval/",{params:{college_name:T}});if(Ie.data&&Ie.data.length>0){const Ae=Ie.data.sort((Je,ze)=>new Date(ze.submitted_at).getTime()-new Date(Je.submitted_at).getTime())[0],Ye=m,Ze=Ae.status;Ye&&Ye!==Ze&&(Ze==="approved"?a.success("Your schedule has been approved by the dean!",{autoClose:5e3,position:"top-center"}):Ze==="rejected"&&a.error(`Your schedule was rejected. Reason: ${Ae.remarks||"No reason provided"}`,{autoClose:7e3,position:"top-center"})),me(Ze),h(Ae.remarks??null)}else me(null),h(null)}catch(Ie){console.error("Error checking approval status:",Ie),me(null),h(null)}};S();const ae=setInterval(S,5e3);return()=>clearInterval(ae)},[o,T,m]);const d=async(S,ae)=>{try{await g.put(`/tbl_examdetails/${S}/`,{proctor_id:ae}),i(Ie=>Ie.map(Oe=>Oe.examdetails_id===S?{...Oe,proctor_id:ae}:Oe)),r(null),a.success("Proctor updated successfully!")}catch(Ie){console.error("Error updating proctor:",Ie),a.error("Failed to update proctor.")}},_=S=>{if(!S)return"-";const ae=typeof S=="string"?parseInt(S,10):S,Ie=M.find(Ae=>Number(Ae.user_id)===Number(ae));if(Ie)return`${Ie.first_name} ${Ie.last_name}`;const Oe=F.find(Ae=>Number(Ae.user_id)===Number(ae));return Oe?`${Oe.first_name} ${Oe.last_name}`:"-"},Y=async S=>{if(ie)if(!Q)pe(S);else{if(Q.course_id===S.course_id&&Q.exam_date===S.exam_date&&Q.exam_start_time===S.exam_start_time&&Q.exam_end_time===S.exam_end_time){const ae={...Q,room_id:S.room_id},Ie={...S,room_id:Q.room_id};i(Oe=>Oe.map(Ae=>Ae.examdetails_id===ae.examdetails_id?ae:Ae.examdetails_id===Ie.examdetails_id?Ie:Ae));try{await g.put(`/tbl_examdetails/${ae.examdetails_id}/`,{room_id:ae.room_id}),await g.put(`/tbl_examdetails/${Ie.examdetails_id}/`,{room_id:Ie.room_id}),a.success("Schedules swapped!")}catch(Oe){console.error("Error swapping schedules:",Oe),a.error("Failed to swap schedules!")}}else a.warn("Schedules must have the same course and timeslot!");pe(null)}},ye=D==="all"?l:l.filter(S=>`${S.semester} | ${S.academic_year} | ${S.exam_date}`===D),Ee=G.trim()===""?ye:ye.filter(S=>{var Ie,Oe,Ae,Ye,Ze,Je;const ae=G.toLowerCase();return((Ie=S.course_id)==null?void 0:Ie.toLowerCase().includes(ae))||((Oe=S.section_name)==null?void 0:Oe.toLowerCase().includes(ae))||((Ae=S.room_id)==null?void 0:Ae.toLowerCase().includes(ae))||_(S.instructor_id).toLowerCase().includes(ae)||_(S.proctor_id).toLowerCase().includes(ae)||((Ye=S.exam_date)==null?void 0:Ye.includes(G))||((Ze=S.exam_start_time)==null?void 0:Ze.includes(G))||((Je=S.exam_end_time)==null?void 0:Je.includes(G))}),Ne=()=>{const S=new Set;return l.forEach(ae=>{ae.semester&&ae.academic_year&&ae.exam_date&&S.add(`${ae.semester} | ${ae.academic_year} | ${ae.exam_date}`)}),Array.from(S).sort()},Ue=Array.from(new Set(Ee.map(S=>S.exam_date))).filter(Boolean).sort();t.useEffect(()=>{if(Ee.length>0){console.log("📊 Total schedules in searchFilteredData:",Ee.length),console.log("📅 Unique dates:",Ue),console.log("🏫 Total rooms:",Array.from(new Set(Ee.map(ae=>ae.room_id))).length);const S=Ee.filter(ae=>!ae.room_id||!ae.exam_start_time||!ae.exam_end_time||!ae.exam_date);S.length>0&&console.error("❌ Incomplete schedules:",S),Ue.forEach(ae=>{const Ie=Ee.filter(Ae=>Ae.exam_date===ae);console.log(`📅 ${ae}: ${Ie.length} schedules`);const Oe=Array.from(new Set(Ie.map(Ae=>Ae.room_id)));console.log(`   🏫 Rooms: ${Oe.join(", ")}`)})}},[Ee,Ue]);const et=["07:00","07:30","08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30","21:00"],Ge=S=>{const[ae,Ie]=S.split(":");let Oe=Number(ae);const Ae=Oe>=12?"PM":"AM";return Oe=Oe%12||12,`${Oe}:${Ie} ${Ae}`},s=et.slice(0,-1).map((S,ae)=>({start24:S,end24:et[ae+1],label:`${Ge(S)} - ${Ge(et[ae+1])}`})),v=(S=>{const ae=["#79b4f2","#f27f79","#79f2b4","#f2e279","#b479f2","#f279d6","#79d6f2","#d6f279","#f29979","#a3f279","#f279a3","#79a3f2","#f2c879","#79f2e2","#f2a879","#b4f279","#f27979","#79f279","#79f2d6","#f279f2","#79f2f2","#f2b479","#c879f2","#79f2a8","#f2d679","#a879f2","#79f2c8","#f279b4","#f2f279","#79b4f2"],Ie={};return S.forEach((Oe,Ae)=>{Ie[Oe]=ae[Ae%ae.length]}),Ie})(Array.from(new Set(Ee.map(S=>S.course_id).filter(Boolean)))),X=Ee.length>0,Se=S=>{P(ae=>({...ae,[S]:!ae[S]}))},[Te,qe]=t.useState(!1),$e=async()=>{var Oe,Ae;if(!u||u==="Add schedule first"){a.warn("No college detected. Cannot delete schedules.");return}if(!globalThis.confirm(`⚠️ WARNING: You are about to delete ALL schedules for ${u}.

Are you absolutely sure you want to continue?`)||!globalThis.confirm(`🚨 FINAL CONFIRMATION:

This will permanently remove ALL exam schedules for ${u}.
This action cannot be undone.

Do you still want to proceed?`))return;const Ie=a.info("Deleting schedules...",{autoClose:!1});try{const Ye=l.filter(Je=>Je.college_name===u);if(Ye.length===0){a.dismiss(Ie),a.warn(`No schedules found for ${u}`);return}console.log(`🗑️ Batch deleting ${Ye.length} schedules for "${u}"`);const Ze=await g.post("/tbl_examdetails/batch-delete/",{college_name:u});a.dismiss(Ie),i(Je=>Je.filter(ze=>ze.college_name!==u)),a.success(`Successfully deleted ${Ze.data.deleted_count} schedules for ${u}!`)}catch(Ye){console.error("Error deleting schedules:",Ye),a.dismiss(Ie),a.error(`Failed to delete schedules: ${((Ae=(Oe=Ye==null?void 0:Ye.response)==null?void 0:Oe.data)==null?void 0:Ae.error)||(Ye==null?void 0:Ye.message)||"Unknown error"}`)}},le=(S,ae,Ie,Oe)=>(Ie.length>0?Ie:Oe).filter(Ze=>!ae.filter(ze=>ze.proctor_id===Ze.user_id&&ze.examdetails_id!==S.examdetails_id&&ze.exam_date===S.exam_date).some(ze=>{if(!S.exam_start_time||!S.exam_end_time||!ze.exam_start_time||!ze.exam_end_time)return!1;const xe=new Date(S.exam_start_time).getTime(),Fe=new Date(S.exam_end_time).getTime(),Le=new Date(ze.exam_start_time).getTime(),Ke=new Date(ze.exam_end_time).getTime();return xe<Ke&&Fe>Le})).map(Ze=>({value:Ze.user_id,label:`${Ze.first_name} ${Ze.last_name}`})),ke=[{key:"Add Schedule",icon:e.jsx(Ct,{style:{fontSize:"25px",color:"gold"}}),action:()=>{m==="pending"?a.warn("Waiting for dean approval"):m==="approved"?a.warn("Schedule already approved. Cannot modify."):(Re(),qe(!0))}},{key:"Change Proctor",icon:e.jsx(Zs,{style:{fontSize:"20px"}}),action:()=>{if(m==="pending")a.warn("Waiting for dean approval");else if(m==="approved")a.warn("Schedule already approved. Cannot modify.");else{const S=f===-1?null:-1;Re(),r(S)}}},{key:"Swap Room",icon:e.jsx(Xs,{style:{fontSize:"25px"}}),action:()=>{if(m==="pending")a.warn("Waiting for dean approval");else if(m==="approved")a.warn("Schedule already approved. Cannot modify.");else{const S=!ie;Re(),ne(S),pe(null),H(S)}}},{key:"Send Messages",icon:e.jsx(Qs,{style:{fontSize:"20px"}}),action:()=>{Re(),L(!0)},ref:U},{key:"Export",icon:e.jsx(ea,{style:{fontSize:"18px"}}),action:()=>{Re(),B(!0),he(!0),B(!1)},ref:we},{key:"Delete All",icon:e.jsx(bt,{style:{fontSize:"18px"}}),action:$e}];let fe=1;if(D==="all"&&X)fe=Ue.reduce((S,ae)=>{const Ie=Ee.filter(Ae=>Ae.exam_date===ae),Oe=Array.from(new Set(Ie.map(Ae=>Ae.room_id).filter(Boolean)));return S+Math.max(1,Math.ceil(Oe.length/I))},0);else if(X){const S=Array.from(new Set(Ee.map(ae=>ae.room_id).filter(Boolean)));fe=Math.max(1,Math.ceil(S.length/I))}return J?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",fontSize:"24px",color:"#092C4C"},children:"Please wait..."}):e.jsxs("div",{style:{position:"relative",width:"100%",overflow:"visible"},children:[e.jsxs("div",{className:"scheduler-top-card",children:[m&&e.jsxs("div",{style:{position:"fixed",top:"80px",left:"50%",transform:"translateX(-50%)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",padding:"10px 20px",borderRadius:"8px",backgroundColor:m==="approved"?"#4CAF50":m==="rejected"?"#f44336":"#FF9800",color:"white",fontWeight:"bold",zIndex:1e3,boxShadow:"0 2px 8px rgba(0,0,0,0.3)",maxWidth:"90%",textAlign:"center"},children:[e.jsxs("span",{children:["Status: ",m.toUpperCase(),m==="pending"&&" - Waiting for Dean",m==="rejected"&&" - You can modify and resubmit"]}),m==="rejected"&&j&&e.jsxs("span",{style:{marginTop:"5px",fontWeight:"normal",fontSize:"0.9rem",opacity:.9},children:[e.jsx("strong",{children:"Remarks:"})," ",j]})]}),ie&&e.jsx("div",{style:{position:"fixed",top:"90px",left:"50%",transform:"translateX(-50%)",backgroundColor:"#ff9500ff",color:"white",padding:"12px 25px",borderRadius:"10px",boxShadow:"0 4px 10px rgba(0,0,0,0.3)",zIndex:1200,textAlign:"center",fontWeight:"bold",opacity:.9},children:"Swapping Mode"}),ce&&e.jsxs("div",{style:{position:"fixed",top:"250px",left:"50%",transform:"translateX(-50%)",backgroundColor:"white",color:"#092C4C",borderRadius:"10px",padding:"5px 10px",width:"400px",zIndex:1201,boxShadow:"0 4px 12px rgba(0,0,0,0.3)",textAlign:"center",animation:"fadeIn 0.3s ease"},children:[e.jsx("h4",{style:{marginBottom:"8px",fontWeight:"bold"},children:"Swapping Instructions"}),e.jsxs("p",{style:{fontSize:"15px",lineHeight:"1.5",marginBottom:"10px"},children:["1️. Click the schedule you want to move. ",e.jsx("br",{}),"2️. Click another schedule to swap with. ",e.jsx("br",{}),"⚠️ Swapping is only possible if both schedules have the ",e.jsx("strong",{children:"same timeslot and course"}),"."]}),e.jsx("button",{type:"button",onClick:()=>H(!1),style:{backgroundColor:"transparent",color:"red",border:"none",borderRadius:"10px",padding:"6px 12px",cursor:"pointer",fontWeight:"bold"},children:"Close Instructions"})]}),ke.map(({key:S,icon:ae,action:Ie,ref:Oe})=>e.jsxs("div",{ref:S==="Send Messages"?Oe:void 0,className:`scheduler-icon ${ie&&S==="Swap Room"||f!==null&&S==="Change Proctor"||Te&&S==="Add Schedule"||b&&S==="Send Messages"?"active":""}`,style:{position:S==="Send Messages"?"relative":void 0},onClick:()=>{Ie?Ie():Se(S)},children:[ae,e.jsx("span",{className:"tooltip-text",children:S.charAt(0).toUpperCase()+S.slice(1)}),S==="Send Messages"&&b&&e.jsxs("div",{className:"envelope-dropdown",children:[e.jsx("button",{type:"button",className:"dropdown-item",onClick:Ae=>{Ae.stopPropagation(),de(!0),L(!1)},title:"Send to Dean",children:e.jsx(Vs,{})}),e.jsx("button",{type:"button",className:"dropdown-item",onClick:Ae=>{Ae.stopPropagation(),q(!0),L(!1)},title:"Send SMS",children:e.jsx(Js,{})}),e.jsx("button",{type:"button",className:"dropdown-item",onClick:Ae=>{if(Ae.stopPropagation(),m!=="approved"){a.warn("You can only send email once the schedule is approved.");return}se(!0),L(!1)},title:"Send Email",children:e.jsx(Ks,{})})]})]},S)),e.jsx("div",{style:{top:"20px",right:"-100px"},children:e.jsxs("select",{value:D,onChange:S=>{te(S.target.value),O(0)},style:{padding:"8px 1px",fontSize:"14px",borderRadius:"15px",border:"2px solid #092C4C",backgroundColor:"white",cursor:"pointer",minWidth:"250px",color:"#092C4C"},children:[e.jsx("option",{value:"all",children:"All Dates"}),Ne().map((S,ae)=>e.jsx("option",{value:S,children:S},ae))]})}),e.jsxs("div",{style:{padding:"1px",fontSize:"10px",borderRadius:"15px",border:"2px solid #092C4C",backgroundColor:"white",cursor:"pointer",minWidth:"250px",color:"#092C4C",height:"40%"},children:[e.jsx("span",{style:{color:"#092C4C",fontSize:"16px"}}),e.jsx("input",{type:"text",value:G,onChange:S=>{y(S.target.value),O(0)},placeholder:"Search schedules...",style:{border:"none",outline:"none",fontSize:"14px",color:"#092C4C",backgroundColor:"transparent"}}),G&&e.jsx("button",{type:"button",onClick:()=>{y(""),O(0)},style:{background:"none",border:"none",color:"#092C4C",cursor:"pointer",fontSize:"18px",padding:"0",marginLeft:"23px"},children:"✕"})]})]}),X&&C>0&&e.jsx("button",{type:"button",style:{position:"fixed",left:"45%",top:"90%",transform:"translateY(-50%)",zIndex:1e3,background:"rgba(255,255,255,0.3)",border:"none",borderRadius:"50%",cursor:"pointer",padding:"0.5rem"},onClick:()=>O(C-1),children:e.jsx(zt,{style:{color:"#092C4C",fontSize:"3rem",opacity:.7}})}),X&&C<fe-1&&e.jsx("button",{type:"button",style:{position:"fixed",right:"40%",top:"90%",transform:"translateY(-50%)",zIndex:1e3,background:"rgba(255,255,255,0.3)",border:"none",borderRadius:"50%",cursor:"pointer",padding:"0.5rem"},onClick:()=>O(C+1),children:e.jsx(Jt,{style:{color:"#092C4C",fontSize:"3rem",opacity:.7}})}),e.jsxs("div",{className:"scheduler-view-card-wrapper",style:{display:"flex",transition:"transform 0.5s ease",transform:X?`translateX(-${C*100}%)`:"none"},children:[X?D==="all"?Ue.flatMap(S=>{const ae=ye.filter(Ae=>Ae.exam_date===S),Ie=Array.from(new Set(ae.map(Ae=>Ae.room_id).filter(Boolean))).sort((Ae,Ye)=>{const Ze=Number(Ae),Je=Number(Ye);return!isNaN(Ze)&&!isNaN(Je)?Ze-Je:String(Ae).localeCompare(String(Ye),void 0,{numeric:!0})}),Oe=Math.max(1,Math.ceil(Ie.length/I));return Array.from({length:Oe}).map((Ae,Ye)=>{const Ze=Ie.slice(Ye*I,(Ye+1)*I),Je={},ze={};return ae.forEach(xe=>{if(!xe.room_id){console.warn("⚠️ Exam without room_id:",xe.examdetails_id);return}const Fe=`${S}-${xe.room_id}`;ze[Fe]||(ze[Fe]=[]),ze[Fe].push(xe)}),console.log(`📦 Grouped data for ${S}:`,Object.keys(ze).length,"room groups"),Object.entries(ze).forEach(([xe,Fe])=>{console.log(`   ${xe}: ${Fe.length} exam(s)`)}),e.jsx("div",{className:"scheduler-view-card",style:{minWidth:"100%",maxWidth:"1400px",boxShadow:"0 8px 20px rgba(0,0,0,0.3)",borderRadius:12,background:"#f9f9f9",margin:"16px auto",padding:15,transform:"scale(0.8)",transformOrigin:"top center",transition:"transform 0.3s ease"},children:e.jsxs("div",{className:"scheduler-view-container",children:[e.jsxs("div",{className:"header",style:{textAlign:"center",marginBottom:"20px"},children:[e.jsx("img",{src:"../../static/logo/USTPlogo.png",alt:"School Logo",style:{width:"200px",height:"160px",marginBottom:"5px"}}),e.jsx("div",{style:{fontSize:"30px",color:"#333",marginBottom:"-10px",fontFamily:"serif"},children:"University of Science and Technology of Southern Philippines"}),e.jsx("div",{style:{fontSize:"15px",color:"#555",marginBottom:"-10px",fontFamily:"serif"},children:"Alubijid | Balubal | Cagayan de Oro City | Claveria | Jasaan | Oroquieta | Panaon | Villanueva"}),e.jsx("div",{style:{fontSize:"30px",color:"#333",marginBottom:"-10px",fontFamily:"serif"},children:T}),e.jsxs("div",{style:{fontSize:"20px",color:"#333",marginBottom:"-10px",fontFamily:"serif",fontWeight:"bold"},children:[_e," Examination Schedule | ",K," Semester | A.Y. ",be]}),e.jsx("div",{style:{fontSize:"20px",color:"#333",marginTop:"-10px",fontFamily:"serif"},children:N})]}),e.jsx("hr",{}),e.jsxs("table",{className:"exam-table",children:[e.jsxs("thead",{children:[e.jsx("tr",{children:e.jsx("th",{colSpan:Ze.length+1,children:S&&new Date(S).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})}),e.jsxs("tr",{children:[e.jsx("th",{}),(()=>{const xe={};return Ze.forEach(Fe=>{var Ke;const Le=((Ke=ye.find(Xe=>Xe.room_id===(Fe??"")))==null?void 0:Ke.building_name)||"Unknown Building";xe[Le]||(xe[Le]=[]),xe[Le].push(String(Fe))}),Object.entries(xe).map(([Fe,Le])=>e.jsx("th",{colSpan:Le.length,children:Fe},Fe))})()]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Time"}),(()=>{const xe={};return Ze.forEach(Fe=>{var Ke;const Le=((Ke=ae.find(Xe=>Xe.room_id===(Fe??"")))==null?void 0:Ke.building_name)||"Unknown Building";xe[Le]||(xe[Le]=[]),xe[Le].push(String(Fe))}),Object.values(xe).flat().map((Fe,Le)=>e.jsx("th",{children:Fe},Le))})()]})]}),e.jsx("tbody",{children:s.map((xe,Fe)=>e.jsxs("tr",{children:[e.jsx("td",{children:xe.label}),Ze.map(Le=>{var st,ct,rt,pt,gt,yt;const Ke=`${S}-${Le}-${Fe}`;if(Je[Ke])return null;const Be=(ze[`${S}-${Le}`]||[]).find(Qe=>{if(!Qe.exam_start_time||!Qe.exam_end_time)return console.warn("⚠️ Missing time data:",Qe.examdetails_id),!1;const dt=Qe.exam_start_time.slice(11,16),xt=Qe.exam_end_time.slice(11,16),[$t,St]=dt.split(":").map(Number),[vt,kt]=xt.split(":").map(Number),Tt=$t*60+St,Mt=vt*60+kt,mt=Number(xe.start24.split(":")[0])*60+Number(xe.start24.split(":")[1]),Pt=Number(xe.end24.split(":")[0])*60+Number(xe.end24.split(":")[1]);return Tt<Pt&&Mt>mt});if(!Be)return e.jsx("td",{},Le);const _t=Be.exam_start_time.slice(11,16),ht=Be.exam_end_time.slice(11,16),[wt,jt]=_t.split(":").map(Number),[it,oe]=ht.split(":").map(Number),ve=wt*60+jt,We=it*60+oe,ot=s.findIndex(Qe=>{const dt=Number(Qe.start24.split(":")[0])*60+Number(Qe.start24.split(":")[1]),xt=Number(Qe.end24.split(":")[0])*60+Number(Qe.end24.split(":")[1]);return ve>=dt&&ve<xt}),nt=Math.ceil((We-ve)/30);for(let Qe=0;Qe<nt;Qe++)ot+Qe<s.length&&(Je[`${S}-${Le}-${ot+Qe}`]=!0);return e.jsx("td",{rowSpan:nt,children:e.jsxs("div",{onClick:()=>Y(Be),style:{backgroundColor:v[Be.course_id||""]||"#ccc",color:"black",padding:4,borderRadius:4,fontSize:12,cursor:ie?"pointer":"default",outline:(Q==null?void 0:Q.examdetails_id)===Be.examdetails_id?"10px solid blue":G&&((st=Be.course_id)!=null&&st.toLowerCase().includes(G.toLowerCase())||(ct=Be.section_name)!=null&&ct.toLowerCase().includes(G.toLowerCase())||(rt=Be.room_id)!=null&&rt.toLowerCase().includes(G.toLowerCase())||_(Be.instructor_id).toLowerCase().includes(G.toLowerCase())||_(Be.proctor_id).toLowerCase().includes(G.toLowerCase()))?"3px solid yellow":"none",boxShadow:G&&((pt=Be.course_id)!=null&&pt.toLowerCase().includes(G.toLowerCase())||(gt=Be.section_name)!=null&&gt.toLowerCase().includes(G.toLowerCase())||(yt=Be.room_id)!=null&&yt.toLowerCase().includes(G.toLowerCase())||_(Be.instructor_id).toLowerCase().includes(G.toLowerCase())||_(Be.proctor_id).toLowerCase().includes(G.toLowerCase()))?"0 0 15px 3px rgba(255, 255, 0, 0.8)":"none"},children:[e.jsx("p",{children:Be.course_id}),e.jsx("p",{children:Be.section_name}),e.jsxs("p",{children:["Instructor: ",_(Be.instructor_id)]}),e.jsxs("p",{children:["Proctor:",f===Be.examdetails_id||f===-1?e.jsx(lt,{value:Be.proctor_id?{value:Be.proctor_id,label:_(Be.proctor_id)}:null,onChange:Qe=>{Qe&&d(Be.examdetails_id,Qe.value)},options:le(Be,l,M,F),placeholder:"--Select Proctor--",isSearchable:!0,styles:{menu:Qe=>({...Qe,zIndex:9999})}}):e.jsx("span",{style:{marginLeft:"5px"},children:Be.proctor_id?_(Be.proctor_id):"Not Assigned"})]}),e.jsxs("p",{children:[Ge(_t)," - ",Ge(ht)]})]})},Le)})]},xe.start24))})]})]})},`${S}-${Ye}`)})}):Ue.flatMap(S=>{const ae=ye.filter(Ae=>Ae.exam_date===S),Ie=Array.from(new Set(ae.map(Ae=>Ae.room_id).filter(Boolean))).sort((Ae,Ye)=>{const Ze=Number(Ae),Je=Number(Ye);return!isNaN(Ze)&&!isNaN(Je)?Ze-Je:String(Ae).localeCompare(String(Ye),void 0,{numeric:!0})}),Oe=Math.max(1,Math.ceil(Ie.length/I));return Array.from({length:Oe}).map((Ae,Ye)=>{const Ze=Ie.slice(Ye*I,(Ye+1)*I),Je={},ze={};return ae.forEach(xe=>{if(!xe.room_id){console.warn("⚠️ Exam without room_id:",xe.examdetails_id);return}const Fe=`${S}-${xe.room_id}`;ze[Fe]||(ze[Fe]=[]),ze[Fe].push(xe)}),console.log(`📦 Grouped data for ${S}:`,Object.keys(ze).length,"room groups"),Object.entries(ze).forEach(([xe,Fe])=>{console.log(`   ${xe}: ${Fe.length} exam(s)`)}),e.jsx("div",{className:"scheduler-view-card",style:{minWidth:"100%",maxWidth:"1400px",boxShadow:"0 8px 20px rgba(0,0,0,0.3)",borderRadius:12,background:"#f9f9f9",margin:"16px auto",padding:15,transform:"scale(0.8)",transformOrigin:"top center",transition:"transform 0.3s ease"},children:e.jsxs("div",{className:"scheduler-view-container",children:[e.jsxs("div",{className:"header",style:{textAlign:"center",marginBottom:"20px"},children:[e.jsx("img",{src:"../../static/logo/USTPlogo.png",alt:"School Logo",style:{width:"200px",height:"160px",marginBottom:"5px"}}),e.jsx("div",{style:{fontSize:"30px",color:"#333",marginBottom:"-10px",fontFamily:"serif"},children:"University of Science and Technology of Southern Philippines"}),e.jsx("div",{style:{fontSize:"15px",color:"#555",marginBottom:"-10px",fontFamily:"serif"},children:"Alubijid | Balubal | Cagayan de Oro City | Claveria | Jasaan | Oroquieta | Panaon | Villanueva"}),e.jsx("div",{style:{fontSize:"30px",color:"#333",marginBottom:"-10px",fontFamily:"serif"},children:T}),e.jsxs("div",{style:{fontSize:"20px",color:"#333",marginBottom:"-10px",fontFamily:"serif",fontWeight:"bold"},children:[_e," Examination Schedule | ",K," Semester | A.Y. ",be]}),e.jsx("div",{style:{fontSize:"20px",color:"#333",marginTop:"-10px",fontFamily:"serif"},children:N})]}),e.jsx("hr",{}),e.jsxs("table",{className:"exam-table",children:[e.jsxs("thead",{children:[e.jsx("tr",{children:e.jsx("th",{colSpan:Ze.length+1,children:S&&new Date(S).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})}),e.jsxs("tr",{children:[e.jsx("th",{}),(()=>{const xe={};return Ze.forEach(Fe=>{var Ke;const Le=((Ke=ye.find(Xe=>Xe.room_id===(Fe??"")))==null?void 0:Ke.building_name)||"Unknown Building";xe[Le]||(xe[Le]=[]),xe[Le].push(String(Fe))}),Object.entries(xe).map(([Fe,Le])=>e.jsx("th",{colSpan:Le.length,children:Fe},Fe))})()]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Time"}),(()=>{const xe={};return Ze.forEach(Fe=>{var Ke;const Le=((Ke=ae.find(Xe=>Xe.room_id===(Fe??"")))==null?void 0:Ke.building_name)||"Unknown Building";xe[Le]||(xe[Le]=[]),xe[Le].push(String(Fe))}),Object.values(xe).flat().map((Fe,Le)=>e.jsx("th",{children:Fe},Le))})()]})]}),e.jsx("tbody",{children:s.map((xe,Fe)=>e.jsxs("tr",{children:[e.jsx("td",{children:xe.label}),Ze.map(Le=>{var st,ct,rt,pt,gt,yt;const Ke=`${S}-${Le}-${Fe}`;if(Je[Ke])return null;const Be=(ze[`${S}-${Le}`]||[]).find(Qe=>{if(!Qe.exam_start_time||!Qe.exam_end_time)return console.warn("⚠️ Missing time data:",Qe.examdetails_id),!1;const dt=Qe.exam_start_time.slice(11,16),xt=Qe.exam_end_time.slice(11,16),[$t,St]=dt.split(":").map(Number),[vt,kt]=xt.split(":").map(Number),Tt=$t*60+St,Mt=vt*60+kt,mt=Number(xe.start24.split(":")[0])*60+Number(xe.start24.split(":")[1]),Pt=Number(xe.end24.split(":")[0])*60+Number(xe.end24.split(":")[1]);return Tt<Pt&&Mt>mt});if(!Be)return e.jsx("td",{},Le);const _t=Be.exam_start_time.slice(11,16),ht=Be.exam_end_time.slice(11,16),[wt,jt]=_t.split(":").map(Number),[it,oe]=ht.split(":").map(Number),ve=wt*60+jt,We=it*60+oe,ot=s.findIndex(Qe=>{const dt=Number(Qe.start24.split(":")[0])*60+Number(Qe.start24.split(":")[1]),xt=Number(Qe.end24.split(":")[0])*60+Number(Qe.end24.split(":")[1]);return ve>=dt&&ve<xt}),nt=Math.ceil((We-ve)/30);for(let Qe=0;Qe<nt;Qe++)ot+Qe<s.length&&(Je[`${S}-${Le}-${ot+Qe}`]=!0);return e.jsx("td",{rowSpan:nt,children:e.jsxs("div",{onClick:()=>Y(Be),style:{backgroundColor:v[Be.course_id||""]||"#ccc",color:"black",padding:4,borderRadius:4,fontSize:12,cursor:ie?"pointer":"default",outline:(Q==null?void 0:Q.examdetails_id)===Be.examdetails_id?"10px solid blue":G&&((st=Be.course_id)!=null&&st.toLowerCase().includes(G.toLowerCase())||(ct=Be.section_name)!=null&&ct.toLowerCase().includes(G.toLowerCase())||(rt=Be.room_id)!=null&&rt.toLowerCase().includes(G.toLowerCase())||_(Be.instructor_id).toLowerCase().includes(G.toLowerCase())||_(Be.proctor_id).toLowerCase().includes(G.toLowerCase()))?"3px solid yellow":"none",boxShadow:G&&((pt=Be.course_id)!=null&&pt.toLowerCase().includes(G.toLowerCase())||(gt=Be.section_name)!=null&&gt.toLowerCase().includes(G.toLowerCase())||(yt=Be.room_id)!=null&&yt.toLowerCase().includes(G.toLowerCase())||_(Be.instructor_id).toLowerCase().includes(G.toLowerCase())||_(Be.proctor_id).toLowerCase().includes(G.toLowerCase()))?"0 0 15px 3px rgba(255, 255, 0, 0.8)":"none"},children:[e.jsx("p",{children:Be.course_id}),e.jsx("p",{children:Be.section_name}),e.jsxs("p",{children:["Instructor: ",_(Be.instructor_id)]}),e.jsxs("p",{children:["Proctor:",f===Be.examdetails_id||f===-1?e.jsx(lt,{value:Be.proctor_id?{value:Be.proctor_id,label:_(Be.proctor_id)}:null,onChange:Qe=>{Qe&&d(Be.examdetails_id,Qe.value)},options:le(Be,l,M,F),placeholder:"--Select Proctor--",isSearchable:!0,styles:{menu:Qe=>({...Qe,zIndex:9999})}}):e.jsx("span",{style:{marginLeft:"5px"},children:Be.proctor_id?_(Be.proctor_id):"Not Assigned"})]}),e.jsxs("p",{children:[Ge(_t)," - ",Ge(ht)]})]})},Le)})]},xe.start24))})]})]})},`${S}-${Ye}`)})}):e.jsx("div",{className:"scheduler-view-card",style:{minWidth:"100%",maxWidth:"1400px",boxShadow:"0 8px 20px rgba(0,0,0,0.3)",borderRadius:12,background:"#f9f9f9",margin:"16px auto",padding:15,transform:"scale(0.9)",transformOrigin:"top center",transition:"transform 0.3s ease"},children:e.jsxs("div",{className:"scheduler-view-container",children:[e.jsxs("div",{className:"header",style:{textAlign:"center",marginBottom:"20px"},children:[e.jsx("img",{src:"../../static/logo/USTPlogo.png",alt:"School Logo",style:{width:"200px",height:"160px",marginBottom:"5px"}}),e.jsx("div",{style:{fontSize:"30px",color:"#333",marginBottom:"-10px",fontFamily:"serif"},children:"University of Science and Technology of Southern Philippines"}),e.jsx("div",{style:{fontSize:"15px",color:"#555",marginBottom:"-10px",fontFamily:"serif"},children:"Alubijid | Balubal | Cagayan de Oro City | Claveria | Jasaan | Oroquieta | Panaon | Villanueva"}),e.jsx("div",{style:{fontSize:"30px",color:"#333",marginBottom:"-10px",fontFamily:"serif"},children:T}),e.jsxs("div",{style:{fontSize:"20px",color:"#333",marginBottom:"-10px",fontFamily:"serif",fontWeight:"bold"},children:[_e," Examination Schedule | ",K," Semester | A.Y. ",be]}),e.jsx("div",{style:{fontSize:"20px",color:"#333",marginTop:"-10px",fontFamily:"serif"},children:N})]}),e.jsx("hr",{}),e.jsx("div",{style:{textAlign:"center",padding:"100px 20px",fontSize:"24px",color:"#999",fontFamily:"serif"},children:D==="all"?"Add schedule first":"No schedules found for selected filter"})]})}),e.jsx(Vt,{isOpen:Te,onClose:()=>qe(!1),children:e.jsx(Aa,{user:o,onScheduleCreated:async()=>{try{const S={};u&&u!=="Add schedule first"&&(S.college_name=u);const ae=await g.get("/tbl_examdetails",{params:S});ae.data&&(console.log(`✅ Immediate refresh: ${ae.data.length} schedules loaded`),i(ae.data))}catch(S){console.error("Error fetching data:",S)}qe(!1)}})})]}),e.jsx(Vt,{isOpen:W,onClose:()=>q(!1),children:e.jsx(Ra,{user:o,onClose:()=>q(!1),collegeName:T})}),e.jsx(Vt,{isOpen:E,onClose:()=>se(!1),children:e.jsx(Ma,{user:o,onClose:()=>se(!1),collegeName:T,approvalStatus:m,examData:l})}),e.jsx(Vt,{isOpen:k,onClose:()=>de(!1),children:e.jsx(Ea,{onClose:()=>de(!1),collegeName:T,user:o,filteredExamData:ye,getUserName:_,examPeriodName:N,termName:_e,semesterName:K,yearName:be,buildingName:z})}),e.jsx(Vt,{isOpen:A,onClose:()=>he(!1),children:e.jsx(Ta,{onClose:()=>he(!1),collegeName:T})}),e.jsx(ft,{position:"top-right",autoClose:1500})]})},ps={Morning:"7 AM - 1 PM (Morning)",Afternoon:"1 PM - 6 PM (Afternoon)",Evening:"6 PM - 9 PM (Evening)"},gs={Available:"available",Unavailable:"unavailable"},La=({user:o})=>{const[l,i]=t.useState([]),[F,R]=t.useState([]),[C,O]=t.useState([ps.Morning]),[ee,P]=t.useState(gs.Available),[ie,ne]=t.useState(""),[ce,H]=t.useState(""),[Q,pe]=t.useState(!1),[D,te]=t.useState(null),[ge,w]=t.useState([]),[M,n]=t.useState([]),[f,r]=t.useState(null),[b,L]=t.useState(!1),[W,q]=t.useState(new Date),[E,se]=t.useState([]),[k,de]=t.useState(!1),[$,c]=t.useState(!1),[U,u]=t.useState(""),[V,J]=t.useState(!1),ue=new Date,[T,N]=t.useState(!1),[_e,K]=t.useState(!1),[be,z]=t.useState(new Map),[G,y]=t.useState(new Set),I=s=>s.data.value==="all"?null:e.jsx(rs.MultiValue,{...s});t.useEffect(()=>{Promise.all([je(),me(),m()])},[]);const je=async()=>{if(o!=null&&o.user_id){N(!0);try{const[s,x]=await Promise.all([g.get("/tbl_user_role",{params:{user_id:o.user_id,role_id:3}}),g.get("/tbl_user_role",{params:{role_id:5}})]),v=Array.isArray(s.data)?s.data.find(De=>De.role_id===3||De.role===3):s.data;if(!(v!=null&&v.college_id)&&!(v!=null&&v.college)){a.error("Failed to fetch scheduler info");return}const X=v.college_id||v.college,Se=x.data;if(!Se||!Array.isArray(Se)){a.error("Failed to fetch proctors");return}const Te=Se.filter(De=>De.user_id!=null&&De.college_id===X);if(Te.length===0){w([]),i([]);return}const qe=[...new Set(Te.map(De=>De.user_id))],[$e,le]=await Promise.all([Promise.all(qe.map(async De=>{try{const{data:He}=await g.get(`/users/${De}/`);return{userId:De,data:He}}catch{return console.warn(`Failed to fetch user ${De}`),{userId:De,data:null}}})),Promise.all(qe.map(async De=>{try{const{data:He}=await g.get("/tbl_availability/",{params:{user_id:De}});return Array.isArray(He)?He:[]}catch{return console.warn(`Failed to fetch availability for user ${De}`),[]}}))]),ke=new Map;$e.forEach(({userId:De,data:He})=>{He&&ke.set(De,He)}),z(ke);const fe=Te.reduce((De,He)=>(De.find(S=>S.user_id===He.user_id)||De.push(He),De),[]).map(De=>{const He=ke.get(De.user_id);return{value:De.user_id,label:He?`${He.first_name||""} ${He.last_name||""}`.trim():`User ${De.user_id}`}}).filter(De=>De.label!==`User ${De.value}`);w(fe);const Me=le.flat().filter(De=>De.user_id!=null).map(De=>{const He=ke.get(De.user_id);return{availability_id:De.availability_id,days:Array.isArray(De.days)?De.days:[],time_slots:Array.isArray(De.time_slots)?De.time_slots:[],status:De.status,remarks:De.remarks,user_id:De.user_id,user_fullname:He?`${He.first_name||""} ${He.last_name||""}`.trim():"Unknown User"}});i(Me)}catch(s){console.error("Error fetching data:",s),a.error("An error occurred while fetching data")}finally{N(!1)}}},Ce=async()=>{if(o!=null&&o.user_id){N(!0);try{const{data:s}=await g.get("/tbl_user_role",{params:{user_id:o.user_id,role_id:3}}),x=Array.isArray(s)?s.find(fe=>fe.role_id===3||fe.role===3):s;if(!(x!=null&&x.college_id))return;const v=x.college_id,{data:X}=await g.get("/tbl_user_role",{params:{role_id:5,college_id:v}});if(!X||!Array.isArray(X))return;const Se=X.filter(fe=>fe.user_id!=null),Te=[...new Set(Se.map(fe=>fe.user_id))];if(Te.length===0){i([]);return}const ke=(await Promise.all(Te.map(async fe=>{try{const{data:Pe}=await g.get("/tbl_availability/",{params:{user_id:fe}});return Array.isArray(Pe)?Pe:[]}catch{return[]}}))).flat().filter(fe=>fe.user_id!=null).map(fe=>{const Pe=be.get(fe.user_id);return{availability_id:fe.availability_id,days:Array.isArray(fe.days)?fe.days:[],time_slots:Array.isArray(fe.time_slots)?fe.time_slots:[],status:fe.status,remarks:fe.remarks,user_id:fe.user_id,user_fullname:Pe?`${Pe.first_name||""} ${Pe.last_name||""}`.trim():"Unknown User"}});i(ke)}catch(s){console.error("Error fetching availability:",s)}finally{N(!1)}}},m=async()=>{if(o.user_id)try{const{data:s}=await g.get("/tbl_availability/",{params:{user_id:o.user_id}});s&&Array.isArray(s)&&s.length>0&&de(!0)}catch(s){console.error("Error checking existing submission:",s)}},me=async()=>{try{const{data:s}=await g.get("/tbl_user_role",{params:{user_id:o.user_id}}),x=Array.isArray(s)?s.find($e=>$e.role_id===3||$e.role===3):s;if(!x)return;const v=x.college_id||x.college,{data:X}=await g.get("/tbl_examperiod");if(!Array.isArray(X)){se([]);return}const Se=X.filter($e=>String($e.college_id)===String(v)),Te=[];Se==null||Se.forEach($e=>{if(!$e.start_date||!$e.end_date)return;const le=new Date($e.start_date),ke=new Date($e.end_date);for(let fe=new Date(le);fe<=ke;fe.setDate(fe.getDate()+1))Te.push(new Date(fe).toISOString().split("T")[0])}),Te.sort(),se(Te);const qe=ue.toISOString().split("T")[0];R(Te.includes(qe)?[qe]:[])}catch(s){console.error("Error fetching allowed dates:",s),se([])}},j=(s,x)=>new Date(s,x+1,0).getDate(),h=(s,x)=>new Date(s,x,1).getDay(),A=()=>{const s=W.getFullYear(),x=W.getMonth(),v=j(s,x),X=h(s,x),Se=[];for(let Te=0;Te<X;Te++)Se.push(null);for(let Te=1;Te<=v;Te++)Se.push(Te);return Se},he=s=>{const x=s.getFullYear(),v=String(s.getMonth()+1).padStart(2,"0"),X=String(s.getDate()).padStart(2,"0");return`${x}-${v}-${X}`},p=s=>{if(!s)return;const x=new Date(W.getFullYear(),W.getMonth(),s),v=he(x);E.length>0&&!E.includes(v)||R(X=>X.includes(v)?X.filter(Se=>Se!==v):[...X,v])},B=()=>q(s=>new Date(s.getFullYear(),s.getMonth()-1,1)),re=()=>q(s=>new Date(s.getFullYear(),s.getMonth()+1,1)),Z=()=>{const s=ue.toISOString().split("T")[0];q(new Date(ue.getFullYear(),ue.getMonth(),1)),R(E.includes(s)?[s]:[])},we=()=>{te(null),n([]),r(null),ne(""),pe(!0)},Re=s=>{te(s.availability_id),R(s.days),O(s.time_slots),P(s.status),ne(s.remarks||""),r(ge.find(x=>x.value===s.user_id)||null),pe(!0)},d=async()=>{if(!F||F.length===0){a.error("Select a valid date.");return}c(!0);try{if(D)await g.put(`/tbl_availability/${D}/`,{days:F,time_slots:C,status:ee,remarks:ie||null,user_id:f==null?void 0:f.value}),a.success("Updated!");else{if(M.length===0){a.error("Select at least one instructor."),c(!1);return}await Promise.all(M.map(s=>g.post("/tbl_availability/",{days:F,time_slots:C,status:ee,remarks:ie||null,user_id:s.value}))),a.success("Availability submitted!")}pe(!1),Ce()}catch(s){console.error("API error:",s),a.error(`Failed to process: ${(s==null?void 0:s.message)||"Unknown error"}`)}finally{c(!1)}},_=async()=>{const s=Array.from(G);if(s.length===0){a.info("No availability entries selected");return}if(window.confirm(`Delete ${s.length} selected availability entr${s.length===1?"y":"ies"}? This cannot be undone.`)){K(!0);try{const v=await Promise.allSettled(s.map(Te=>g.delete(`/tbl_availability/${Te}/`))),X=v.filter(Te=>Te.status==="fulfilled").length,Se=v.length-X;X>0&&a.success(`Deleted ${X} availability entr${X===1?"y":"ies"}`),Se>0&&a.error(`${Se} entr${Se===1?"y":"ies"} failed to delete`),Ge(),Ce()}catch(v){console.error(v),a.error("Bulk delete failed")}finally{K(!1)}}},Y=[{label:"Select All",value:"all"},...ge],ye=s=>{const x=s==null?void 0:s.find(v=>v.value==="all");n(x?ge:s||[])},Ee=s=>{y(x=>{const v=new Set(x);return v.has(s)?v.delete(s):v.add(s),v})},Ne=l.filter(s=>(s.user_fullname||"").toLowerCase().includes(ce.toLowerCase())),Ue=Ne.length>0&&Ne.every(s=>G.has(s.availability_id)),et=()=>{y(()=>{if(Ue)return new Set;const s=new Set;return Ne.forEach(x=>s.add(x.availability_id)),s})},Ge=()=>y(new Set);return e.jsxs("div",{className:"colleges-container",children:[e.jsx("div",{className:"colleges-header",children:e.jsxs("div",{className:"search-bar",style:{marginLeft:"auto"},children:[e.jsx("input",{type:"text",placeholder:"Search Proctor",value:ce,onChange:s=>H(s.target.value)}),e.jsx("button",{type:"button",className:"search-button",children:e.jsx(Rt,{})})]})}),e.jsx("div",{className:"colleges-actions",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,width:"100%"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:8},children:e.jsx("button",{type:"button",className:"action-button add-new",onClick:we,children:e.jsx(Ct,{})})}),e.jsx("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:8},children:e.jsx("button",{type:"button",className:"action-button delete",onClick:_,disabled:_e||G.size===0,title:G.size>0?`Delete ${G.size} selected`:"Delete selected",children:e.jsx(bt,{})})})]})}),e.jsx("div",{className:"colleges-table-container",children:e.jsxs("table",{className:"colleges-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Proctor Name"}),e.jsx("th",{children:"Day"}),e.jsx("th",{children:"Time Slot"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Remarks"}),e.jsx("th",{children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{children:"Actions"}),e.jsx("input",{type:"checkbox",checked:Ue,onChange:et,disabled:T||Ne.length===0,"aria-label":"Select all",title:"Select all",style:{marginLeft:"auto"}})]})})]})}),e.jsx("tbody",{children:Ne.length===0&&!$?e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",padding:"20px"},children:T?"Loading availability...":"No availability found."})}):Ne.map((s,x)=>{var v,X;return e.jsxs("tr",{children:[e.jsx("td",{children:x+1}),e.jsx("td",{children:s.user_fullname}),e.jsx("td",{children:(v=s.days)==null?void 0:v.map(Se=>new Date(Se).toLocaleDateString()).join(", ")}),e.jsx("td",{children:(X=s.time_slots)==null?void 0:X.join(", ")}),e.jsx("td",{children:e.jsx("span",{style:{padding:"4px 8px",borderRadius:"999px",color:"white",backgroundColor:s.status==="available"?"green":"red",fontSize:"0.8rem",textTransform:"capitalize"},children:s.status})}),e.jsx("td",{children:s.remarks?e.jsx("button",{type:"button",className:"icon-button view-button",onClick:()=>{u(s.remarks),J(!0)},children:e.jsx(Ut,{})}):"—"}),e.jsxs("td",{className:"action-buttons",style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("button",{type:"button",className:"icon-button",onClick:()=>Re(s),children:e.jsx(es,{style:{color:"#092C4C"}})}),e.jsx("input",{type:"checkbox",checked:G.has(s.availability_id),onChange:()=>Ee(s.availability_id),"aria-label":`Select ${s.user_fullname}`,style:{marginLeft:"auto"}})]})]},s.availability_id)})})]})}),Q&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal",children:[e.jsx("h3",{style:{textAlign:"center"},children:D?"Edit Availability":"Add Availability"}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Days"}),e.jsx("input",{type:"text",readOnly:!0,value:F.length>0?F.map(s=>new Date(s).toLocaleDateString()).join(", "):"Select Date(s)",onClick:()=>E.length>0&&L(!b)}),b&&e.jsxs("div",{className:"date-picker",children:[e.jsxs("div",{className:"date-picker-header",children:[e.jsx("button",{type:"button",onClick:B,children:e.jsx(zt,{})}),e.jsx("span",{children:W.toLocaleDateString("en-US",{month:"long",year:"numeric"})}),e.jsx("button",{type:"button",onClick:re,children:e.jsx(Jt,{})})]}),e.jsxs("div",{className:"date-picker-grid",children:[["S","M","T","W","T","F","S"].map((s,x)=>e.jsx("div",{className:"day-name",children:s},x)),A().map((s,x)=>{const v=s?he(new Date(W.getFullYear(),W.getMonth(),s)):"",X=E.includes(v),Se=F.includes(v);return e.jsx("div",{className:`calendar-day ${s?"selectable":""} ${Se?"selected":""} ${X?"allowed":"disabled"}`,onClick:()=>X&&p(s),style:{pointerEvents:X?"auto":"none",opacity:X?1:.3},children:s},x)})]}),e.jsxs("div",{className:"date-picker-footer",children:[e.jsx("button",{type:"button",onClick:Z,children:"Now"}),e.jsx("button",{type:"button",onClick:()=>L(!1),children:"Close"})]})]})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Time Slot"}),e.jsx(lt,{options:Object.values(ps).map(s=>({label:s,value:s})),value:C.map(s=>({label:s,value:s})),onChange:s=>O(s.map(x=>x.value)),isMulti:!0,closeMenuOnSelect:!1,components:{MultiValue:I},styles:{valueContainer:s=>({...s,maxHeight:"120px",overflowY:"auto"})}})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Status"}),e.jsx("select",{value:ee,onChange:s=>P(s.target.value),children:Object.values(gs).map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Remarks"}),e.jsx("textarea",{value:ie,onChange:s=>ne(s.target.value)})]}),D?e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Instructor"}),e.jsx(lt,{options:ge,value:f,onChange:s=>r(s)})]}):e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Instructors (multi-select)"}),e.jsx(lt,{options:Y,value:M,onChange:ye,isMulti:!0,closeMenuOnSelect:!1,components:{MultiValue:I},styles:{valueContainer:s=>({...s,maxHeight:"120px",overflowY:"auto"})}})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:d,disabled:$,children:$?"Saving...":"Save"}),e.jsx("button",{type:"button",onClick:()=>pe(!1),children:"Cancel"})]})]})}),V&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal",children:[e.jsx("h3",{children:"Remarks"}),e.jsx("div",{children:U}),e.jsx("div",{className:"modal-actions",children:e.jsx("button",{type:"button",onClick:()=>J(!1),children:"Close"})})]})}),e.jsx(ft,{position:"top-right",autoClose:3e3})]})},Fa=({scheduleData:o})=>{const[l,i]=t.useState(0),F=5,R=["07:00","07:30","08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30","21:00"],C=D=>{const[te,ge]=D.split(":");let w=Number(te);const M=w>=12?"PM":"AM";return w=w%12||12,`${w}:${ge} ${M}`},O=R.slice(0,-1).map((D,te)=>({start24:D,end24:R[te+1],label:`${C(D)} - ${C(R[te+1])}`})),ee=D=>{const te=["#79b4f2","#f27f79","#79f2b4","#f2e279","#b479f2","#f279d6","#79d6f2","#d6f279","#f29979","#a3f279","#f279a3","#79a3f2","#f2c879","#79f2e2","#f2a879","#b4f279","#f27979","#79f279","#79f2d6","#f279f2","#79f2f2","#f2b479","#c879f2","#79f2a8","#f2d679","#a879f2","#79f2c8","#f279b4","#f2f279","#79b4f2"],ge={};return D.forEach((w,M)=>{ge[w]=te[M%te.length]}),ge},P=Array.from(new Set(o.schedules.map(D=>D.course_id))),ie=ee(P),ne=Array.from(new Set(o.schedules.map(D=>D.exam_date))).sort(),ce=Array.from(new Set(o.schedules.map(D=>D.room_id))).sort((D,te)=>{const ge=Number(D),w=Number(te);return!isNaN(ge)&&!isNaN(w)?ge-w:D.localeCompare(te,void 0,{numeric:!0})}),H=Math.max(1,Math.ceil(ce.length/F)),Q=ce.slice(l*F,(l+1)*F),pe=D=>{const te=o.schedules.filter(f=>f.exam_date===D),ge={},w={};te.forEach(f=>{const r=`${D}-${f.room_id}`;w[r]||(w[r]=[]),w[r].push(f)});const M={};Q.forEach(f=>{var b;const r=((b=o.schedules.find(L=>L.room_id===f))==null?void 0:b.building_name)||o.building;M[r]||(M[r]=[]),M[r].push(f)});const n=Object.keys(M).length;return e.jsxs("table",{className:"dean-exam-table",children:[e.jsxs("thead",{children:[e.jsx("tr",{children:e.jsx("th",{colSpan:Q.length+1,children:new Date(D).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})}),n>1?e.jsxs("tr",{children:[e.jsx("th",{}),Object.entries(M).map(([f,r])=>e.jsx("th",{colSpan:r.length,children:f},f))]}):e.jsx("tr",{children:e.jsx("th",{colSpan:Q.length+1,children:Object.keys(M)[0]})}),e.jsxs("tr",{children:[e.jsx("th",{children:"Time"}),Q.map(f=>e.jsx("th",{children:f},f))]})]}),e.jsx("tbody",{children:O.map((f,r)=>e.jsxs("tr",{children:[e.jsx("td",{children:f.label}),Q.map(b=>{const L=`${D}-${b}-${r}`;if(ge[L])return null;const q=(w[`${D}-${b}`]||[]).find(J=>{const ue=J.exam_start_time.slice(11,16),T=J.exam_end_time.slice(11,16),[N,_e]=ue.split(":").map(Number),[K,be]=T.split(":").map(Number),z=N*60+_e,G=K*60+be,y=Number(f.start24.split(":")[0])*60+Number(f.start24.split(":")[1]),I=Number(f.end24.split(":")[0])*60+Number(f.end24.split(":")[1]);return z<I&&G>y});if(!q)return e.jsx("td",{},b);const E=q.exam_start_time.slice(11,16),se=q.exam_end_time.slice(11,16),[k,de]=E.split(":").map(Number),[$,c]=se.split(":").map(Number),U=k*60+de,u=$*60+c,V=Math.ceil((u-U)/30);for(let J=0;J<V;J++){const ue=O.findIndex(T=>{const N=Number(T.start24.split(":")[0])*60+Number(T.start24.split(":")[1]),_e=Number(T.end24.split(":")[0])*60+Number(T.end24.split(":")[1]);return U>=N&&U<_e});ue+J<O.length&&(ge[`${D}-${b}-${ue+J}`]=!0)}return e.jsx("td",{rowSpan:V,children:e.jsxs("div",{className:"dean-schedule-cell",style:{backgroundColor:ie[q.course_id]||"#ccc",color:"black"},children:[e.jsx("p",{children:e.jsx("strong",{children:q.course_id})}),e.jsx("p",{children:q.section_name}),e.jsxs("p",{children:["Instructor: ",q.instructor]}),e.jsxs("p",{children:["Proctor: ",q.proctor]}),e.jsxs("p",{children:[C(E)," - ",C(se)]})]})},b)})]},f.start24))})]})};return e.jsxs("div",{className:"dean-schedule-viewer",children:[e.jsxs("div",{className:"dean-schedule-header",children:[e.jsx("img",{src:"../../static/logo/USTPlogo.png",alt:"School Logo",className:"dean-schedule-logo"}),e.jsx("div",{className:"dean-schedule-title",children:"University of Science and Technology of Southern Philippines"}),e.jsx("div",{className:"dean-schedule-subtitle",children:"Alubijid | Balubal | Cagayan de Oro City | Claveria | Jasaan | Oroquieta | Panaon | Villanueva"}),e.jsx("div",{className:"dean-schedule-college",children:o.college_name}),e.jsxs("div",{className:"dean-schedule-info",children:[e.jsxs("strong",{children:[o.term," Examination Schedule"]})," | ",o.semester," Semester | A.Y. ",o.academic_year]}),e.jsx("div",{className:"dean-schedule-period",children:o.exam_period})]}),e.jsx("hr",{}),H>1&&e.jsxs("div",{className:"dean-schedule-pagination",children:[e.jsx("button",{onClick:()=>i(D=>Math.max(0,D-1)),disabled:l===0,className:"dean-page-btn",children:e.jsx(zt,{})}),e.jsxs("span",{children:["Page ",l+1," of ",H]}),e.jsx("button",{onClick:()=>i(D=>Math.min(H-1,D+1)),disabled:l>=H-1,className:"dean-page-btn",children:e.jsx(Jt,{})})]}),e.jsx("div",{className:"dean-schedule-container",children:ne.map(D=>e.jsx("div",{className:"dean-schedule-date-section",children:pe(D)},D))})]})},Ba=({user:o})=>{var de;const[l,i]=t.useState([]),[F,R]=t.useState([]),[C,O]=t.useState(null),[ee,P]=t.useState(!1),[ie,ne]=t.useState(!1),[ce,H]=t.useState(""),[Q,pe]=t.useState(!1),[D,te]=t.useState(null),[ge,w]=t.useState(!1),[M,n]=t.useState("pending"),[f,r]=t.useState(!1);t.useEffect(()=>{(async()=>{if(!(o!=null&&o.user_id)){console.log("❌ No user_id provided");return}try{console.log("🔍 Fetching college for dean:",o.user_id);const c=await g.get("/tbl_user_role",{params:{user_id:o.user_id,role_id:1}});if(console.log("📋 Dean roles response:",c.data),!c.data||c.data.length===0){console.error("❌ No dean role found for user:",o.user_id),a.error("No dean role found for user");return}const U=c.data[0];console.log("✅ Dean role found:",U);const u=U.college_id;if(console.log("🏛️ Dean college_id:",u),!u){console.error("❌ Dean role has no college_id"),a.error("Dean role has no college assigned");return}const V=await g.get(`/tbl_college/${u}/`);console.log("🏛️ Dean's college:",V.data),te(V.data.college_name),console.log("✅ College name set:",V.data.college_name)}catch(c){console.error("❌ Error fetching dean college:",c),a.error("Failed to load college information")}})()},[o]),t.useEffect(()=>{if(!D){console.log("⏸️ Skipping request fetch - no college name yet");return}const $=async()=>{try{console.log("📥 Fetching pending requests for college:",D);const U=await g.get("/tbl_scheduleapproval/",{params:{status:"pending",college_name:D}});console.log("📦 Raw response:",U.data),console.log(`✅ Found ${U.data.length} pending requests`);const u=U.data.map(V=>{var J,ue;return console.log("Processing row:",{request_id:V.request_id,status:V.status,college_name:V.college_name,submitted_by:V.submitted_by_name}),{request_id:V.request_id,sender_name:V.submitted_by_name||`${((J=V.submitted_by)==null?void 0:J.first_name)||""} ${((ue=V.submitted_by)==null?void 0:ue.last_name)||""}`.trim()||"Unknown",subject:"Exam Schedule Request",remarks:V.remarks,schedule_data:V.schedule_data,submitted_at:new Date(V.submitted_at||V.created_at).toLocaleString(),status:V.status,college_name:V.college_name}});console.log("✅ Mapped requests:",u),i(u)}catch(U){console.error("❌ Error fetching pending requests:",U),a.error("Failed to load pending requests")}};$();const c=setInterval($,1e4);return()=>clearInterval(c)},[D]),t.useEffect(()=>{if(!D)return;(async()=>{try{console.log("📥 Fetching history for college:",D);const c=await g.get("/tbl_scheduleapproval/",{params:{college_name:D,limit:50}});console.log("📦 History response:",c.data.length,"records");const U=c.data.filter(u=>u.status!=="pending").map(u=>{var V,J;return{request_id:u.request_id,sender_name:u.submitted_by_name||`${((V=u.submitted_by)==null?void 0:V.first_name)||""} ${((J=u.submitted_by)==null?void 0:J.last_name)||""}`.trim()||"Unknown",subject:"Exam Schedule Request",remarks:u.remarks,schedule_data:u.schedule_data,submitted_at:new Date(u.submitted_at||u.created_at).toLocaleString(),status:u.status,college_name:u.college_name}});console.log("✅ Filtered history:",U.length,"records"),R(U)}catch(c){console.error("❌ Error fetching history:",c)}})()},[D,l]);const b=async $=>{if(globalThis.confirm(`Delete this request for ${$.college_name}?`))try{await g.delete(`/tbl_scheduleapproval/${$.request_id}/`),i(U=>U.filter(u=>u.request_id!==$.request_id)),R(U=>U.filter(u=>u.request_id!==$.request_id)),a.success("Request deleted"),O(null)}catch(U){console.error("Delete failed:",U),a.error("Failed to delete request")}},L=async()=>{if(C)try{await g.put(`/tbl_scheduleapproval/${C.request_id}/`,{status:M}),a.success(`Status updated to ${M.toUpperCase()}`),R($=>$.map(c=>c.request_id===C.request_id?{...c,status:M}:c)),i($=>$.map(c=>c.request_id===C.request_id?{...c,status:M}:c)),w(!1)}catch($){console.error("Update status failed:",$),a.error("Failed to update status")}},W=$=>{O($),pe(!0)},q=async($,c,U,u,V)=>{try{const J={user_id:$,sender_id:c,title:`Schedule ${U==="approved"?"Approved":"Rejected"}`,message:U==="approved"?`Your schedule submission for ${u} has been approved by the dean.`:`Your schedule submission for ${u} has been rejected. Reason: ${V||"No reason provided"}`,type:"schedule_response",status:"unread",link_url:"/scheduler",is_seen:!1,priority:U==="rejected"?2:1};await g.post("/notifications/create/",J),console.log(`✅ Notification sent to scheduler ${$}`)}catch(J){console.error("❌ Failed to send notification to scheduler:",J)}},E=async()=>{var $,c,U;if(C){if(!ce.trim()){a.warn("Please provide a reason for rejection");return}ne(!0);try{await g.put(`/tbl_scheduleapproval/${C.request_id}/`,{status:"rejected",remarks:ce});const u=(($=C.schedule_data)==null?void 0:$.submitted_by_id)||(await g.get(`/tbl_scheduleapproval/${C.request_id}/`)).data.submitted_by;u&&(o!=null&&o.user_id)&&await q(u,o.user_id,"rejected",((c=C.schedule_data)==null?void 0:c.college_name)||"Unknown College",ce),a.success(`Schedule for ${(U=C.schedule_data)==null?void 0:U.college_name} rejected`),i(V=>V.filter(J=>J.request_id!==C.request_id)),R(V=>[{...C,status:"rejected",remarks:ce},...V]),pe(!1),H(""),O(null)}catch(u){console.error("Rejection error:",u),a.error("Failed to reject schedule")}finally{ne(!1)}}},se=async $=>{var U,u,V,J;if(!(ie||!globalThis.confirm(`Approve the schedule for ${(U=$.schedule_data)==null?void 0:U.college_name}?`))){ne(!0);try{await g.put(`/tbl_scheduleapproval/${$.request_id}/`,{status:"approved"});const ue=((u=$.schedule_data)==null?void 0:u.submitted_by_id)||(await g.get(`/tbl_scheduleapproval/${$.request_id}/`)).data.submitted_by;ue&&(o!=null&&o.user_id)&&await q(ue,o.user_id,"approved",((V=$.schedule_data)==null?void 0:V.college_name)||"Unknown College"),a.success(`Schedule for ${(J=$.schedule_data)==null?void 0:J.college_name} approved successfully!`),i(T=>T.filter(N=>N.request_id!==$.request_id)),R(T=>[{...$,status:"approved"},...T]),O(null),r(!1)}catch(ue){console.error("Approval error:",ue),a.error("Failed to approve schedule")}finally{ne(!1)}}},k=$=>$.length===0?e.jsx("div",{style:{textAlign:"center",padding:"40px 20px",color:"#666"},children:ee?"No approval history yet":"No pending requests"}):$.map(c=>{var U;return e.jsxs("div",{className:"deanreq-card",onClick:()=>{O(c),r(!1)},style:{borderLeft:c.status==="approved"?"4px solid #4CAF50":c.status==="rejected"?"4px solid #f44336":"4px solid #FF9800"},children:[e.jsxs("div",{className:"deanreq-left",children:[e.jsx("span",{className:"deanreq-icon",children:c.status==="approved"?e.jsx(js,{style:{color:"#4CAF50"}}):c.status==="rejected"?e.jsx(bs,{style:{color:"#f44336"}}):"⏵"}),e.jsx("span",{className:"deanreq-sender",children:c.sender_name})]}),e.jsxs("div",{className:"deanreq-center",children:[((U=c.schedule_data)==null?void 0:U.college_name)||c.subject,c.schedule_data&&e.jsxs("span",{style:{fontSize:"11px",marginLeft:"8px",color:"#666"},children:["(",c.schedule_data.total_schedules," schedules)"]})]}),e.jsxs("div",{className:"deanreq-date",children:[c.submitted_at,c.status&&c.status!=="pending"&&e.jsx("span",{style:{marginLeft:8,padding:"2px 8px",borderRadius:"4px",fontSize:"11px",fontWeight:"bold",backgroundColor:c.status==="approved"?"#4CAF50":"#f44336",color:"white"},children:c.status.toUpperCase()})]})]},c.request_id)});return e.jsxs("div",{className:"deanreq-container",children:[e.jsxs("div",{className:"deanreq-banner",children:["Schedule Approval Requests",e.jsx("span",{className:"deanreq-history-icon",onClick:()=>P($=>!$),title:ee?"View pending requests":"View history",style:{float:"right",cursor:"pointer",fontSize:"1.2rem",color:ee?"#4CAF50":"inherit"},children:e.jsx(ta,{})})]}),e.jsx("p",{className:"deanreq-message",children:ee?`Showing approval history (${F.length} records)`:`You have ${l.length} pending request(s) from schedulers`}),k(ee?F:l),C&&e.jsx("div",{className:"deanreq-modal-overlay",onClick:()=>{O(null),r(!1)},children:e.jsxs("div",{className:"deanreq-modal-pane",onClick:$=>$.stopPropagation(),style:{maxWidth:f?"95vw":"600px",width:f?"90%":"auto",maxHeight:"90vh",overflow:"auto"},children:[f?e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px",borderBottom:"2px solid #092C4C",paddingBottom:"10px"},children:[e.jsx("h3",{style:{margin:0},children:"Schedule Preview"}),e.jsx("button",{type:"button",onClick:()=>r(!1),style:{padding:"5px 10px",background:"#666",color:"white",border:"none",borderRadius:"100px",cursor:"pointer",fontWeight:"bold"},children:e.jsx(zt,{})})]}):e.jsxs("h3",{children:["From: ",C.sender_name]}),f?C.schedule_data&&e.jsx(Fa,{scheduleData:C.schedule_data}):e.jsxs(e.Fragment,{children:[e.jsx("h4",{children:((de=C.schedule_data)==null?void 0:de.college_name)||C.subject}),C.schedule_data&&e.jsxs("div",{style:{marginTop:"15px",padding:"15px",background:"#f5f5f5",borderRadius:"8px"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Exam Period:"})," ",C.schedule_data.exam_period]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Term:"})," ",C.schedule_data.term]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Semester:"})," ",C.schedule_data.semester]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Academic Year:"})," ",C.schedule_data.academic_year]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Total Schedules:"})," ",C.schedule_data.total_schedules]}),e.jsx("button",{type:"button",onClick:()=>r(!0),style:{marginTop:"10px",padding:"5px 10px",background:"#092C4C",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",fontSize:"10px",fontWeight:"bold"},children:"View Schedule"})]})]}),e.jsxs("div",{style:{marginTop:"20px",display:"flex",gap:"10px",justifyContent:"flex-end",borderTop:f?"2px solid #ddd":"none",paddingTop:f?"15px":"0"},children:[!ge&&e.jsxs(e.Fragment,{children:[!f&&e.jsx("button",{type:"button",onClick:()=>O(null),className:"deanreq-btn1 cancel",children:"Close"}),!f&&e.jsx("button",{type:"button",className:"deanreq-btn1 deny",style:{backgroundColor:"#d32f2f",color:"white"},onClick:()=>b(C),children:"Delete"}),!f&&C.status!=="pending"&&e.jsx("button",{type:"button",className:"deanreq-btn",style:{backgroundColor:"#FF9800",color:"white",borderRadius:"50px"},onClick:()=>{w(!0),n(C.status||"pending")},children:"Edit Status"}),C.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:()=>W(C),className:"deanreq-btn1 deny",children:"Reject"}),e.jsx("button",{type:"button",onClick:()=>se(C),className:"deanreq-btn1 approve",children:"Approve"})]})]}),ge&&e.jsxs(e.Fragment,{children:[e.jsxs("select",{value:M,onChange:$=>n($.target.value),style:{padding:"6px",borderRadius:"4px",border:"1px solid #ccc",background:"white",color:"black"},children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"approved",children:"Approved"}),e.jsx("option",{value:"rejected",children:"Rejected"})]}),e.jsx("button",{type:"button",className:"deanreq-btn approve",onClick:L,children:"Save"}),e.jsx("button",{type:"button",className:"deanreq-btn cancel",onClick:()=>w(!1),children:"Cancel"})]})]})]})}),Q&&e.jsx("div",{className:"deanreq-modal-overlay",onClick:()=>pe(!1),children:e.jsxs("div",{className:"deanreq-modal-pane",onClick:$=>$.stopPropagation(),children:[e.jsx("h3",{children:"Rejection Reason"}),e.jsx("textarea",{value:ce,onChange:$=>H($.target.value),placeholder:"Enter reason for rejection...",rows:5,style:{width:"100%",padding:"10px",borderRadius:"6px",border:"1px solid #ccc"}}),e.jsxs("div",{style:{marginTop:"20px",display:"flex",gap:"10px",justifyContent:"flex-end"},children:[e.jsx("button",{type:"button",onClick:()=>pe(!1),className:"deanreq-btn cancel",children:"Cancel"}),e.jsx("button",{type:"button",onClick:E,className:"deanreq-btn deny",disabled:ie,children:ie?"Rejecting...":"Confirm Rejection"})]})]})}),e.jsx(ft,{position:"top-right",autoClose:3e3})]})};function Ua(o,l){let i;return(...F)=>{clearTimeout(i),i=setTimeout(()=>o(...F),l)}}const Oa=({user:o})=>{var z,G;const[l,i]=t.useState([]),[F,R]=t.useState([]),[C,O]=t.useState(null),[ee,P]=t.useState(null),[ie,ne]=t.useState([]),[ce,H]=t.useState("Lecture"),[Q,pe]=t.useState("All"),[D,te]=t.useState(""),[ge,w]=t.useState(""),[M,n]=t.useState(!1),[f,r]=t.useState(!1),[b,L]=t.useState(!1),[W,q]=t.useState(!0),[E,se]=t.useState({}),[k,de]=t.useState({visible:!1,roomId:null}),[$,c]=t.useState({});t.useEffect(()=>{(async()=>{try{q(!0);const je=(await g.get("/tbl_rooms")).data.map(A=>({room_id:A.room_id,room_name:A.room_name,room_type:A.room_type,building_id:A.building_id,room_capacity:A.room_capacity}));i(je);const m=(await g.get("/tbl_buildings")).data.map(A=>({building_id:A.building_id,building_name:A.building_name}));R(m);const j=(await g.get("/tbl_examdetails")).data,h={};j.forEach(A=>{h[A.room_id]||(h[A.room_id]={occupiedTimes:[]}),h[A.room_id].occupiedTimes.push({start:A.exam_start_time,end:A.exam_end_time})}),c(h),o!=null&&o.user_id&&await U()}catch(I){console.error("Error fetching data:",I),a.error("Failed to load room data")}finally{q(!1)}})()},[o]);const U=async()=>{var y;try{const je=(y=(await g.get(`/tbl_user_role?user_id=${o==null?void 0:o.user_id}&role_id=3`)).data[0])==null?void 0:y.college_id;if(je){const m=(await g.get(`/tbl_available_rooms/?college_id=${je}`)).data.map(me=>{var j;return((j=me.room)==null?void 0:j.room_id)||me.room_id});ne(m.filter(me=>me))}}catch(I){console.error("Error fetching selected rooms:",I)}},u=y=>{const I=new Date;I.setHours(7,30,0,0);const je=new Date;je.setHours(21,0,0,0);const Ce=$[y],m=(Ce==null?void 0:Ce.occupiedTimes.map(h=>({start:new Date(h.start),end:new Date(h.end)})).sort((h,A)=>h.start.getTime()-A.start.getTime()))||[],me=[];let j=new Date(I);for(const h of m)j.getTime()<h.start.getTime()&&me.push({start:new Date(j),end:new Date(h.start),occupied:!1}),me.push({start:new Date(h.start),end:new Date(h.end),occupied:!0}),j=new Date(h.end);return j.getTime()<je.getTime()&&me.push({start:new Date(j),end:new Date(je),occupied:!1}),me},V=({roomId:y})=>{const I=u(y);return e.jsx("div",{className:"rm-timeslots",children:I.map((je,Ce)=>e.jsxs("div",{className:`rm-timeslot ${je.occupied?"occupied":"vacant"}`,children:[e.jsxs("span",{children:[je.start.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})," -",je.end.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]}),e.jsx("span",{className:"status",children:je.occupied?"Occupied":"Available"})]},Ce))})},J=async(y,I)=>{if(isNaN(I)||I<=0){a.warn("Invalid capacity");return}try{await g.put(`/tbl_rooms/${y}/`,{room_capacity:I}),i(je=>je.map(Ce=>Ce.room_id===y?{...Ce,room_capacity:I}:Ce)),a.success(`Saved capacity for ${y}`)}catch(je){console.error("Error updating capacity:",je),a.error("Failed to update capacity")}},ue=async()=>{var y,I,je;r(!0);try{const m=(y=(await g.get(`/tbl_user_role?user_id=${o==null?void 0:o.user_id}&role_id=3`)).data[0])==null?void 0:y.college_id;if(!m){a.error("College not found."),r(!1);return}const me=await g.get(`/tbl_available_rooms/?college_id=${m}`);console.log("Available rooms to delete:",me.data);let j=0,h=0;for(const A of me.data){let he=null;if(A.room&&typeof A.room=="object"?he=A.room.room_id:A.room_id&&(he=A.room_id),console.log("Room data:",A),console.log("Attempting to delete room:",he,"for college:",m),he)try{await g.delete(`/tbl_available_rooms/${he}/${m}/`),j++,console.log("Successfully deleted:",he)}catch(p){h++,console.error("Failed to delete room:",he,((I=p.response)==null?void 0:I.data)||p)}else console.error("Could not extract room_id from:",A),h++}ne([]),j>0?a.success(`Successfully reset ${j} available room(s).`):h>0?a.error("Failed to reset rooms. Check console for details."):a.info("No rooms to reset."),n(!1)}catch(Ce){console.error("Reset error:",((je=Ce.response)==null?void 0:je.data)||Ce),a.error("An error occurred while resetting rooms.")}finally{r(!1)}},T=Ua(J,300),N=(y,I)=>{se(je=>({...je,[y]:I})),T(y,I)},_e=async()=>{var y,I,je,Ce,m;if(ie.length===0){a.warn("Please select at least one room");return}L(!0);try{const j=(y=(await g.get(`/tbl_user_role?user_id=${o==null?void 0:o.user_id}&role_id=3`)).data[0])==null?void 0:y.college_id;if(!j){a.error("College not found."),L(!1);return}const A=(await g.get(`/tbl_available_rooms/?college_id=${j}`)).data.map(async B=>{var Z;const re=((Z=B.room)==null?void 0:Z.room_id)||B.room_id;if(re)try{await g.delete(`/tbl_available_rooms/${re}/${j}/`)}catch(we){console.error(`Failed to delete room ${re}:`,we)}});await Promise.all(A);let he=0,p=0;for(const B of ie)try{await g.post("/tbl_available_rooms/",{room_id:B,college_id:j}),he++}catch(re){p++,console.error("Error posting room:",B,(I=re.response)==null?void 0:I.data)}he>0&&a.success(`Saved ${he} available room(s)!`),p>0&&a.warn(`Failed to save ${p} room(s).`)}catch(me){console.error("Error in handleSaveRooms:",((je=me.response)==null?void 0:je.data)||me),a.error(((m=(Ce=me.response)==null?void 0:Ce.data)==null?void 0:m.error)||"An error occurred while saving")}finally{L(!1)}},K=l.filter(y=>!C||y.building_id===C).filter(y=>ce==="All"||y.room_type===ce).filter(y=>D===""||y.room_name.toLowerCase().includes(D.toLowerCase())),be=l.filter(y=>!ee||y.building_id===ee).filter(y=>Q==="All"||y.room_type===Q).filter(y=>ge===""||y.room_name.toLowerCase().includes(ge.toLowerCase()));return W?e.jsxs("div",{className:"rm-loading-container",children:[e.jsx("div",{className:"rm-spinner"}),e.jsx("p",{style:{color:"#092C4C",marginTop:"10px"},children:"Loading room data..."})]}):e.jsxs("div",{className:"rm-container",children:[e.jsxs("div",{className:"rm-card",children:[e.jsxs("div",{className:"rm-title-row",style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[e.jsx("h3",{className:"rm-title",style:{margin:0},children:"Select Rooms for Modality"}),e.jsxs("div",{style:{display:"flex",gap:"8px"},children:[e.jsx("button",{type:"button",className:"rm-save-btn",onClick:_e,disabled:b||ie.length===0,style:{padding:"6px 12px",backgroundColor:"#0A3765",color:"white",border:"none",borderRadius:"20px",cursor:b||ie.length===0?"not-allowed":"pointer"},children:b?"Saving...":"Save"}),e.jsx("button",{type:"button",className:"rm-reset-btn",onClick:()=>n(!0),style:{padding:"6px 12px",backgroundColor:"#B3261E",color:"white",border:"none",borderRadius:"20px",cursor:"pointer"},children:"Reset"})]})]}),e.jsxs("div",{className:"rm-field",children:[e.jsx("label",{children:"Room Type Filter"}),e.jsx(lt,{options:[{value:"All",label:"All"},{value:"Lecture",label:"Lecture"},{value:"Laboratory",label:"Laboratory"}],value:{value:ce,label:ce},onChange:y=>H((y==null?void 0:y.value)||"All")})]}),e.jsxs("div",{className:"rm-field",children:[e.jsx("label",{children:"Building Filter"}),e.jsx(lt,{options:F.map(y=>({value:y.building_id,label:`${y.building_name} (${y.building_id})`})),value:C?{value:C,label:(z=F.find(y=>y.building_id===C))==null?void 0:z.building_name}:null,onChange:y=>O((y==null?void 0:y.value)||null),isClearable:!0,placeholder:"-- Select Building --"})]}),e.jsxs("div",{className:"rm-field",children:[e.jsx("label",{children:"Search Room"}),e.jsx(lt,{options:K.map(y=>({value:y.room_name,label:`${y.room_name} (${y.room_id})`})),onChange:y=>te((y==null?void 0:y.value)||""),isClearable:!0,isSearchable:!0,placeholder:"Search or select a room..."})]}),e.jsx("div",{className:"rm-room-grid",children:K.map(y=>{const I=ie.includes(y.room_id);return e.jsxs("div",{className:`rm-room-box ${I?"selected":""}`,children:[e.jsxs("div",{onClick:()=>ne(je=>I?je.filter(Ce=>Ce!==y.room_id):[...je,y.room_id]),children:[y.room_id," ",e.jsxs("span",{className:"rm-room-type",children:["(",y.room_type,")"]})]}),e.jsx("button",{type:"button",className:"rm-vacancy-btn",onClick:()=>de({visible:!0,roomId:y.room_id}),children:"View Vacancy"})]},y.room_id)})})]}),e.jsxs("div",{className:"rm-card",children:[e.jsx("h3",{className:"rm-title",children:"Manage Room Capacity"}),e.jsxs("div",{className:"rm-field",children:[e.jsx("label",{children:"Building Filter"}),e.jsx(lt,{options:F.map(y=>({value:y.building_id,label:`${y.building_name} (${y.building_id})`})),value:ee?{value:ee,label:(G=F.find(y=>y.building_id===ee))==null?void 0:G.building_name}:null,onChange:y=>P((y==null?void 0:y.value)||null),isClearable:!0,placeholder:"-- Select Building --"})]}),e.jsxs("div",{className:"rm-field",children:[e.jsx("label",{children:"Room Type Filter"}),e.jsx(lt,{options:[{value:"All",label:"All"},{value:"Lecture",label:"Lecture"},{value:"Laboratory",label:"Laboratory"}],value:{value:Q,label:Q},onChange:y=>pe((y==null?void 0:y.value)||"All")})]}),e.jsxs("div",{className:"rm-field",children:[e.jsx("label",{children:"Search Room"}),e.jsx(lt,{options:be.map(y=>({value:y.room_name,label:`${y.room_name} (${y.room_id})`})),onChange:y=>w((y==null?void 0:y.value)||""),isClearable:!0,isSearchable:!0,placeholder:"Search or select a room..."})]}),e.jsxs("div",{className:"rm-room-table",children:[e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:"10px"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#092c4c",textAlign:"left"},children:[e.jsx("th",{style:{padding:"8px"},children:"Room #"}),e.jsx("th",{style:{padding:"8px"},children:"Room Name"}),e.jsx("th",{style:{padding:"8px"},children:"Type"}),e.jsx("th",{style:{padding:"8px"},children:"Capacity"})]})}),e.jsx("tbody",{children:be.map(y=>e.jsxs("tr",{style:{borderBottom:"1px solid #ddd"},children:[e.jsx("td",{style:{color:"black",padding:"8px"},children:y.room_id}),e.jsx("td",{style:{color:"black",padding:"8px"},children:y.room_name}),e.jsx("td",{style:{color:"black",padding:"8px"},children:y.room_type}),e.jsx("td",{style:{color:"black",padding:"8px"},children:e.jsx("input",{type:"number",min:1,value:E[y.room_id]??y.room_capacity,onChange:I=>N(y.room_id,Number(I.target.value)),style:{width:"60px",padding:"4px",border:"1px solid #ccc",borderRadius:"4px",backgroundColor:"white",color:"#092C4C"}})})]},y.room_id))})]}),be.length===0&&e.jsx("p",{style:{textAlign:"center",color:"#888",marginTop:"10px"},children:"No rooms found."})]})]}),k.visible&&k.roomId&&e.jsx("div",{className:"rm-modal-overlay",onClick:()=>de({visible:!1,roomId:null}),children:e.jsxs("div",{className:"rm-modal-content",onClick:y=>y.stopPropagation(),children:[e.jsxs("h3",{children:["Room Occupancy: ",k.roomId]}),e.jsx(V,{roomId:k.roomId}),e.jsx("button",{type:"button",className:"rm-close-btn",onClick:()=>de({visible:!1,roomId:null}),children:"Close"})]})}),M&&e.jsx("div",{className:"rm-modal-overlay",onClick:()=>n(!1),children:e.jsxs("div",{className:"rm-modal-content",onClick:y=>y.stopPropagation(),children:[e.jsx("h3",{children:"Reset Available Rooms"}),e.jsxs("p",{children:["This will ",e.jsx("strong",{children:"remove all rooms you have marked as available for modality"}),". Other users' configurations will not be affected. Are you sure you want to continue?"]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"20px"},children:[e.jsx("button",{type:"button",onClick:()=>n(!1),style:{padding:"6px 12px",borderRadius:"6px",border:"1px solid #ccc",background:"white",cursor:"pointer"},children:"Cancel"}),e.jsx("button",{type:"button",onClick:ue,disabled:f,style:{padding:"6px 12px",borderRadius:"6px",backgroundColor:"#B3261E",color:"white",border:"none",cursor:f?"not-allowed":"pointer"},children:f?"Resetting...":"Yes, Reset"})]})]})}),e.jsx(ft,{position:"top-right",autoClose:3e3})]})},ut={className:"icon",size:20},za={proctor:[{key:"exam-Date",label:"Exam Date",icon:e.jsx(Ht,{...ut})},{key:"set-Availability",label:"Set Availability",icon:e.jsx(aa,{...ut})},{key:"exam-Schedule",label:"View Exam Schedule",icon:e.jsx(Zt,{...ut})},{key:"notification",label:"Notification",icon:e.jsx(Wt,{...ut})}],scheduler:[{key:"exam-Date",label:"Exam Date",icon:e.jsx(Ht,{...ut})},{key:"plot-Schedule",label:"Plot Schedule",icon:e.jsx(ds,{...ut})},{key:"exam-Schedule",label:"View Exam Schedule",icon:e.jsx(Zt,{...ut})},{key:"proctors-Availability",label:"Available Proctor",icon:e.jsx(as,{...ut})},{key:"notification",label:"Notification",icon:e.jsx(Wt,{...ut})},{key:"Room-Management",label:"Room Management",icon:e.jsx(os,{...ut})}],dean:[{key:"exam-Date",label:"Exam Date",icon:e.jsx(Ht,{...ut})},{key:"notification",label:"Notification",icon:e.jsx(Wt,{...ut})},{key:"Request",label:"Requests",icon:e.jsx(us,{...ut})}],"bayanihan leader":[{key:"exam-Date",label:"Exam Date",icon:e.jsx(Ht,{...ut})},{key:"set-Modality",label:"Set Modality",icon:e.jsx(es,{...ut})},{key:"exam-Schedule",label:"View Exam Schedule",icon:e.jsx(Zt,{...ut})},{key:"notification",label:"Notification",icon:e.jsx(Wt,{...ut})}],admin:[{key:"exam-Date",label:"Exam Date",icon:e.jsx(Ht,{...ut})},{key:"plot-Schedule",label:"Plot Schedule",icon:e.jsx(ds,{...ut})},{key:"exam-Schedule",label:"View Exam Schedule",icon:e.jsx(Zt,{...ut})},{key:"proctors-Availability",label:"Available Proctor",icon:e.jsx(as,{...ut})},{key:"set-Modality",label:"Set Modality",icon:e.jsx(es,{...ut})},{key:"Request",label:"Requests",icon:e.jsx(us,{...ut})},{key:"Room-Management",label:"Room Management",icon:e.jsx(os,{...ut})},{key:"notification",label:"Notification",icon:e.jsx(Wt,{...ut})}]},Ya=()=>{const[o,l]=t.useState(!1),[i,F]=t.useState("dashboard"),[R,C]=t.useState(new Date),[O,ee]=t.useState(null),[P,ie]=t.useState([]),[ne,ce]=t.useState(!1),H=Ot();t.useEffect(()=>{(async()=>{const f=JSON.parse(localStorage.getItem("user")||"null")||JSON.parse(sessionStorage.getItem("user")||"null");if(!f)return H("/");try{const b=(await g.get(`/users/${f.user_id}/`)).data;ee({...b,full_name:`${b.first_name} ${b.middle_name??""} ${b.last_name}`.trim(),avatar_url:b.avatar_url||"../../static/Images/default-pp.jpg"})}catch(r){console.error("Error loading user info:",r),ee({...f,full_name:`${f.first_name} ${f.middle_name??""} ${f.last_name}`.trim(),avatar_url:f.avatar_url||"../../static/Images/default-pp.jpg"})}})()},[H]),t.useEffect(()=>{const n=setInterval(()=>C(new Date),1e3);return()=>clearInterval(n)},[]),t.useEffect(()=>{(async()=>{if(O!=null&&O.user_id)try{const r=(await g.get(`/user-roles/${O.user_id}/roles/`)).data.filter(b=>{var L;return((L=b.status)==null?void 0:L.toLowerCase())==="active"}).map(b=>b.role_name.toLowerCase());ie(r)}catch(f){console.error("Error fetching roles:",f)}})()},[O]);const Q=Array.from(new Map(P.flatMap(n=>za[n]||[]).map(n=>[n.key,n])).values()),pe=()=>{localStorage.removeItem("user"),sessionStorage.removeItem("user"),H("/")},D=R.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}),[te,ge,w]=D.split(/:| /),M=R.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"});return O?e.jsx("div",{className:"app-container",children:e.jsxs("div",{className:"main-content-wrapper",children:[P.length>0&&e.jsxs("aside",{className:`sidebar ${o?"open":"closed"}`,onMouseEnter:()=>l(!0),onMouseLeave:()=>l(!1),children:[e.jsx("div",{className:"sidebar-header",children:e.jsxs("div",{className:"sidebar-logo",children:[e.jsx("img",{src:"../../static/logo/Exam.png",alt:"Logo",className:"logo-img"}),o&&e.jsx("span",{className:"logo-text",children:"ExamSync"})]})}),e.jsx("nav",{className:"sidebar-nav",children:e.jsxs("ul",{children:[e.jsx("li",{className:i==="dashboard"?"active":"",children:e.jsxs("button",{type:"button",onClick:()=>F("dashboard"),children:[e.jsx(Ss,{...ut}),o&&e.jsx("span",{children:"Dashboard"})]})}),Q.map(({key:n,label:f,icon:r})=>e.jsx("li",{className:i===n?"active":"",children:e.jsxs("button",{type:"button",onClick:()=>F(n),children:[r,o&&e.jsx("span",{children:f})]})},n)),e.jsx("div",{className:"sidebar-divider"}),e.jsx("li",{className:i==="profile"?"active":"",children:e.jsxs("button",{type:"button",onClick:()=>F("profile"),children:[e.jsx(vs,{...ut}),o&&e.jsx("span",{children:"Profile"})]})}),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>ce(!0),children:[e.jsx(ws,{}),o&&e.jsx("span",{children:"Logout"})]})})]})}),ne&&e.jsx("div",{className:"myModal-overlay",children:e.jsxs("div",{className:"myModal-box",children:[e.jsx("h3",{className:"myModal-title",children:"Are you sure you want to logout?"}),e.jsxs("div",{className:"myModal-actions",children:[e.jsx("button",{type:"button",onClick:pe,className:"myModal-btn myModal-btn-confirm",children:"Logout"}),e.jsx("button",{type:"button",onClick:()=>ce(!1),className:"myModal-btn myModal-btn-cancel",children:"Cancel"})]})]})})]}),e.jsxs("main",{className:`main-content ${P.length>0&&o?"sidebar-open":"sidebar-closed"}`,children:[e.jsx("div",{className:"content-header",children:e.jsx("h1",{children:i.charAt(0).toUpperCase()+i.slice(1).replace(/-/g," ")})}),i==="dashboard"&&e.jsxs("div",{className:"dashboard-grid",children:[e.jsxs("div",{className:"card welcome-card",children:[e.jsxs("h3",{children:["Welcome, ",e.jsxs("span",{className:"robert-name",children:[O.first_name,"!"]})]}),e.jsx("p",{children:"Organize your work and improve your performance here"}),P.includes("admin")&&e.jsxs("div",{style:{marginTop:"10px",display:"flex",alignItems:"center",gap:"8px",color:"#4CAF50"},children:[e.jsx(sa,{size:16}),e.jsx("span",{style:{fontSize:"14px",fontWeight:"500"},children:"Admin Access Enabled"})]})]}),e.jsxs("div",{className:"card datetime-card",children:[e.jsx("div",{className:"date-display-simple",children:M}),e.jsxs("div",{className:"time-display",children:[e.jsxs("span",{children:[te,":"]}),e.jsx("span",{children:ge}),e.jsx("span",{className:"ampm",children:w})]})]}),e.jsxs("div",{className:"card faculty-info-card",children:[e.jsx("img",{src:O.avatar_url,alt:"Avatar",className:"faculty-avatar"}),e.jsx("h4",{children:O.full_name}),e.jsx("p",{children:P.length?P.map(n=>n.charAt(0).toUpperCase()+n.slice(1)).join(", "):"Loading roles..."})]}),e.jsxs("div",{className:"full-width-section",children:[e.jsx("h2",{children:"Shortcut"}),e.jsxs("div",{className:"try-things-grid",children:[e.jsx("div",{className:"try-thing-card",children:e.jsx(ls,{})}),e.jsx("div",{className:"try-thing-card",children:e.jsx(ns,{})})]})]})]}),i==="exam-Date"&&e.jsx(ls,{}),i==="profile"&&e.jsx(Ns,{user:O}),i==="set-Availability"&&e.jsx(Ca,{user:O}),i==="exam-Schedule"&&e.jsx(ns,{}),i==="notification"&&e.jsx(ka,{user:O}),i==="set-Modality"&&e.jsx(Cs,{user:O}),i==="plot-Schedule"&&e.jsx(Pa,{user:O}),i==="proctors-Availability"&&e.jsx(La,{user:O}),i==="Request"&&e.jsx(Ba,{user:O}),i==="Room-Management"&&e.jsx(Oa,{user:O})]})]})}):e.jsx("div",{style:{color:"black"},children:"Loading..."})},qa=()=>{const[o,l]=t.useState([]),[i,F]=t.useState(""),[R,C]=t.useState(!1),[O,ee]=t.useState(!1),[P,ie]=t.useState(""),[ne,ce]=t.useState(""),[H,Q]=t.useState(!1),[pe,D]=t.useState(null),[te,ge]=t.useState(!1),[w,M]=t.useState(!0),[n,f]=t.useState(!1),[r,b]=t.useState(new Set),[L,W]=t.useState(!1);t.useEffect(()=>{q()},[]);const q=async()=>{M(!0);try{const T=await g.get("/tbl_college/");l(T.data)}catch(T){console.error("Error fetching colleges:",T.message),a.error("Failed to fetch colleges.")}finally{M(!1)}},E=T=>{F(T.target.value)},se=o.filter(T=>T.college_name.toLowerCase().includes(i.toLowerCase())||T.college_id.toLowerCase().includes(i.toLowerCase())),k=T=>{b(N=>{const _e=new Set(N);return _e.has(T)?_e.delete(T):_e.add(T),_e})},de=o.length>0&&o.every(T=>r.has(T.college_id)),$=()=>{b(()=>{if(de)return new Set;const T=new Set;return o.forEach(N=>T.add(N.college_id)),T})},c=()=>b(new Set),U=async()=>{const T=Array.from(r);if(T.length===0){a.info("No colleges selected");return}if(globalThis.confirm(`Delete ${T.length} selected college(s)?`)){W(!0);try{const N=await Promise.allSettled(T.map(be=>g.delete(`/tbl_college/${be}/`))),_e=N.filter(be=>be.status==="fulfilled").length,K=N.length-_e;_e&&a.success(`Deleted ${_e} college(s)`),K&&a.error(`${K} failed to delete`),c(),q()}catch(N){console.error("Bulk delete error:",N),a.error("Bulk delete failed")}finally{W(!1)}}},u=()=>{ie(""),ce(""),Q(!1),D(null),C(!0)},V=async()=>{if(!P.trim()||!ne.trim()){a.error("Please enter both College ID and Name.");return}ge(!0);try{H&&pe!==null?(await g.put(`/tbl_college/${pe}/`,{college_id:P,college_name:ne}),a.success("College updated successfully.")):(await g.post("/tbl_college/",{college_id:P,college_name:ne}),a.success("College added successfully.")),q(),C(!1)}catch(T){console.error(T),a.error("Failed to save college.")}finally{ge(!1)}},J=T=>{var K;const N=(K=T.target.files)==null?void 0:K[0];if(!N)return;const _e=new FileReader;_e.onload=async be=>{var j;f(!0);const z=new Uint8Array(be.target.result),G=At(z,{type:"array"}),y=G.SheetNames[0],I=G.Sheets[y],je=tt.sheet_to_json(I),m=["College ID","College Name"].filter(h=>!Object.keys(je[0]||{}).includes(h));if(m.length){a.error(`Invalid template. Missing headers: ${m.join(", ")}`),f(!1);return}let me=0;for(const h of je){const A=String(h["College ID"]).trim(),he=(j=h["College Name"])==null?void 0:j.trim();if(!(!A||!he))try{await g.post("/tbl_college/",{college_id:A,college_name:he}),me++}catch{a.warn(`Skipped existing: ${he}`)}}a.success(`Import completed! ${me} college(s) added.`),q(),ee(!1),f(!1)},_e.readAsArrayBuffer(N)},ue=()=>{const T=tt.aoa_to_sheet([["College ID","College Name"],["CITC","College of Information Technology and Computing"],["CSM","College of Science and Mathematics"]]),N=tt.book_new();tt.book_append_sheet(N,T,"Colleges Template"),It(N,"colleges_template.xlsx")};return e.jsxs("div",{className:"colleges-container",children:[e.jsxs("div",{className:"colleges-header",children:[e.jsx("h2",{className:"colleges-title",children:"Manage Colleges"}),e.jsxs("div",{className:"search-bar",children:[e.jsx("input",{type:"text",placeholder:"Search Colleges",value:i,onChange:E}),e.jsx("button",{type:"button",className:"search-button",children:e.jsx(Rt,{})})]})]}),e.jsx("div",{className:"colleges-actions",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,width:"100%"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("button",{type:"button",className:"action-button add-new",onClick:u,children:e.jsx(Ct,{})}),e.jsx("button",{type:"button",className:"action-button import",onClick:()=>ee(!0),children:e.jsx(Lt,{})})]}),e.jsx("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:8},children:e.jsx("button",{type:"button",className:"action-button delete",onClick:U,disabled:L||r.size===0,title:r.size?`Delete ${r.size} selected`:"Delete selected",children:e.jsx(bt,{})})})]})}),e.jsx("div",{className:"colleges-table-container",children:e.jsxs("table",{className:"colleges-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"College ID"}),e.jsx("th",{children:"College Name"}),e.jsx("th",{children:e.jsxs("div",{className:"actions-checkbox-wrapper",children:[e.jsx("span",{children:"Actions"}),e.jsx("input",{type:"checkbox",checked:de,onChange:$,disabled:w||o.length===0,"aria-label":"Select all",title:"Select all",style:{marginLeft:"auto"}})]})})]})}),e.jsx("tbody",{children:w?e.jsx("tr",{children:e.jsx("td",{colSpan:4,style:{textAlign:"center",padding:"20px"},children:"Loading colleges..."})}):se.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,style:{textAlign:"center",padding:"20px"},children:"No colleges found."})}):se.map((T,N)=>e.jsxs("tr",{children:[e.jsx("td",{children:N+1}),e.jsx("td",{children:T.college_id}),e.jsx("td",{children:T.college_name}),e.jsxs("td",{className:"action-buttons",style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("button",{type:"button",className:"icon-button edit-button",onClick:()=>{ie(T.college_id),ce(T.college_name),Q(!0),D(T.college_id),C(!0)},children:e.jsx(Ft,{})}),e.jsx("input",{type:"checkbox",checked:r.has(T.college_id),onChange:()=>k(T.college_id),"aria-label":`Select ${T.college_name}`,style:{marginLeft:"auto"}})]})]},T.college_id))})]})}),R&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal",children:[e.jsx("h3",{children:H?"Edit College":"Add New College"}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:"college-id",children:"College ID"}),e.jsx("input",{id:"college-id",type:"text",value:P,onChange:T=>ie(T.target.value),disabled:H})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:"college-name",children:"College Name"}),e.jsx("input",{id:"college-name",type:"text",value:ne,onChange:T=>ce(T.target.value)})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:V,disabled:te,children:te?"Saving...":"Save"}),e.jsx("button",{type:"button",onClick:()=>C(!1),children:"Cancel"})]})]})}),O&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal",children:[e.jsx("h3",{children:"Import Colleges"}),e.jsx("p",{style:{fontSize:"12px",color:"#666",marginBottom:"10px"},children:"Each college must have a unique College ID. Use the template below."}),e.jsx("input",{type:"file",accept:".xlsx, .xls",onChange:J,disabled:n}),e.jsxs("button",{type:"button",className:"modal-button download",onClick:ue,disabled:n,children:[e.jsx(Et,{style:{marginRight:5}})," Download Template"]}),e.jsx("div",{className:"modal-actions",children:e.jsx("button",{type:"button",onClick:()=>ee(!1),disabled:n,children:n?"Importing...":"Done"})})]})}),e.jsx(ft,{position:"top-right",autoClose:3e3})]})},Ha=()=>{const[o,l]=t.useState([]),[i,F]=t.useState([]),[R,C]=t.useState(""),[O,ee]=t.useState(!1),[P,ie]=t.useState(!1),[ne,ce]=t.useState(""),[H,Q]=t.useState(""),[pe,D]=t.useState(""),[te,ge]=t.useState(!1),[w,M]=t.useState(null),[n,f]=t.useState(!1),[r,b]=t.useState(!0),[L,W]=t.useState(!1),[q,E]=t.useState(new Set),[se,k]=t.useState(!1);t.useEffect(()=>{de(),$()},[]);const de=async()=>{b(!0);try{const z=await g.get("/departments/");l(z.data)}catch(z){console.error(z),a.error("Failed to fetch departments.")}finally{b(!1)}},$=async()=>{try{const z=await g.get("/tbl_college/");F(z.data)}catch(z){console.error(z),a.error("Failed to fetch colleges.")}},c=z=>{C(z.target.value)},U=o.filter(z=>{var y;const G=((y=z.college)==null?void 0:y.college_name)||"";return z.department_name.toLowerCase().includes(R.toLowerCase())||z.department_id.toLowerCase().includes(R.toLowerCase())||G.toLowerCase().includes(R.toLowerCase())}),u=z=>{E(G=>{const y=new Set(G);return y.has(z)?y.delete(z):y.add(z),y})},V=o.length>0&&o.every(z=>q.has(z.department_id)),J=()=>{E(()=>{if(V)return new Set;const z=new Set;return o.forEach(G=>z.add(G.department_id)),z})},ue=()=>E(new Set),T=async()=>{const z=Array.from(q);if(z.length===0){a.info("No departments selected");return}if(window.confirm(`Delete ${z.length} selected department(s)?`)){k(!0);try{const G=await Promise.allSettled(z.map(je=>g.delete(`/departments/${je}/`))),y=G.filter(je=>je.status==="fulfilled").length,I=G.length-y;y&&a.success(`Deleted ${y} department(s)`),I&&a.error(`${I} failed to delete`),ue(),de()}catch(G){console.error(G),a.error("Bulk delete failed")}finally{k(!1)}}},N=()=>{ce(""),Q(""),D(""),ge(!1),M(null),ee(!0)},_e=async()=>{var z;if(!ne.trim()||!H.trim()||!pe){a.error("Please fill all fields.");return}f(!0);try{te&&w?(await g.patch(`/departments/${w}/`,{department_name:H,college_id:pe}),a.success("Department updated.")):(await g.post("/departments/",{department_id:ne,department_name:H,college_id:pe}),a.success("Department added.")),de(),ee(!1)}catch(G){console.error(G),(z=G.response)!=null&&z.data?a.error(JSON.stringify(G.response.data)):a.error("Failed to save department.")}finally{f(!1)}},K=z=>{var I;const G=(I=z.target.files)==null?void 0:I[0];if(!G)return;const y=new FileReader;y.onload=async je=>{var he,p,B;W(!0);const Ce=new Uint8Array(je.target.result),m=At(Ce,{type:"array"}),me=m.SheetNames[0],j=m.Sheets[me],h=tt.sheet_to_json(j);let A=0;for(const re of h){const Z=(he=re["Department ID"])==null?void 0:he.toString().trim(),we=(p=re["Department Name"])==null?void 0:p.toString().trim(),Re=(B=re["College Name"])==null?void 0:B.toString().trim(),d=i.find(_=>_.college_name.toLowerCase()===(Re==null?void 0:Re.toLowerCase()));if(!Z||!we||!d){a.warn(`Skipped invalid row: ${we||"Unknown"}`);continue}try{await g.post("/departments/",{department_id:Z,department_name:we,college_id:d.college_id}),A++}catch{a.warn(`Skipped existing or invalid: ${we}`)}}a.success(`Import completed! ${A} department(s) added.`),de(),ie(!1),W(!1)},y.readAsArrayBuffer(G)},be=()=>{const z=tt.aoa_to_sheet([["Department ID","Department Name","College Name"],["DIT","Department of Information Technology","College of Information Technology and Computing"],["DTCM","Department of Technology Communication Management","College of Information Technology and Computing"]]),G=tt.book_new();tt.book_append_sheet(G,z,"Departments Template"),It(G,"departments_template.xlsx")};return e.jsxs("div",{className:"colleges-container",children:[e.jsxs("div",{className:"colleges-header",children:[e.jsx("h2",{className:"colleges-title",children:"Manage Departments"}),e.jsxs("div",{className:"search-bar",children:[e.jsx("input",{type:"text",placeholder:"Search for Departments",value:R,onChange:c}),e.jsx("button",{type:"button",className:"search-button",children:e.jsx(Rt,{})})]})]}),e.jsx("div",{className:"colleges-actions",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,width:"100%"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("button",{type:"button",className:"action-button add-new",onClick:N,children:e.jsx(Ct,{})}),e.jsx("button",{type:"button",className:"action-button import",onClick:()=>ie(!0),children:e.jsx(Lt,{})})]}),e.jsx("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:8},children:e.jsx("button",{type:"button",className:"action-button delete",onClick:T,disabled:se||q.size===0,title:q.size?`Delete ${q.size} selected`:"Delete selected",children:e.jsx(bt,{})})})]})}),e.jsx("div",{className:"colleges-table-container",children:e.jsxs("table",{className:"colleges-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Department ID"}),e.jsx("th",{children:"Department Name"}),e.jsx("th",{children:"College"}),e.jsx("th",{children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{children:"Actions"}),e.jsx("input",{type:"checkbox",checked:V,onChange:J,disabled:r||o.length===0,"aria-label":"Select all",title:"Select all",style:{marginLeft:"auto"}})]})})]})}),e.jsx("tbody",{children:r?e.jsx("tr",{children:e.jsx("td",{colSpan:5,style:{textAlign:"center",padding:"20px"},children:"Loading departments..."})}):U.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,style:{textAlign:"center",padding:"20px"},children:"No departments found."})}):U.map((z,G)=>{var y,I;return e.jsxs("tr",{children:[e.jsx("td",{children:G+1}),e.jsx("td",{children:z.department_id}),e.jsx("td",{children:z.department_name}),e.jsx("td",{children:((y=z.college)==null?void 0:y.college_name)||((I=z.college)==null?void 0:I.college_id)}),e.jsxs("td",{className:"action-buttons",style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("button",{type:"button",className:"icon-button edit-button",onClick:()=>{var je;ce(z.department_id),Q(z.department_name),D(((je=z.college)==null?void 0:je.college_id)||""),ge(!0),M(z.department_id),ee(!0)},children:e.jsx(Ft,{})}),e.jsx("input",{type:"checkbox",checked:q.has(z.department_id),onChange:()=>u(z.department_id),"aria-label":`Select ${z.department_name}`,style:{marginLeft:"auto"}})]})]},z.department_id)})})]})}),O&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal",children:[e.jsx("h3",{children:te?"Edit Department":"Add New Department"}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:"dept-id",children:"Department ID"}),e.jsx("input",{id:"dept-id",type:"text",value:ne,onChange:z=>ce(z.target.value),disabled:te})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:"dept-name",children:"Department Name"}),e.jsx("input",{id:"dept-name",type:"text",value:H,onChange:z=>Q(z.target.value)})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:"college-id",children:"College"}),e.jsxs("select",{id:"college-id",value:pe,onChange:z=>D(z.target.value),children:[e.jsx("option",{value:"",children:"Select College"}),i.map(z=>e.jsxs("option",{value:z.college_id,children:[z.college_name," (",z.college_id,")"]},z.college_id))]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:_e,disabled:n,children:n?"Saving...":"Save"}),e.jsx("button",{type:"button",onClick:()=>ee(!1),children:"Cancel"})]})]})}),P&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal",children:[e.jsx("h3",{children:"Import Departments"}),e.jsx("p",{style:{fontSize:"12px",color:"#666",marginBottom:"10px"},children:"Each department must belong to an existing college. Use the template below."}),e.jsx("input",{type:"file",accept:".xlsx, .xls",onChange:K,disabled:L}),e.jsxs("button",{type:"button",className:"modal-button download",onClick:be,disabled:L,children:[e.jsx(Et,{style:{marginRight:5}})," Download Template"]}),e.jsx("div",{className:"modal-actions",children:e.jsx("button",{type:"button",onClick:()=>ie(!1),disabled:L,children:L?"Importing...":"Done"})})]})}),e.jsx(ft,{position:"top-right",autoClose:3e3})]})},Wa=({user:o})=>{var y;const[l,i]=t.useState([]),[F,R]=t.useState([]),[C,O]=t.useState(""),[ee,P]=t.useState(!1),[ie,ne]=t.useState(!1),[ce,H]=t.useState(""),[Q,pe]=t.useState(""),[D,te]=t.useState(""),[ge,w]=t.useState(!1),[M,n]=t.useState(null),[f,r]=t.useState(!1),[b,L]=t.useState(!0),[W,q]=t.useState(!1),[E,se]=t.useState(new Set),[k,de]=t.useState(!1);t.useEffect(()=>{c(),$()},[]);const $=async()=>{L(!0);try{const je=(await g.get("/programs/")).data.map(Ce=>({...Ce,department_id:typeof Ce.department=="object"&&Ce.department?Ce.department.department_id:Ce.department_id}));i(je)}catch(I){console.error("Failed to fetch programs:",I.message),a.error("Failed to fetch programs.")}finally{L(!1)}},c=async()=>{try{const I=await g.get("/departments/");R(I.data)}catch(I){console.error("Failed to fetch departments:",I.message),a.error("Failed to fetch departments.")}},U=I=>{if(typeof I.department=="object"&&I.department)return I.department.department_name;if(typeof I.department=="string"){const Ce=I.department.match(/\(([^)]+)\)/);if(Ce&&Ce[1]){const m=F.find(me=>me.department_id===Ce[1]);return m?m.department_name:Ce[1]}return I.department}const je=F.find(Ce=>Ce.department_id===I.department_id);return je?je.department_name:"N/A"},u=I=>O(I.target.value),V=l.filter(I=>{const je=U(I).toLowerCase();return I.program_name.toLowerCase().includes(C.toLowerCase())||I.program_id.toLowerCase().includes(C.toLowerCase())||je.includes(C.toLowerCase())}),J=I=>{se(je=>{const Ce=new Set(je);return Ce.has(I)?Ce.delete(I):Ce.add(I),Ce})},ue=l.length>0&&l.every(I=>E.has(I.program_id)),T=()=>{se(()=>{if(ue)return new Set;const I=new Set;return l.forEach(je=>I.add(je.program_id)),I})},N=()=>se(new Set),_e=async()=>{const I=Array.from(E);if(I.length===0){a.info("No programs selected");return}if(globalThis.confirm(`Delete ${I.length} selected program(s)?`)){de(!0);try{const je=await Promise.allSettled(I.map(me=>g.delete(`/programs/${me}/`))),Ce=je.filter(me=>me.status==="fulfilled").length,m=je.length-Ce;Ce&&a.success(`Deleted ${Ce} program(s)`),m&&a.error(`${m} failed to delete`),N(),await $()}catch(je){console.error("Bulk delete failed:",je),a.error("Bulk delete failed")}finally{de(!1)}}},K=()=>{H(""),pe(""),te(""),w(!1),n(null),P(!0)},be=async()=>{if(!ce.trim()||!Q.trim()||!D){a.error("All fields are required.");return}r(!0);try{ge&&M?(await g.patch(`/programs/${M}/`,{program_name:Q,department_id:D}),a.success("Program updated.")):(await g.post("/programs/",{program_id:ce,program_name:Q,department_id:D}),a.success("Program added.")),await $(),P(!1)}catch(I){console.error("Failed to save program:",I),a.error("Failed to save program.")}finally{r(!1)}},z=I=>{var m;const je=(m=I.target.files)==null?void 0:m[0];if(!je)return;const Ce=new FileReader;Ce.onload=async me=>{var p,B,re;q(!0);const j=At(new Uint8Array(me.target.result),{type:"array"}),h=tt.sheet_to_json(j.Sheets[j.SheetNames[0]]);let A=0,he=0;for(const Z of h){const we=(p=Z["Program ID"])==null?void 0:p.trim(),Re=(B=Z["Program Name"])==null?void 0:B.trim(),d=(re=Z["Department Name"])==null?void 0:re.trim(),_=F.find(Y=>Y.department_name.trim().toLowerCase()===(d==null?void 0:d.trim().toLowerCase()));if(!we||!Re||!_){a.warn(`Skipped: Invalid data for "${Re||we||"Unnamed"}"`),he++;continue}try{await g.post("/programs/",{program_id:we,program_name:Re,department_id:_.department_id}),A++}catch{he++}}a.success(`Import completed: ${A} added, ${he} failed.`),await $(),ne(!1),q(!1)},Ce.readAsArrayBuffer(je)},G=()=>{const I=tt.aoa_to_sheet([["Program ID","Program Name","Department Name"],["BSIT","Bachelor of Science in Information Technology","Department of IT"]]),je=tt.book_new();tt.book_append_sheet(je,I,"Programs Template"),It(je,"programs_template.xlsx")};return e.jsxs("div",{className:"colleges-container",children:[e.jsxs("div",{className:"colleges-header",children:[e.jsx("h2",{className:"colleges-title",children:"Manage Programs"}),e.jsxs("div",{className:"search-bar",children:[e.jsx("input",{type:"text",placeholder:"Search for Programs",value:C,onChange:u}),e.jsx("button",{type:"button",className:"search-button",children:e.jsx(Rt,{})})]})]}),e.jsx("div",{className:"colleges-actions",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,width:"100%"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("button",{type:"button",onClick:K,className:"action-button add-new",children:e.jsx(Ct,{})}),e.jsx("button",{type:"button",onClick:()=>ne(!0),className:"action-button import",children:e.jsx(Lt,{})})]}),e.jsx("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:8},children:e.jsx("button",{type:"button",className:"action-button delete",onClick:_e,disabled:k||E.size===0,title:E.size?`Delete ${E.size} selected`:"Delete selected",children:e.jsx(bt,{})})})]})}),e.jsx("div",{className:"colleges-table-container",children:e.jsxs("table",{className:"colleges-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Code"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Department"}),e.jsx("th",{children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{children:"Actions"}),e.jsx("input",{type:"checkbox",checked:ue,onChange:T,disabled:b||l.length===0,"aria-label":"Select all",title:"Select all",style:{marginLeft:"auto"}})]})})]})}),e.jsx("tbody",{children:b?e.jsx("tr",{children:e.jsx("td",{colSpan:5,style:{textAlign:"center",padding:"20px"},children:"Loading programs..."})}):V.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,style:{textAlign:"center",padding:"20px"},children:"No programs found."})}):V.map((I,je)=>e.jsxs("tr",{children:[e.jsx("td",{children:je+1}),e.jsx("td",{children:I.program_id}),e.jsx("td",{children:I.program_name}),e.jsx("td",{children:U(I)}),e.jsxs("td",{className:"action-buttons",style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("button",{type:"button",onClick:()=>{H(I.program_id),pe(I.program_name),te(I.department_id),w(!0),n(I.program_id),P(!0)},className:"icon-button edit-button",children:e.jsx(Ft,{})}),e.jsx("input",{type:"checkbox",checked:E.has(I.program_id),onChange:()=>J(I.program_id),"aria-label":`Select ${I.program_name}`,style:{marginLeft:"auto"}})]})]},I.program_id))})]})}),ee&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal",children:[e.jsx("h3",{style:{textAlign:"center"},children:ge?"Edit Program":"Add Program"}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Program Code"}),e.jsx("input",{type:"text",value:ce,onChange:I=>H(I.target.value),disabled:ge})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Name"}),e.jsx("input",{type:"text",value:Q,onChange:I=>pe(I.target.value)})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Department"}),e.jsx(lt,{className:"custom-select",classNamePrefix:"custom",options:F.map(I=>({value:I.department_id,label:`${I.department_name} (${I.department_id})`})),value:D?{value:D,label:((y=F.find(I=>I.department_id===D))==null?void 0:y.department_name)+` (${D})`}:null,onChange:I=>te(I?I.value:""),placeholder:"Select department",isClearable:!0})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:be,disabled:f,children:f?"Saving…":"Save"}),e.jsx("button",{type:"button",onClick:()=>P(!1),children:"Cancel"})]})]})}),ie&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal",children:[e.jsx("h3",{style:{textAlign:"center"},children:"Import Programs"}),e.jsx("p",{style:{fontSize:"12px",color:"#666",marginBottom:"10px"},children:"Each program must belong to an existing department. Use the template below."}),e.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:z,disabled:W}),e.jsxs("button",{type:"button",className:"modal-button download",onClick:G,disabled:W,children:[e.jsx(Et,{style:{marginRight:5}})," Download Template"]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:()=>ne(!1),disabled:W,children:W?"Importing…":"Done"}),e.jsx("button",{type:"button",onClick:()=>ne(!1),disabled:W,children:"Cancel"})]})]})}),e.jsx(ft,{position:"top-right",autoClose:3e3})]})},Ga=()=>{const[o,l]=t.useState([]),[i,F]=t.useState([]),[R,C]=t.useState([]),[O,ee]=t.useState(""),[P,ie]=t.useState(!1),[ne,ce]=t.useState(!1),[H,Q]=t.useState({course_id:"",course_name:"",term_id:0,user_ids:[],leaders:[]}),[pe,D]=t.useState(!1),[te,ge]=t.useState(!1),[w,M]=t.useState(!0),[n,f]=t.useState(!1),[r,b]=t.useState(new Set),[L,W]=t.useState(!1);t.useEffect(()=>{let N=!0;return(async()=>{M(!0);try{const K=g.get("/courses/"),be=Promise.all([g.get("/tbl_term"),g.get("/users/")]),{data:z}=await K;N&&l(z);const[G,y]=await be;N&&(F(G.data),C(y.data))}catch{a.error("Failed to fetch some data")}finally{N&&M(!1)}})(),()=>{N=!1}},[]);const q=N=>{const _e=N.middle_name?` ${N.middle_name}`:"";return`${N.first_name}${_e} ${N.last_name}`.trim()},E=t.useCallback(async()=>{M(!0);try{const{data:N}=await g.get("/courses/");l(N)}catch{a.error("Failed to fetch courses")}finally{M(!1)}},[]),se=t.useMemo(()=>o.filter(N=>N.course_name.toLowerCase().includes(O.toLowerCase())||N.course_id.toLowerCase().includes(O.toLowerCase())),[o,O]),k=N=>{b(_e=>{const K=new Set(_e);return K.has(N)?K.delete(N):K.add(N),K})},de=o.length>0&&o.every(N=>r.has(N.course_id)),$=()=>{b(()=>{if(de)return new Set;const N=new Set;return o.forEach(_e=>N.add(_e.course_id)),N})},c=()=>b(new Set),U=async()=>{const N=Array.from(r);if(N.length===0){a.info("No courses selected");return}if(globalThis.confirm(`Delete ${N.length} selected course(s)?`)){W(!0);try{const _e=await Promise.allSettled(N.map(z=>g.delete(`/courses/${z}/`))),K=_e.filter(z=>z.status==="fulfilled").length,be=_e.length-K;K&&a.success(`Deleted ${K} course(s)`),be&&a.error(`${be} failed to delete`),c(),await E()}catch{a.error("Bulk delete failed")}finally{W(!1)}}},u=t.useCallback(async()=>{const{course_id:N,course_name:_e,term_id:K,user_ids:be,leaders:z}=H;if(!N||!_e||!K||be.length===0){a.error("All fields are required.");return}ge(!0);try{pe?(await g.put(`/courses/${N}/`,{course_id:N,course_name:_e,term_id:K,user_ids:be,leaders:z}),a.success("successfully updated")):(await g.post("/courses/",{course_id:N,course_name:_e,term_id:K,user_ids:be,leaders:z}),a.success("Course added successfully")),await E(),ie(!1)}catch{a.error("Failed to save course")}finally{ge(!1)}},[H,pe,E]),V=N=>{Q({course_id:N.course_id,course_name:N.course_name,term_id:Number(N.term_id)||0,user_ids:Array.isArray(N.user_ids)?N.user_ids:[],leaders:Array.isArray(N.leaders)?N.leaders:[]}),D(!0),ie(!0)},J=N=>String(N).replace(/\u00A0/g," ").replace(/\t/g," ").trim().toLowerCase(),ue=N=>{var be;const _e=(be=N.target.files)==null?void 0:be[0];if(!_e){a.error("No file selected.");return}const K=new FileReader;K.onload=async z=>{var G,y,I;f(!0);try{const je=(G=z.target)==null?void 0:G.result,Ce=At(je,{type:"binary"}),m=Ce.Sheets[Ce.SheetNames[0]],me=tt.sheet_to_json(m);if(!me.length){a.error("The Excel file is empty."),f(!1);return}let j=0,h=0;for(const A of me){const p=String(A["Course ID"]||"").trim().replace(/\u00A0/g," ").replace(/\t/g," ").trim(),B=(y=A["Course Name"])==null?void 0:y.trim(),re=J(A["Term Name"]),Z=(I=A["Instructor Full Names"])==null?void 0:I.trim();if(!p||!B||!re){a.error(`Row skipped (${A["Course ID"]}): Missing required fields.`),h++;continue}const we=i.find(d=>J(d.term_name)===re);if(!we){a.error(`Row skipped (${A["Course ID"]}): Term not found.`),h++;continue}let Re=[];if(Z&&Z.trim()!==""){const d=Z.split(",").map(_=>J(_));Re=R.filter(_=>d.includes(J(q(_)))).map(_=>_.user_id),Re.length===0&&a.warn(`No matching instructors for ${A["Course ID"]}. Importing with none.`)}else Re=[];try{await g.post("/courses/",{course_id:p,course_name:B,term_id:we.term_id,user_ids:Re,leaders:[]}),j++}catch{h++,a.error(`API error importing ${A["Course ID"]}.`)}}a.success(`Import complete: ${j} added, ${h} errors.`),await E(),ce(!1)}catch{a.error("Error reading file.")}finally{f(!1)}},K.readAsBinaryString(_e)},T=t.useCallback(()=>{const N=tt.aoa_to_sheet([["Course ID","Course Name","Term Name","Instructor Full Names"],["IT112","Computer Programming 1","1st Semester","Juan Dela Cruz, Maria Santos"]]),_e=tt.book_new();tt.book_append_sheet(_e,N,"Template"),It(_e,"courses_template.xlsx")},[]);return e.jsxs("div",{className:"colleges-container",children:[e.jsxs("div",{className:"colleges-header",children:[e.jsx("h2",{className:"colleges-title",children:"Manage Courses"}),e.jsxs("div",{className:"search-bar",children:[e.jsx("input",{type:"text",placeholder:"Search",value:O,onChange:N=>ee(N.target.value)}),e.jsx("button",{type:"button",className:"search-button",children:e.jsx(Rt,{})})]})]}),e.jsx("div",{className:"colleges-actions",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,width:"100%"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("button",{type:"button",className:"action-button add-new",onClick:()=>{Q({course_id:"",course_name:"",term_id:0,user_ids:[],leaders:[]}),D(!1),ie(!0)},children:e.jsx(Ct,{})}),e.jsx("button",{type:"button",className:"action-button import",onClick:()=>ce(!0),children:e.jsx(Lt,{})})]}),e.jsx("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:8},children:e.jsx("button",{type:"button",className:"action-button delete",onClick:U,disabled:L||r.size===0,title:r.size>0?`Delete ${r.size} selected`:"Delete selected",children:e.jsx(bt,{})})})]})}),e.jsx("div",{className:"colleges-table-container",children:e.jsxs("table",{className:"colleges-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Course Code"}),e.jsx("th",{children:"Course Name"}),e.jsx("th",{children:"Term"}),e.jsx("th",{children:"Instructors"}),e.jsx("th",{children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{children:"Actions"}),e.jsx("input",{type:"checkbox",checked:de,onChange:$,disabled:w||o.length===0,"aria-label":"Select all",title:"Select all",style:{marginLeft:"auto"}})]})})]})}),e.jsx("tbody",{children:w?e.jsx("tr",{children:e.jsx("td",{colSpan:6,style:{textAlign:"center",padding:"20px"},children:"Loading courses..."})}):se.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,style:{textAlign:"center",padding:"20px"},children:"No courses found."})}):se.map((N,_e)=>{var K;return e.jsxs("tr",{children:[e.jsx("td",{children:_e+1}),e.jsx("td",{children:N.course_id}),e.jsx("td",{children:N.course_name}),e.jsx("td",{children:N.term_name}),e.jsx("td",{children:(K=N.user_ids)==null?void 0:K.map(be=>{const z=R.find(G=>G.user_id===be);return z?q(z):""}).join(", ")}),e.jsxs("td",{className:"action-buttons",style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("button",{type:"button",className:"icon-button edit-button",onClick:()=>V(N),children:e.jsx(Ft,{})}),e.jsx("input",{type:"checkbox",checked:r.has(N.course_id),onChange:()=>k(N.course_id),"aria-label":`Select ${N.course_id}`,style:{marginLeft:"auto"}})]})]},N.course_id)})})]})}),P&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal",children:[e.jsx("h3",{style:{textAlign:"center"},children:pe?"Edit Course":"Add Course"}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Course Code"}),e.jsx("input",{type:"text",value:H.course_id,disabled:pe,onChange:N=>Q({...H,course_id:N.target.value})})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Course Name"}),e.jsx("input",{type:"text",value:H.course_name,onChange:N=>Q({...H,course_name:N.target.value})})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Term"}),e.jsxs("select",{value:String(H.term_id||""),onChange:N=>Q({...H,term_id:Number(N.target.value)}),children:[e.jsx("option",{value:"",children:"Select Term"}),i.map(N=>e.jsxs("option",{value:N.term_id,children:[N.term_name," (",N.academic_year,")"]},N.term_id))]})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Instructors"}),e.jsx(lt,{isMulti:!0,options:R.map(N=>({value:N.user_id,label:q(N)})),value:R.filter(N=>H.user_ids.includes(N.user_id)).map(N=>({value:N.user_id,label:q(N)})),onChange:N=>{const _e=N.map(K=>K.value);Q({...H,user_ids:_e,leaders:H.leaders.filter(K=>_e.includes(K))})}})]}),H.user_ids.length>0&&e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Bayanihan Leaders"}),e.jsx(lt,{isMulti:!0,options:R.filter(N=>H.user_ids.includes(N.user_id)).map(N=>({value:N.user_id,label:q(N)})),value:R.filter(N=>H.leaders.includes(N.user_id)).map(N=>({value:N.user_id,label:q(N)})),onChange:N=>Q({...H,leaders:N.map(_e=>_e.value)})})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:u,disabled:te,children:te?"Saving...":"Save"}),e.jsx("button",{type:"button",onClick:()=>ie(!1),children:"Cancel"})]})]})}),ne&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal",children:[e.jsx("h3",{style:{textAlign:"center"},children:"Import Courses"}),e.jsx("p",{style:{fontSize:"12px",color:"#666",marginBottom:"10px"},children:"Each course must belong to an existing term and have at least one instructor."}),e.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:ue,disabled:n}),e.jsxs("button",{type:"button",className:"modal-button download",onClick:T,disabled:n,children:[e.jsx(Et,{style:{marginRight:5}})," Download Template"]}),e.jsx("div",{className:"modal-actions",children:e.jsx("button",{type:"button",onClick:()=>ce(!1),disabled:n,children:n?"Importing…":"Close"})})]})}),e.jsx(ft,{position:"top-right",autoClose:3e3})]})},Va=()=>{var me,j;const[o,l]=t.useState([]),[i,F]=t.useState([]),[R,C]=t.useState([]),[O,ee]=t.useState([]),[P,ie]=t.useState({}),[ne,ce]=t.useState(""),[H,Q]=t.useState(!1),[pe,D]=t.useState(!1),[te,ge]=t.useState(!1),[w,M]=t.useState(!1),[n,f]=t.useState(!0),[r,b]=t.useState(1),[L,W]=t.useState(!1),q=20,[E,se]=t.useState(new Set),[k,de]=t.useState(!1),[$,c]=t.useState({course_id:"",program_id:"",term_id:0,section_name:"",number_of_students:0,year_level:"",is_night_class:""}),U=t.useMemo(()=>[...i].sort((h,A)=>h.course_id.localeCompare(A.course_id)),[i]),u=t.useMemo(()=>[...R].sort((h,A)=>h.program_name.localeCompare(A.program_name)),[R]),V=t.useMemo(()=>U.map(h=>({value:h.course_id,label:`${h.course_id} (${h.course_name})`})),[U]),J=t.useMemo(()=>u.map(h=>({value:h.program_id,label:`${h.program_id} (${h.program_name})`})),[u]),ue=t.useMemo(()=>(P[$.course_id]||[]).sort((A,he)=>A.full_name.localeCompare(he.full_name)).map(A=>({value:A.user_id,label:A.full_name})),[P,$.course_id]),T=t.useCallback(async()=>{var h;f(!0);try{const[A,he,p,B,re]=await Promise.all([g.get("/tbl_sectioncourse/"),g.get("/courses/"),g.get("/programs/"),g.get("/tbl_term"),g.get("/tbl_course_users/")]),Z=((h=A.data)==null?void 0:h.data)||A.data||[],we=he.data||[],Re=p.data||[],d=B.data||[],_=re.data||[];l(Z),F(we),C(Re);const Y=d.map(Ee=>({...Ee,tbl_examperiod:{academic_year:Array.isArray(Ee.tbl_examperiod)&&Ee.tbl_examperiod.length>0?Ee.tbl_examperiod[0].academic_year:"N/A"}}));ee(Y);const ye={};_.forEach(Ee=>{var et;if(!Ee.tbl_users)return;const Ne={user_id:Ee.tbl_users.user_id,full_name:Ee.tbl_users.full_name||`${Ee.tbl_users.first_name} ${Ee.tbl_users.last_name}`},Ue=((et=Ee.course)==null?void 0:et.course_id)||Ee.course_id;Ue&&(ye[Ue]||(ye[Ue]=[]),ye[Ue].push(Ne))}),ie(ye)}catch{a.error("Error fetching data.")}finally{f(!1)}},[]);t.useEffect(()=>{T()},[T]),t.useEffect(()=>{b(1)},[ne]);const N=async()=>{const{course_id:h,program_id:A,section_name:he,number_of_students:p,year_level:B,term_id:re,user_id:Z}=$;if(!h||!A||!he||!p||!B||!re||!Z){a.error("All fields including instructor are required");return}const we={course_id:h,program_id:A,term_id:re,user_id:Z,section_name:he,number_of_students:p,year_level:B,is_night_class:$.is_night_class==="YES"?"YES":""};M(!0);try{if(te){const{status:Re}=await g.put(`/tbl_sectioncourse/${$.id}/`,we);Re===200?a.success("Section updated"):a.error("Failed to update section")}else{const{status:Re}=await g.post("/tbl_sectioncourse/",we);Re===201?a.success("Section added"):a.error("Failed to add section")}}catch{a.error("Request failed.")}finally{Q(!1),M(!1),T()}},_e=h=>{var p;const A=(p=h.target.files)==null?void 0:p[0];if(!A)return;const he=new FileReader;he.onload=async B=>{var re;W(!0);try{const Z=new Uint8Array((re=B.target)==null?void 0:re.result),we=At(Z,{type:"array"}),Re=we.Sheets[we.SheetNames[0]],d=tt.sheet_to_json(Re),_=[],Y=[];for(let Ne=0;Ne<d.length;Ne++){const Ue=d[Ne],et=Ne+2,Ge=String(Ue["Section Name"]||"").trim(),s=parseInt(String(Ue["Number of Students"]||"0")),x=String(Ue["Year Level"]||"").trim(),v=String(Ue["Night Class"]||"").trim().toUpperCase()==="YES"?"YES":"",X=String(Ue["Term Name"]||"").trim(),Se=String(Ue["Course ID"]||"").trim(),Te=String(Ue["Program ID"]||"").trim(),qe=String(Ue["Instructor Name"]||"").trim();if(!Ge){Y.push(`Row ${et}: Missing Section Name`);continue}if(!s){Y.push(`Row ${et}: Missing or invalid Number of Students`);continue}if(!x){Y.push(`Row ${et}: Missing Year Level`);continue}if(!X){Y.push(`Row ${et}: Missing Term Name`);continue}if(!Se){Y.push(`Row ${et}: Missing Course ID`);continue}if(!Te){Y.push(`Row ${et}: Missing Program ID`);continue}if(!i.find(Me=>Me.course_id===Se)){Y.push(`Row ${et}: Course ID "${Se}" not found`);continue}if(!R.find(Me=>Me.program_id===Te)){Y.push(`Row ${et}: Program ID "${Te}" not found`);continue}const ke=O.find(Me=>Me.term_name===X);if(!ke){Y.push(`Row ${et}: Term "${X}" not found`);continue}if(!qe){_.push({course_id:Se,program_id:Te,section_name:Ge,number_of_students:s,year_level:x,term_id:ke.term_id,user_id:void 0,is_night_class:v});continue}const fe=P[Se]||[],Pe=qe.split(",").map(Me=>Me.trim()).filter(Me=>Me);if(Pe.length===0){_.push({course_id:Se,program_id:Te,section_name:Ge,number_of_students:s,year_level:x,term_id:ke.term_id,user_id:void 0,is_night_class:v});continue}let Ve=!1;for(const Me of Pe){const De=fe.find(He=>He.full_name.toLowerCase()===Me.toLowerCase());if(!De){if(fe.length>0){const He=fe.map(at=>at.full_name).join(", ");Y.push(`Row ${et}: Instructor "${Me}" not found for course "${Se}". Available: ${He}`)}else Y.push(`Row ${et}: Instructor "${Me}" not found - no instructors assigned to course "${Se}"`);continue}Ve=!0,_.push({course_id:Se,program_id:Te,section_name:Ge,number_of_students:s,year_level:x,term_id:ke.term_id,user_id:De.user_id,is_night_class:v})}!Ve&&Pe.length>0&&Y.push(`Row ${et}: None of the specified instructors were found for course "${Se}"`)}if(Y.length>0&&(console.error("Import errors:",Y),a.error(`${Y.length} issue(s) found. Check console for details.`)),_.length===0){a.warning("No valid rows to import"),D(!1),W(!1);return}let ye=0;const Ee=10;for(let Ne=0;Ne<_.length;Ne+=Ee){const Ue=_.slice(Ne,Ne+Ee),et=await Promise.allSettled(Ue.map(Ge=>g.post("/tbl_sectioncourse/",Ge)));ye+=et.filter(Ge=>Ge.status==="fulfilled"&&(Ge.value.status===200||Ge.value.status===201)).length}a.success(`Import completed: ${ye} section(s) added`),T()}catch(Z){console.error("Import error:",Z),a.error("Error reading or importing file")}finally{D(!1),W(!1)}},he.readAsArrayBuffer(A)},K=()=>{const h=tt.aoa_to_sheet([["Course ID","Program ID","Section Name","Number of Students","Year Level","Term Name","Instructor Name","Night Class"],["IT 112","BSIT","IT 1R1","30","1st Year","1st Semester","Ithran Beor Turno","YES"]]),A=tt.book_new();tt.book_append_sheet(A,h,"SectionCourses Template"),It(A,"sectioncourses_template.xlsx")},be=t.useMemo(()=>{if(!ne)return o;const h=ne.toLowerCase();return o.filter(A=>{var Z,we,Re,d;const he=((Z=A.term)==null?void 0:Z.term_name)||"",p=((we=A.course)==null?void 0:we.course_name)||"",B=((Re=A.program)==null?void 0:Re.program_name)||"",re=((d=A.user)==null?void 0:d.full_name)||"";return A.section_name.toLowerCase().includes(h)||p.toLowerCase().includes(h)||B.toLowerCase().includes(h)||re.toLowerCase().includes(h)||he.toLowerCase().includes(h)})},[ne,o]),z=t.useMemo(()=>[...be].sort((A,he)=>A.section_name.localeCompare(he.section_name)).slice((r-1)*q,r*q),[be,r,q]),G=Math.ceil(be.length/q),y=h=>{if(h===void 0)return;const A=String(h);se(he=>{const p=new Set(he);return p.has(A)?p.delete(A):p.add(A),p})},I=o.length>0&&o.every(h=>E.has(String(h.id||""))),je=()=>{se(()=>{if(I)return new Set;const h=new Set;return o.forEach(A=>{A.id!==void 0&&h.add(String(A.id))}),h})},Ce=()=>se(new Set),m=async()=>{const h=Array.from(E);if(h.length===0){a.info("No sections selected");return}if(globalThis.confirm(`Delete ${h.length} selected section course(s)?`)){de(!0);try{const A=await Promise.allSettled(h.map(B=>g.delete(`/tbl_sectioncourse/${B}/`))),he=A.filter(B=>B.status==="fulfilled").length,p=A.length-he;he&&a.success(`Deleted ${he} section(s)`),p&&a.error(`${p} failed to delete`),Ce(),await T(),b(1)}catch{a.error("Bulk delete failed")}finally{de(!1)}}};return e.jsxs("div",{className:"colleges-container",children:[e.jsxs("div",{className:"colleges-header",children:[e.jsx("h2",{className:"colleges-title",children:"Section Courses"}),e.jsxs("div",{className:"search-bar",children:[e.jsx("input",{type:"text",placeholder:"Search Section Name",value:ne,onChange:h=>ce(h.target.value)}),e.jsx("button",{type:"button",className:"search-button",children:e.jsx(Rt,{})})]})]}),e.jsx("div",{className:"colleges-actions",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,width:"100%"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("button",{type:"button",className:"action-button add-new",onClick:()=>{ge(!1),c({course_id:"",program_id:"",section_name:"",number_of_students:0,year_level:"",term_id:0}),Q(!0)},children:e.jsx(Ct,{})}),e.jsx("button",{type:"button",className:"action-button import",onClick:()=>D(!0),children:e.jsx(Lt,{})})]}),e.jsx("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:8},children:e.jsx("button",{type:"button",className:"action-button delete",onClick:m,disabled:k||E.size===0,title:E.size?`Delete ${E.size} selected`:"Delete selected",children:e.jsx(bt,{})})})]})}),e.jsxs("div",{className:"pagination-controls",children:[e.jsx("button",{type:"button",onClick:()=>b(h=>Math.max(h-1,1)),disabled:r===1,children:"←"}),e.jsxs("span",{children:["Page ",r," of ",G]}),e.jsx("button",{type:"button",onClick:()=>b(h=>Math.min(h+1,G)),disabled:r===G,children:"→"})]}),e.jsx("div",{className:"colleges-table-container",children:e.jsxs("table",{className:"colleges-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Course"}),e.jsx("th",{children:"Program"}),e.jsx("th",{children:"Section"}),e.jsx("th",{children:"Students"}),e.jsx("th",{children:"Year"}),e.jsx("th",{children:"Term"}),e.jsx("th",{children:"Instructor"}),e.jsx("th",{children:"Night Class"}),e.jsx("th",{children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{children:"Actions"}),e.jsx("input",{type:"checkbox",checked:I,onChange:je,disabled:n||o.length===0,"aria-label":"Select all",title:"Select all",style:{marginLeft:"auto"}})]})})]})}),e.jsx("tbody",{children:n?e.jsx("tr",{children:e.jsx("td",{colSpan:10,style:{textAlign:"center",padding:"20px"},children:"Loading sections with courses..."})}):z.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,style:{textAlign:"center",padding:"20px"},children:"No sections with courses."})}):z.map((h,A)=>{var he,p,B,re;return e.jsxs("tr",{children:[e.jsx("td",{children:(r-1)*q+A+1}),e.jsx("td",{children:((he=h.course)==null?void 0:he.course_name)||h.course_id}),e.jsx("td",{children:((p=h.program)==null?void 0:p.program_name)||h.program_id}),e.jsx("td",{children:h.section_name}),e.jsx("td",{children:h.number_of_students}),e.jsx("td",{children:h.year_level}),e.jsx("td",{children:((B=h.term)==null?void 0:B.term_name)||"N/A"}),e.jsx("td",{children:((re=h.user)==null?void 0:re.full_name)||"N/A"}),e.jsx("td",{children:h.is_night_class==="YES"?"YES":""}),e.jsxs("td",{className:"action-buttons",children:[e.jsx("button",{type:"button",className:"icon-button edit-button",onClick:()=>{var Z,we,Re,d;ge(!0),c({...h,course_id:((Z=h.course)==null?void 0:Z.course_id)||h.course_id,program_id:((we=h.program)==null?void 0:we.program_id)||h.program_id,term_id:((Re=h.term)==null?void 0:Re.term_id)||h.term_id,user_id:((d=h.user)==null?void 0:d.user_id)||h.user_id,is_night_class:h.is_night_class==="YES"?"YES":""}),Q(!0)},children:e.jsx(Ft,{})}),e.jsx("input",{type:"checkbox",checked:E.has(String(h.id)),onChange:()=>y(h.id),"aria-label":`Select ${h.section_name}`,style:{marginLeft:"auto"}})]})]},h.id||A)})})]})}),H&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal",children:[e.jsx("h3",{style:{textAlign:"center"},children:te?"Edit Section":"Add New Section"}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Course"}),te?e.jsxs("div",{className:"text-value",children:[$.course_id," (",((me=i.find(h=>h.course_id===$.course_id))==null?void 0:me.course_name)||"N/A",")"]}):e.jsx(lt,{className:"custom-select",classNamePrefix:"custom",options:V,value:V.find(h=>h.value===$.course_id)||null,onChange:h=>c({...$,course_id:(h==null?void 0:h.value)||"",user_id:void 0}),placeholder:"Select Course"})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Program"}),te?e.jsxs("div",{className:"text-value",children:[$.program_id," (",((j=R.find(h=>h.program_id===$.program_id))==null?void 0:j.program_name)||"N/A",")"]}):e.jsx(lt,{className:"custom-select",classNamePrefix:"custom",options:J,value:J.find(h=>h.value===$.program_id)||null,onChange:h=>c({...$,program_id:(h==null?void 0:h.value)||""}),placeholder:"Select Program"})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Section Name"}),e.jsx("input",{type:"text",value:$.section_name,onChange:h=>c({...$,section_name:h.target.value}),placeholder:"Enter section name"})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Number of Students"}),e.jsx("input",{type:"number",value:$.number_of_students||"",onChange:h=>c({...$,number_of_students:parseInt(h.target.value)||0}),placeholder:"e.g., 40"})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Year Level"}),e.jsxs("select",{value:$.year_level,onChange:h=>c({...$,year_level:h.target.value}),children:[e.jsx("option",{value:"",children:"Select Year"}),e.jsx("option",{value:"1st Year",children:"1st Year"}),e.jsx("option",{value:"2nd Year",children:"2nd Year"}),e.jsx("option",{value:"3rd Year",children:"3rd Year"}),e.jsx("option",{value:"4th Year",children:"4th Year"}),e.jsx("option",{value:"5th Year",children:"5th Year"})]})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Term"}),e.jsxs("select",{value:$.term_id||"",onChange:h=>c({...$,term_id:parseInt(h.target.value)||0}),children:[e.jsx("option",{value:"",children:"Select Term"}),O.map(h=>e.jsx("option",{value:h.term_id,children:h.term_name},h.term_id))]})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Instructor"}),e.jsx(lt,{className:"custom-select",classNamePrefix:"custom",options:ue,value:ue.find(h=>h.value===$.user_id)||null,onChange:h=>c({...$,user_id:h==null?void 0:h.value}),placeholder:"Select Instructor",menuPlacement:"top"})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Night Class?"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("input",{type:"checkbox",checked:$.is_night_class==="YES",onChange:h=>c({...$,is_night_class:h.target.checked?"YES":""})}),e.jsx("span",{style:{color:"black"},children:"YES"})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:N,disabled:w,children:w?"Saving...":"Save"}),e.jsx("button",{type:"button",onClick:()=>Q(!1),disabled:w,children:"Cancel"})]})]})}),pe&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal",children:[e.jsx("h3",{style:{textAlign:"center"},children:"Import Section Courses"}),e.jsx("p",{style:{fontSize:"12px",color:"#666",marginBottom:"10px"},children:"Each section must belong to an existing course, program, term, and have an assigned instructor."}),e.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:_e,disabled:L}),e.jsxs("button",{type:"button",className:"modal-button download",onClick:K,disabled:L,children:[e.jsx(Et,{style:{marginRight:5}})," Download Template"]}),e.jsx("div",{className:"modal-actions",children:e.jsx("button",{type:"button",onClick:()=>D(!1),disabled:L,children:L?"Importing…":"Close"})})]})}),e.jsx(ft,{position:"top-right",autoClose:3e3})]})},Ja=()=>{const[o,l]=t.useState([]),[i,F]=t.useState(""),[R,C]=t.useState(!1),[O,ee]=t.useState(!1),[P,ie]=t.useState(""),[ne,ce]=t.useState(!1),[H,Q]=t.useState(null),[pe,D]=t.useState(!1),[te,ge]=t.useState(!0),[w,M]=t.useState(!1),[n,f]=t.useState(new Set),[r,b]=t.useState(!1);t.useEffect(()=>{L()},[]);const L=async()=>{ge(!0);try{const u=await g.get("/tbl_term");l(u.data)}catch(u){console.error("Fetch terms error:",u),a.error("Failed to fetch terms")}finally{ge(!1)}},W=o.filter(u=>u.term_name.toLowerCase().includes(i.toLowerCase())),q=async()=>{if(!P.trim()){a.error("Term name is required");return}D(!0);try{if(ne&&H!==null)await g.put(`/tbl_term/${H}/`,{term_name:P.trim()}),a.success("Term updated successfully");else{if(o.find(V=>V.term_name.trim().toLowerCase()===P.trim().toLowerCase())){a.warning("This term already exists."),D(!1);return}await g.post("/tbl_term",{term_name:P.trim()}),a.success("Term added successfully")}await L(),C(!1)}catch(u){console.error("Submit term error:",u),a.error("Failed to save term")}finally{D(!1)}},E=u=>{f(V=>{const J=new Set(V);return J.has(u)?J.delete(u):J.add(u),J})},se=o.length>0&&o.every(u=>n.has(u.term_id)),k=()=>{f(()=>{if(se)return new Set;const u=new Set;return o.forEach(V=>u.add(V.term_id)),u})},de=()=>f(new Set),$=async()=>{const u=Array.from(n);if(u.length===0){a.info("No terms selected");return}if(globalThis.confirm(`Delete ${u.length} selected term(s)?`)){b(!0);try{const V=await Promise.allSettled(u.map(T=>g.delete(`/tbl_term/${T}/`))),J=V.filter(T=>T.status==="fulfilled").length,ue=V.length-J;J&&a.success(`Deleted ${J} term(s)`),ue&&a.error(`${ue} failed to delete`),de(),await L()}catch{a.error("Bulk delete failed")}finally{b(!1)}}},c=u=>{var ue;const V=(ue=u.target.files)==null?void 0:ue[0];if(!V)return;const J=new FileReader;J.onload=async T=>{var N;M(!0);try{const _e=new Uint8Array(T.target.result),K=At(_e,{type:"array"}),be=K.Sheets[K.SheetNames[0]],z=tt.sheet_to_json(be);let G=0,y=0,I=0;const je=o.map(Ce=>Ce.term_name.trim().toLowerCase());for(const Ce of z){const m=(N=Ce["Term Name"])==null?void 0:N.trim();if(!m){y++;continue}if(je.includes(m.toLowerCase())){I++;continue}try{await g.post("/tbl_term",{term_name:m}),G++}catch{y++}}a.success(`Import completed: ${G} added, ${I} skipped (duplicates), ${y} failed.`),L(),ee(!1)}catch{a.error("Error reading or importing file")}finally{M(!1)}},J.readAsArrayBuffer(V)},U=()=>{const u=tt.aoa_to_sheet([["Term Name"],["1st Semester"],["2nd Semester"]]),V=tt.book_new();tt.book_append_sheet(V,u,"Terms Template"),It(V,"terms_template.xlsx")};return e.jsxs("div",{className:"colleges-container",children:[e.jsxs("div",{className:"colleges-header",children:[e.jsx("h2",{className:"colleges-title",children:"Manage Terms"}),e.jsxs("div",{className:"search-bar",children:[e.jsx("input",{type:"text",placeholder:"Search for Term",value:i,onChange:u=>F(u.target.value)}),e.jsx("button",{type:"button",className:"search-button",children:e.jsx(Rt,{})})]})]}),e.jsx("div",{className:"colleges-actions",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,width:"100%"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("button",{type:"button",className:"action-button add-new",onClick:()=>{ie(""),ce(!1),Q(null),C(!0)},children:e.jsx(Ct,{})}),e.jsx("button",{type:"button",className:"action-button import",onClick:()=>ee(!0),children:e.jsx(Lt,{})})]}),e.jsx("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:8},children:e.jsx("button",{type:"button",className:"action-button delete",onClick:$,disabled:r||n.size===0,title:n.size?`Delete ${n.size} selected`:"Delete selected",children:e.jsx(bt,{})})})]})}),e.jsx("div",{className:"colleges-table-container",children:e.jsxs("table",{className:"colleges-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Term Name"}),e.jsx("th",{children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{children:"Actions"}),e.jsx("input",{type:"checkbox",checked:se,onChange:k,disabled:te||o.length===0,"aria-label":"Select all",title:"Select all",style:{marginLeft:"auto"}})]})})]})}),e.jsx("tbody",{children:te?e.jsx("tr",{children:e.jsx("td",{colSpan:3,style:{textAlign:"center",padding:"20px"},children:"Loading colleges..."})}):W.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:3,style:{textAlign:"center",padding:"20px"},children:"No colleges found."})}):W.map((u,V)=>e.jsxs("tr",{children:[e.jsx("td",{children:V+1}),e.jsx("td",{children:u.term_name}),e.jsxs("td",{className:"action-buttons",style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("button",{type:"button",className:"icon-button edit-button",onClick:()=>{ce(!0),Q(u.term_id),ie(u.term_name),C(!0)},children:e.jsx(Ft,{})}),e.jsx("input",{type:"checkbox",checked:n.has(u.term_id),onChange:()=>E(u.term_id),"aria-label":`Select ${u.term_name}`,style:{marginLeft:"auto"}})]})]},u.term_id))})]})}),R&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal",children:[e.jsx("h3",{style:{textAlign:"center"},children:ne?"Edit Term":"Add New Term"}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:"term-name",children:"Term Name"}),e.jsx("input",{id:"term-name",type:"text",placeholder:"Term Name",value:P,onChange:u=>ie(u.target.value)})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:q,disabled:pe,children:pe?"Saving...":"Save"}),e.jsx("button",{type:"button",onClick:()=>C(!1),children:"Cancel"})]})]})}),O&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal",children:[e.jsx("h3",{style:{textAlign:"center"},children:"Import Terms"}),e.jsx("p",{style:{fontSize:"12px",color:"#666",marginBottom:"10px"},children:"Each term must have a valid name. Duplicates will be skipped."}),e.jsx("input",{type:"file",accept:".xlsx, .xls",onChange:c,disabled:w}),e.jsxs("button",{type:"button",className:"modal-button download",onClick:U,disabled:w,children:[e.jsx(Et,{style:{marginRight:5}})," Download Template"]}),e.jsx("div",{className:"modal-actions",children:e.jsx("button",{type:"button",onClick:()=>ee(!1),disabled:w,children:w?"Importing…":"Close"})})]})}),e.jsx(ft,{position:"top-right",autoClose:3e3})]})},Ka=()=>{const[o,l]=t.useState([]),[i,F]=t.useState({}),[R,C]=t.useState([]),[O,ee]=t.useState([]),[P,ie]=t.useState(""),[ne,ce]=t.useState(!1),[H,Q]=t.useState(!1),[pe,D]=t.useState(!1),[te,ge]=t.useState(!1),[w,M]=t.useState(!0),[n,f]=t.useState(!1),[r,b]=t.useState(!1),[L,W]=t.useState({building_id:"",building_name:""}),[q,E]=t.useState(""),[se,k]=t.useState(new Set);t.useEffect(()=>{if(ne||H)return;de();const K=setInterval(de,2e3);return()=>clearInterval(K)},[ne,H]);const de=async()=>{try{const{data:K}=await g.get("/tbl_buildings"),{data:be}=await g.get("/tbl_rooms");l(K||[]),C(be||[]);const z={};(be||[]).forEach(G=>{G.building_id&&(z[G.building_id]=(z[G.building_id]||0)+1)}),F(z)}catch(K){console.error(K),a.error("Failed to fetch data")}finally{w&&M(!1)}},$=K=>{k(be=>{const z=new Set(be);return z.has(K)?z.delete(K):z.add(K),z})},c=o.length===0?!1:o.every(K=>se.has(K.building_id)),U=()=>{k(()=>{if(c)return new Set;const K=new Set;return o.forEach(be=>K.add(be.building_id)),K})},u=()=>k(new Set),V=K=>{const be=o.find(G=>G.building_id===K),z=R.filter(G=>G.building_id===K);ee(z),E(be?be.building_name:"Unknown Building"),D(!0)},J=async()=>{const{building_id:K,building_name:be}=L;if(!K||!be){a.error("All fields are required");return}try{te?(await g.put(`/tbl_buildings/${K}`,{building_name:be}),a.success("Building updated")):(await g.post("/tbl_buildings",L),a.success("Building added")),ce(!1),W({building_id:"",building_name:""}),de()}catch(z){console.error(z),a.error("Failed to save building")}},ue=K=>{var G;const be=(G=K.target.files)==null?void 0:G[0];if(!be)return;const z=new FileReader;z.onload=async y=>{var I,je;f(!0);try{const Ce=new Uint8Array(y.target.result),m=At(Ce,{type:"array"}),me=m.Sheets[m.SheetNames[0]],j=tt.sheet_to_json(me);let h=0;for(const A of j){const he=(I=A["Building ID"])==null?void 0:I.trim(),p=(je=A["Building Name"])==null?void 0:je.trim();if(!(!he||!p))try{await g.post("/tbl_buildings",{building_id:he,building_name:p}),h++}catch{}}a.success(`Import completed: ${h} building(s) added`),de()}catch{a.error("Error reading or importing file")}finally{f(!1),Q(!1)}},z.readAsArrayBuffer(be)},T=()=>{const K=tt.aoa_to_sheet([["Building ID","Building Name"],["BLDG. 09","ICT Building"]]),be=tt.book_new();tt.book_append_sheet(be,K,"Buildings Template"),It(be,"buildings_template.xlsx")},N=o.filter(K=>K.building_name.toLowerCase().includes(P.toLowerCase())),_e=async()=>{const K=Array.from(se);if(K.length===0){a.info("No buildings selected");return}if(window.confirm(`Delete ${K.length} selected building(s)? This cannot be undone.`)){b(!0);try{const z=await Promise.allSettled(K.map(I=>g.delete(`/tbl_buildings/${I}`))),G=z.filter(I=>I.status==="fulfilled").length,y=z.length-G;G>0&&a.success(`Deleted ${G} building(s)`),y>0&&a.error(`${y} building(s) failed to delete`),u(),de()}catch(z){console.error(z),a.error("Bulk delete failed")}finally{b(!1)}}};return e.jsxs("div",{className:"colleges-container",children:[e.jsxs("div",{className:"colleges-header",children:[e.jsx("h2",{className:"colleges-title",children:"Manage Buildings"}),e.jsxs("div",{className:"search-bar",children:[e.jsx("input",{type:"text",placeholder:"Search Building Name",value:P,onChange:K=>ie(K.target.value)}),e.jsx("button",{type:"button",className:"search-button",children:e.jsx(Rt,{})})]})]}),e.jsx("div",{className:"colleges-actions",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,width:"100%"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("button",{type:"button",className:"action-button add-new",onClick:()=>{ge(!1),W({building_id:"",building_name:""}),ce(!0)},children:e.jsx(Ct,{})}),e.jsx("button",{type:"button",className:"action-button import",onClick:()=>Q(!0),children:e.jsx(Lt,{})})]}),e.jsx("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:8},children:e.jsx("button",{type:"button",className:"action-button delete",onClick:_e,disabled:r||se.size===0,title:se.size>0?`Delete ${se.size} selected`:"Delete selected",children:e.jsx(bt,{})})})]})}),e.jsx("div",{className:"colleges-table-container",children:e.jsxs("table",{className:"colleges-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Building #"}),e.jsx("th",{children:"Building Name"}),e.jsx("th",{children:"Room Count"}),e.jsx("th",{children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{children:"Actions"}),e.jsx("input",{type:"checkbox",checked:c,onChange:U,disabled:w||o.length===0,"aria-label":"Select all",title:"Select all",style:{marginLeft:"auto"}})]})})]})}),e.jsx("tbody",{children:w?e.jsx("tr",{children:e.jsx("td",{colSpan:5,style:{textAlign:"center",padding:"20px"},children:"Loading buidlings..."})}):N.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,style:{textAlign:"center",padding:"20px"},children:"No buildings found."})}):N.map((K,be)=>e.jsxs("tr",{children:[e.jsx("td",{children:be+1}),e.jsx("td",{children:K.building_id}),e.jsx("td",{children:K.building_name}),e.jsx("td",{children:i[K.building_id]||0}),e.jsxs("td",{className:"action-buttons",style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("button",{type:"button",className:"icon-button view-button",title:"View Rooms",onClick:()=>V(K.building_id),children:e.jsx(Ut,{})}),e.jsx("button",{type:"button",className:"icon-button edit-button",onClick:()=>{ge(!0),W(K),ce(!0)},children:e.jsx(Ft,{})}),e.jsx("input",{type:"checkbox",checked:se.has(K.building_id),onChange:()=>$(K.building_id),"aria-label":`Select ${K.building_name}`,style:{marginLeft:"auto"}})]})]},K.building_id))})]})}),ne&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal",children:[e.jsx("h3",{style:{textAlign:"center"},children:te?"Edit Building":"Add New Building"}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Building ID"}),e.jsx("input",{type:"text",disabled:te,value:L.building_id,onChange:K=>W({...L,building_id:K.target.value})})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Building Name"}),e.jsx("input",{type:"text",value:L.building_name,onChange:K=>W({...L,building_name:K.target.value})})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:J,children:"Save"}),e.jsx("button",{type:"button",onClick:()=>ce(!1),children:"Cancel"})]})]})}),H&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal",children:[e.jsx("h3",{style:{textAlign:"center"},children:"Import Buildings"}),e.jsx("p",{style:{fontSize:"12px",color:"#666",marginBottom:"10px"},children:"Each building must have a unique Building ID and Name."}),e.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:ue,disabled:n}),e.jsxs("div",{className:"modal-actions",children:[e.jsxs("button",{type:"button",className:"modal-button download",onClick:T,disabled:n,children:[e.jsx(Et,{style:{marginRight:5}})," Download Template"]}),e.jsx("button",{type:"button",onClick:()=>Q(!1),disabled:n,children:n?"Importing…":"Close"})]})]})}),pe&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal room-modal",style:{width:600},children:[e.jsxs("h3",{children:["Rooms in ",q]}),e.jsxs("table",{className:"accounts-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Room #"}),e.jsx("th",{children:"Room Name"}),e.jsx("th",{children:"Type"})]})}),e.jsxs("tbody",{children:[O.map(K=>e.jsxs("tr",{children:[e.jsx("td",{children:K.room_id}),e.jsx("td",{children:K.room_name}),e.jsx("td",{children:K.room_type})]},K.room_id)),O.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,children:"No rooms found."})})]})]}),e.jsx("div",{className:"modal-actions",children:e.jsx("button",{type:"button",onClick:()=>D(!1),children:"Close"})})]})}),e.jsx(ft,{position:"top-right",autoClose:3e3})]})},Za=()=>{const[o,l]=t.useState([]),[i,F]=t.useState([]),[R,C]=t.useState(""),[O,ee]=t.useState(!1),[P,ie]=t.useState(!1),[ne,ce]=t.useState(!1),[H,Q]=t.useState(!1),[pe,D]=t.useState(!0),[te,ge]=t.useState(!1),[w,M]=t.useState(new Set),[n,f]=t.useState(!1),[r,b]=t.useState({room_id:"",room_name:"",room_type:"",room_capacity:0,building_id:""});t.useEffect(()=>{L()},[]);const L=async()=>{try{D(!0);const[u,V]=await Promise.all([g.get("/tbl_rooms"),g.get("/tbl_buildings")]);l(u.data??[]),F(V.data??[])}catch(u){console.error(u.message),a.error("Failed to fetch rooms or buildings")}finally{D(!1)}},W=async()=>{var N;const{room_id:u,room_name:V,room_type:J,room_capacity:ue,building_id:T}=r;if(!u||!V||!J||!ue||!T){a.error("All fields are required");return}ce(!0);try{const _e={room_name:V,room_type:J,room_capacity:ue,building:T};P?(await g.put(`/tbl_rooms/${u}/`,_e),a.success("Room updated successfully")):(await g.post("/tbl_rooms",{room_id:u,..._e}),a.success("Room added successfully")),ee(!1),setTimeout(()=>L(),300)}catch(_e){console.error(((N=_e.response)==null?void 0:N.data)||_e.message),a.error("Failed to save room")}finally{ce(!1)}},q=u=>{M(V=>{const J=new Set(V);return J.has(u)?J.delete(u):J.add(u),J})},E=o.length>0&&o.every(u=>w.has(u.room_id)),se=()=>{M(()=>{if(E)return new Set;const u=new Set;return o.forEach(V=>u.add(V.room_id)),u})},k=()=>M(new Set),de=async()=>{const u=Array.from(w);if(u.length===0){a.info("No rooms selected");return}if(globalThis.confirm(`Delete ${u.length} selected room(s)?`)){f(!0);try{const V=await Promise.allSettled(u.map(T=>g.delete(`/tbl_rooms/${T}/`))),J=V.filter(T=>T.status==="fulfilled").length,ue=V.length-J;J&&a.success(`Deleted ${J} room(s)`),ue&&a.error(`${ue} failed to delete`),k(),setTimeout(()=>L(),300)}catch{a.error("Bulk delete failed")}finally{f(!1)}}},$=u=>{var ue;const V=(ue=u.target.files)==null?void 0:ue[0];if(!V)return;const J=new FileReader;J.onload=async T=>{var N,_e,K,be;ge(!0);try{const z=new Uint8Array(T.target.result),G=At(z,{type:"array"}),y=G.Sheets[G.SheetNames[0]],I=tt.sheet_to_json(y);let je=0;for(const Ce of I){const m=(N=Ce["Room ID"])==null?void 0:N.trim(),me=(_e=Ce["Room Name"])==null?void 0:_e.trim(),j=(K=Ce["Room Type"])==null?void 0:K.trim(),h=parseInt(Ce["Room Capacity"]||0),A=(be=Ce["Building ID"])==null?void 0:be.trim();if(!(!m||!me||!j||!h||!A))try{await g.post("/tbl_rooms",{room_id:m,room_name:me,room_type:j,room_capacity:h,building:A}),je++}catch{continue}}a.success(`Import completed: ${je} room(s) added`),setTimeout(()=>L(),300)}catch{a.error("Error reading or importing file")}finally{ge(!1),Q(!1)}},J.readAsArrayBuffer(V)},c=()=>{const u=tt.aoa_to_sheet([["Room ID","Room Name","Room Type","Room Capacity","Building ID"],["9-301","Cisco Lab","Laboratory",15,"BLDG.09"]]),V=tt.book_new();tt.book_append_sheet(V,u,"Rooms Template"),It(V,"rooms_template.xlsx")},U=o.filter(u=>u.room_name.toLowerCase().includes(R.toLowerCase())||u.room_id.toLowerCase().includes(R.toLowerCase()));return e.jsxs("div",{className:"colleges-container",children:[e.jsxs("div",{className:"colleges-header",children:[e.jsx("h2",{className:"colleges-title",children:"Manage Rooms"}),e.jsxs("div",{className:"search-bar",children:[e.jsx("input",{type:"text",placeholder:"Search Room Name",value:R,onChange:u=>C(u.target.value)}),e.jsx("button",{type:"button",className:"search-button",children:e.jsx(Rt,{})})]})]}),e.jsx("div",{className:"colleges-actions",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,width:"100%"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("button",{type:"button",className:"action-button add-new",onClick:()=>{ie(!1),b({room_id:"",room_name:"",room_type:"",room_capacity:0,building_id:""}),ee(!0)},children:e.jsx(Ct,{})}),e.jsx("button",{type:"button",className:"action-button import",onClick:()=>Q(!0),children:e.jsx(Lt,{})})]}),e.jsx("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:8},children:e.jsx("button",{type:"button",className:"action-button delete",onClick:de,disabled:n||w.size===0,title:w.size?`Delete ${w.size} selected`:"Delete selected",children:e.jsx(bt,{})})})]})}),e.jsx("div",{className:"colleges-table-container",children:e.jsxs("table",{className:"colleges-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Room #"}),e.jsx("th",{children:"Room Name"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Capacity"}),e.jsx("th",{children:"Building"}),e.jsx("th",{children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{children:"Actions"}),e.jsx("input",{type:"checkbox",checked:E,onChange:se,disabled:pe||o.length===0,"aria-label":"Select all",title:"Select all",style:{marginLeft:"auto"}})]})})]})}),e.jsx("tbody",{children:pe?e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",padding:"20px"},children:"Loading rooms..."})}):U.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center",padding:"20px"},children:"No rooms found."})}):U.map((u,V)=>e.jsxs("tr",{children:[e.jsx("td",{children:V+1}),e.jsx("td",{children:u.room_id}),e.jsx("td",{children:u.room_name}),e.jsx("td",{children:u.room_type}),e.jsx("td",{children:u.room_capacity}),e.jsx("td",{children:u.building_name||u.building_id}),e.jsxs("td",{className:"action-buttons",style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("button",{type:"button",className:"icon-button edit-button",onClick:()=>{ie(!0),b({room_id:u.room_id,room_name:u.room_name,room_type:u.room_type,room_capacity:u.room_capacity,building_id:u.building_id}),ee(!0)},children:e.jsx(Ft,{})}),e.jsx("input",{type:"checkbox",checked:w.has(u.room_id),onChange:()=>q(u.room_id),"aria-label":`Select ${u.room_name}`,style:{marginLeft:"auto"}})]})]},u.room_id))})]})}),O&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal",children:[e.jsx("h3",{style:{textAlign:"center"},children:P?"Edit Room":"Add New Room"}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Room ID"}),e.jsx("input",{type:"text",value:r.room_id,disabled:P,onChange:u=>b({...r,room_id:u.target.value})})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Room Name"}),e.jsx("input",{type:"text",value:r.room_name,onChange:u=>b({...r,room_name:u.target.value})})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Room Type"}),e.jsxs("select",{value:r.room_type,onChange:u=>b({...r,room_type:u.target.value}),children:[e.jsx("option",{value:"",children:"Select Type"}),e.jsx("option",{value:"Lecture",children:"Lecture"}),e.jsx("option",{value:"Laboratory",children:"Laboratory"})]})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Room Capacity"}),e.jsx("input",{type:"number",value:r.room_capacity,onChange:u=>b({...r,room_capacity:parseInt(u.target.value)||0})})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Building"}),e.jsx(lt,{className:"react-select",classNamePrefix:"select",options:i.sort((u,V)=>u.building_name.localeCompare(V.building_name)).map(u=>({value:u.building_id,label:`${u.building_name} (${u.building_id})`})),value:i.map(u=>({value:u.building_id,label:`${u.building_name} (${u.building_id})`})).find(u=>u.value===r.building_id),onChange:u=>b({...r,building_id:(u==null?void 0:u.value)||""}),placeholder:"Select Building",isClearable:!0})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",onClick:W,disabled:ne,children:ne?"Saving...":"Save"}),e.jsx("button",{type:"button",onClick:()=>ee(!1),children:"Cancel"})]})]})}),H&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal",children:[e.jsx("h3",{style:{textAlign:"center"},children:"Import Rooms"}),e.jsx("p",{style:{fontSize:"12px",color:"#666",marginBottom:"10px"},children:"Each room must have a unique Room ID and valid Building ID."}),e.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:$,disabled:te}),e.jsxs("div",{className:"modal-actions",children:[e.jsxs("button",{type:"button",className:"modal-button download",onClick:c,disabled:te,children:[e.jsx(Et,{style:{marginRight:5}})," Download Template"]}),e.jsx("button",{type:"button",onClick:()=>Q(!1),disabled:te,children:te?"Importing…":"Close"})]})]})}),e.jsx(ft,{position:"top-right",autoClose:3e3})]})},xs=["2024-2025","2025-2026","2026-2027","2027-2028","2028-2029"],fs=["Preliminary","Midterm","Pre-Final","Final"],Xa=()=>{var I,je,Ce;const[o,l]=t.useState([]),[i,F]=t.useState([]),[R,C]=t.useState([]),[O,ee]=t.useState([]),[P,ie]=t.useState(""),[ne,ce]=t.useState(!1),[H,Q]=t.useState(!1),[pe,D]=t.useState(!1),[te,ge]=t.useState(!1),[w,M]=t.useState(""),[n,f]=t.useState(""),[r,b]=t.useState(""),[L,W]=t.useState(""),[q,E]=t.useState(""),[se,k]=t.useState(!1),[de,$]=t.useState(!0),[c,U]=t.useState([]),[u,V]=t.useState(new Set),[J,ue]=t.useState({start_date:"",end_date:"",academic_year:"",exam_category:"",term_id:0,department_id:"",college_id:null});t.useEffect(()=>{T()},[]);const T=async()=>{$(!0);try{const[m,me,j,h]=await Promise.all([g.get("/tbl_examperiod"),g.get("/tbl_term"),g.get("/departments/"),g.get("/tbl_college/")]);l(m.data),F(me.data),C(j.data),ee(h.data)}catch(m){console.error(m),a.error("Failed to fetch data")}finally{$(!1)}};t.useEffect(()=>{if(c.length===1)ue(m=>({...m,start_date:y(c[0]),end_date:y(c[0])}));else if(c.length>1){const m=[...c].sort((me,j)=>me.getTime()-j.getTime());ue(me=>({...me,start_date:y(m[0]),end_date:y(m[m.length-1])}))}else ue(m=>({...m,start_date:"",end_date:""}))},[c]);const N=async()=>{var B;const{academic_year:m,exam_category:me,term_id:j,department_id:h,college_id:A,examperiod_id:he}=J;if(!m||!me||!j||c.length===0){a.error("Please fill in all required fields and select at least one date");return}ge(!0);const p=re=>{const Z=we=>we.toString().padStart(2,"0");return`${re.getFullYear()}-${Z(re.getMonth()+1)}-${Z(re.getDate())}`};try{if(pe&&he){const re={start_date:J.start_date,end_date:J.end_date,academic_year:m,exam_category:me,term:j,department:h||null,college:A||null},Z=await g.put(`/tbl_examperiod/${he}/`,re);a.success("Exam period updated"),l(we=>we.map(Re=>Re.examperiod_id===he?Z.data:Re))}else{const re=[...c].sort((we,Re)=>we.getTime()-Re.getTime()),Z=[];for(const we of re){const Re=p(we),d={start_date:`${Re}T00:00:00`,end_date:`${Re}T00:00:00`,academic_year:m,exam_category:me,term:j,department:h||null,college:A||null};for(let _=0;_<2;_++)try{const Y=await g.post("/tbl_examperiod",d);Z.push(Y.data)}catch(Y){console.error("❌ Failed payload:",d),console.error("📩 Error response:",(B=Y.response)==null?void 0:B.data)}}Z.length>0&&l(we=>[...Z,...we]),a.success(`Successfully added ${Z.length} exam period${Z.length>1?"s":""}`)}ce(!1),U([]),V(new Set)}catch(re){console.error(re),a.error("Failed to save exam period")}finally{ge(!1)}},_e=o.filter(m=>(!P||m.academic_year.toLowerCase().includes(P.toLowerCase()))&&(!w||m.academic_year===w)&&(!n||m.exam_category===n)&&(!r||m.term_id.toString()===r)&&(!L||m.department_id===L)&&(!q||m.college_id===q)&&m.start_date);t.useEffect(()=>{V(m=>{const me=new Set;return o.forEach(j=>{j.examperiod_id&&m.has(j.examperiod_id)&&me.add(j.examperiod_id)}),me})},[o]);const K=m=>{m&&V(me=>{const j=new Set(me);return j.has(m)?j.delete(m):j.add(m),j})},be=(()=>{const m=_e.filter(me=>typeof me.examperiod_id=="number");return m.length===0?!1:m.every(me=>me.examperiod_id&&u.has(me.examperiod_id))})(),z=()=>{const m=_e.filter(me=>typeof me.examperiod_id=="number");m.length!==0&&V(()=>{if(be)return new Set;const me=new Set;return m.forEach(j=>{j.examperiod_id&&me.add(j.examperiod_id)}),me})},G=m=>{var h;const me=(h=m.target.files)==null?void 0:h[0];if(!me)return;const j=new FileReader;j.onload=async A=>{const he=A.target.result,p=At(he,{type:"binary"}),B=p.Sheets[p.SheetNames[0]],re=tt.sheet_to_json(B);let Z=0;for(const we of re){const Re=i.find(ye=>ye.term_name===we["Term Name"]),d=R.find(ye=>ye.department_id===we["Department ID"]),_=O.find(ye=>ye.college_id===we["College ID"]);if(!Re)continue;const Y={start_date:new Date(we["Start Date"]).toISOString(),end_date:new Date(we["End Date"]).toISOString(),academic_year:we["Academic Year"],exam_category:we["Exam Category"],term_id:Re.term_id,department_id:(d==null?void 0:d.department_id)||null,college_id:(_==null?void 0:_.college_id)||null};try{await g.post("/tbl_examperiod",Y),Z++}catch(ye){console.error(ye)}}a.success(`Import successful: ${Z} record(s) added`),Q(!1),T()},j.readAsBinaryString(me)};function y(m){const me=j=>j.toString().padStart(2,"0");return`${m.getFullYear()}-${me(m.getMonth()+1)}-${me(m.getDate())}`}return e.jsxs("div",{className:"colleges-container",children:[e.jsxs("div",{className:"colleges-header",children:[e.jsx("h2",{className:"colleges-title",children:"Exam Periods"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsxs("div",{className:"search-bar",children:[e.jsx("input",{type:"text",placeholder:"Search exam periods...",value:P,onChange:m=>ie(m.target.value)}),e.jsx("button",{type:"button",className:"search-button",children:e.jsx(Rt,{})})]}),e.jsx("button",{type:"button",className:"action-button",style:{minWidth:90},onClick:()=>k(m=>!m),children:se?"Hide Filters":"Show Filters"})]})]}),se&&e.jsxs("div",{className:"advanced-filters",style:{marginBottom:16},children:[e.jsxs("select",{value:w,onChange:m=>M(m.target.value),children:[e.jsx("option",{value:"",children:"All Years"}),xs.map(m=>e.jsx("option",{value:m,children:m},m))]}),e.jsxs("select",{value:n,onChange:m=>f(m.target.value),children:[e.jsx("option",{value:"",children:"All Categories"}),fs.map(m=>e.jsx("option",{value:m,children:m},m))]}),e.jsxs("select",{value:r,onChange:m=>b(m.target.value),children:[e.jsx("option",{value:"",children:"All Terms"}),i.map(m=>e.jsx("option",{value:m.term_id.toString(),children:m.term_name},m.term_id))]}),e.jsxs("select",{value:L,onChange:m=>W(m.target.value),children:[e.jsx("option",{value:"",children:"All Departments"}),R.map(m=>e.jsx("option",{value:m.department_id,children:m.department_name},m.department_id))]}),e.jsxs("select",{value:q,onChange:m=>E(m.target.value),children:[e.jsx("option",{value:"",children:"All Colleges"}),O.map(m=>e.jsx("option",{value:m.college_id,children:m.college_name},m.college_id))]})]}),e.jsxs("div",{className:"colleges-actions",style:{display:"flex",width:"100%",alignItems:"center"},children:[e.jsx("div",{children:e.jsx("button",{type:"button",className:"action-button add-new",onClick:()=>{D(!1),ue({start_date:"",end_date:"",academic_year:"",exam_category:"",term_id:0,department_id:"",college_id:null}),U([]),ce(!0)},children:e.jsx(Ct,{})})}),e.jsx("div",{style:{marginLeft:"auto"},children:e.jsx("button",{type:"button",className:"action-button delete",onClick:async()=>{if(globalThis.confirm("Are you sure you want to delete all exam periods?"))try{await g.delete("/tbl_examperiod"),a.success("All exam periods deleted"),T()}catch(m){console.error(m),a.error("Failed to delete all exam periods")}},children:e.jsx(bt,{})})})]}),e.jsx("div",{className:"colleges-table-container",children:e.jsxs("table",{className:"colleges-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Start"}),e.jsx("th",{children:"End"}),e.jsx("th",{children:"Academic Year"}),e.jsx("th",{children:"Exam Category"}),e.jsx("th",{children:"Term"}),e.jsx("th",{children:"Department"}),e.jsx("th",{children:"College"}),e.jsx("th",{children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{children:"Actions"}),e.jsx("input",{type:"checkbox",checked:be,onChange:z,disabled:de||_e.length===0,"aria-label":"Select all exam periods",title:"Select all",style:{marginLeft:"auto"}})]})})]})}),e.jsx("tbody",{children:de?e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{textAlign:"center",padding:"20px"},children:"Loading exam periods..."})}):_e.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{textAlign:"center",padding:"20px"},children:"No exam periods found."})}):_e.map((m,me)=>{var j;return e.jsxs("tr",{children:[e.jsx("td",{children:me+1}),e.jsx("td",{children:new Date(m.start_date).toLocaleDateString()}),e.jsx("td",{children:new Date(m.end_date).toLocaleDateString()}),e.jsx("td",{children:m.academic_year}),e.jsx("td",{children:m.exam_category}),e.jsx("td",{children:(j=i.find(h=>h.term_id===m.term_id))==null?void 0:j.term_name}),e.jsx("td",{children:m.department_id}),e.jsx("td",{children:m.college_id}),e.jsxs("td",{className:"action-buttons",style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("button",{type:"button",className:"icon-button edit-button",onClick:()=>{D(!0),ue(m),U([new Date(m.start_date)]),ce(!0)},children:e.jsx(Ft,{})}),e.jsx("input",{type:"checkbox",checked:!!m.examperiod_id&&u.has(m.examperiod_id),onChange:()=>K(m.examperiod_id),"aria-label":"Select exam period",style:{marginLeft:"auto"}})]})]},m.examperiod_id)})})]})}),ne&&e.jsx("div",{className:"examperiod-overlay",children:e.jsxs("div",{className:"examperiod-modal",children:[e.jsx("h3",{className:"examperiod-title",children:pe?"Edit Exam Period":"Set Exam Period"}),e.jsxs("div",{className:"examperiod-body",children:[e.jsxs("div",{className:"examperiod-calendar-section",children:[e.jsx("label",{className:"examperiod-label",children:"Select Exam Duration"}),e.jsx(oa,{calendarType:"gregory",value:void 0,onClickDay:m=>{const me=c.some(j=>y(j)===y(m));U(me?j=>j.filter(h=>y(h)!==y(m)):j=>[...j,m])},tileClassName:({date:m})=>c.some(me=>y(me)===y(m))?"examperiod-selected-day":void 0})]}),e.jsxs("div",{className:"examperiod-inputs-section",children:[e.jsxs("div",{className:"examperiod-input-group",children:[e.jsx("label",{className:"examperiod-label",children:"Academic Year"}),e.jsx(lt,{className:"examperiod-select",classNamePrefix:"examperiod",options:xs.map(m=>({value:m,label:m})),value:J.academic_year?{value:J.academic_year,label:J.academic_year}:null,onChange:m=>ue({...J,academic_year:(m==null?void 0:m.value)??""}),placeholder:"Select Year",isClearable:!0})]}),e.jsxs("div",{className:"examperiod-input-group",children:[e.jsx("label",{className:"examperiod-label",children:"Exam Term"}),e.jsx(lt,{className:"examperiod-select",classNamePrefix:"examperiod",options:fs.map(m=>({value:m,label:m})),value:J.exam_category?{value:J.exam_category,label:J.exam_category}:null,onChange:m=>ue({...J,exam_category:(m==null?void 0:m.value)??""}),placeholder:"Select Exam Term",isClearable:!0})]}),e.jsxs("div",{className:"examperiod-input-group",children:[e.jsx("label",{className:"examperiod-label",children:"Semester"}),e.jsx(lt,{className:"examperiod-select",classNamePrefix:"examperiod",options:i.sort((m,me)=>m.term_name.localeCompare(me.term_name)).map(m=>({value:m.term_id,label:m.term_name})),value:J.term_id?{value:J.term_id,label:((I=i.find(m=>m.term_id===J.term_id))==null?void 0:I.term_name)||""}:null,onChange:m=>ue({...J,term_id:(m==null?void 0:m.value)??0}),placeholder:"Select Semester",isClearable:!0})]}),e.jsxs("div",{className:"examperiod-input-group",children:[e.jsx("label",{className:"examperiod-label",children:"Department"}),e.jsx(lt,{className:"examperiod-select",classNamePrefix:"examperiod",options:R.sort((m,me)=>m.department_name.localeCompare(me.department_name)).map(m=>({value:m.department_id,label:m.department_name})),value:J.department_id?{value:J.department_id,label:((je=R.find(m=>m.department_id===J.department_id))==null?void 0:je.department_name)||""}:null,onChange:m=>ue({...J,department_id:(m==null?void 0:m.value)||null}),placeholder:"Optional",isClearable:!0})]}),e.jsxs("div",{className:"examperiod-input-group",children:[e.jsx("label",{className:"examperiod-label",children:"College"}),e.jsx(lt,{className:"examperiod-select",classNamePrefix:"examperiod",options:O.sort((m,me)=>m.college_name.localeCompare(me.college_name)).map(m=>({value:m.college_id,label:m.college_name})),value:J.college_id?{value:J.college_id,label:((Ce=O.find(m=>m.college_id===J.college_id))==null?void 0:Ce.college_name)||""}:null,onChange:m=>ue({...J,college_id:(m==null?void 0:m.value)||null}),placeholder:"Optional",isClearable:!0,menuPlacement:"top"})]})]})]}),e.jsxs("div",{className:"examperiod-actions",children:[e.jsx("button",{type:"button",onClick:N,disabled:te,children:te?"Saving...":"Save"}),e.jsx("button",{type:"button",onClick:()=>ce(!1),children:"Cancel"})]})]})}),H&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal",children:[e.jsx("h3",{children:"Import Exam Periods"}),e.jsx("input",{type:"file",accept:".xlsx, .xls",onChange:G}),e.jsx("button",{type:"button",onClick:()=>Q(!1),children:"Close"})]})}),e.jsx(ft,{})]})},Qa=({})=>{var Ne,Ue,et,Ge;const[o,l]=t.useState([]),[i,F]=t.useState([]),[R,C]=t.useState([]),[O,ee]=t.useState([]),[P,ie]=t.useState([]),[ne,ce]=t.useState(""),[H,Q]=t.useState(""),[pe,D]=t.useState(!0),[te,ge]=t.useState(!1),[w,M]=t.useState(!1),[n,f]=t.useState(!1),[r,b]=t.useState(!1),[L,W]=t.useState(!1),[q,E]=t.useState(!1),[se,k]=t.useState(!1),[de,$]=t.useState(null),[c,U]=t.useState(null),[u,V]=t.useState(!1),[J,ue]=t.useState(new Set),[T,N]=t.useState({user_id:0,first_name:"",last_name:"",middle_name:"",email_address:"",contact_number:"",status:"Active",created_at:new Date().toISOString()}),[_e,K]=t.useState([]),[be,z]=t.useState({}),G=s=>{var v;switch((v=i.find(X=>X.role_id===s))==null?void 0:v.role_name){case"Bayanihan Leader":return{college:!1,department:!0};case"Dean":return{college:!0,department:!1};case"Admin":return{college:!1,department:!1};case"Scheduler":return{college:!0,department:!1};case"Proctor":return{college:!0,department:!0};default:return{college:!0,department:!0}}},y=async()=>{D(!0);try{const[s,x,v,X,Se]=await Promise.all([g.get("/accounts/"),g.get("/tbl_roles/"),g.get("/tbl_college/"),g.get("/departments/"),g.get("/tbl_user_role")]);l(s.data);const Te=x.data,qe=v.data,$e=X.data;F(Te),C(qe),ee($e);const le=new Date().toISOString().split("T")[0],ke=Se.data.map(Pe=>{let Ve=Pe.status??"Active";Pe.date_ended&&Pe.date_ended<le&&(Ve="Suspended");const Me=Te.find(at=>at.role_id===Pe.role),De=qe.find(at=>at.college_id===Pe.college),He=$e.find(at=>at.department_id===Pe.department);return{...Pe,status:Ve,role_name:(Me==null?void 0:Me.role_name)||null,college_id:Pe.college,college_name:(De==null?void 0:De.college_name)||null,department_id:Pe.department,department_name:(He==null?void 0:He.department_name)||null}});ie(ke),qe.length>0&&!H&&Q(qe[0].college_id);const fe=ke.filter(Pe=>{var Me;return(((Me=Se.data.find(De=>De.user_role_id===Pe.user_role_id))==null?void 0:Me.status)??"Active")!==Pe.status});await Promise.all(fe.map(Pe=>g.put(`/tbl_user_role/${Pe.user_role_id}/`,{status:Pe.status})))}catch(s){console.error(s),a.error("Error fetching data")}finally{D(!1)}};t.useEffect(()=>{y()},[]);const I=async()=>{var $e,le;const{user_id:s,first_name:x,last_name:v,email_address:X,contact_number:Se,status:Te,middle_name:qe}=T;if(!(T.user_id>0)||!x||!v||!X||!Se){a.error("Please fill all required fields including User ID");return}if(!se&&_e.length===0){a.error("Please add at least one role for the new account");return}for(const ke of _e){if(!ke.role_id){a.error("Please select a role for all role entries");return}if(!ke.college_id&&!ke.department_id){a.error("Each role must have either a college or department assigned");return}}try{if(se)await g.put(`/accounts/${s}/`,{first_name:x,last_name:v,middle_name:qe,email_address:X,contact_number:Se,status:Te}),a.success("Account updated successfully!");else{const ke=`${v}@${s}`;await g.post("/create-account/",{user_id:s,first_name:x,last_name:v,middle_name:qe,email_address:X,contact_number:Se,status:Te,password:ke,created_at:new Date().toISOString()});for(const fe of _e)await g.post("/tbl_user_role/CRUD/",{user:s,role:fe.role_id,college:fe.college_id||null,department:fe.department_id||null,date_start:fe.date_start||null,date_ended:fe.date_ended||null,status:"Active"});a.success(`Account created with ${_e.length} role(s)! Default password: ${v}@${s}`)}f(!1),K([]),await y()}catch(ke){console.error(ke),a.error(((le=($e=ke.response)==null?void 0:$e.data)==null?void 0:le.detail)||"Error saving account")}},je=async s=>{if(globalThis.confirm("Are you sure you want to delete this account?"))try{const x=P.filter(v=>v.user===s);await Promise.all(x.map(v=>g.delete(`/tbl_user_role/${v.user_role_id}/`))),await g.delete(`/accounts/${s}/`),a.success("Account and associated roles deleted"),y(),ue(v=>{const X=new Set(v);return X.delete(s),X})}catch(x){console.error(x),a.error("Error deleting account")}},Ce=async()=>{const s=Array.from(J);if(s.length===0){a.info("No accounts selected");return}if(globalThis.confirm(`Delete ${s.length} selected account(s)? This cannot be undone.`)){V(!0);try{await Promise.all(s.map(async x=>{const v=P.filter(X=>X.user===x);await Promise.all(v.map(X=>g.delete(`/tbl_user_role/${X.user_role_id}/`))),await g.delete(`/accounts/${x}/`)})),a.success(`Deleted ${s.length} account(s) and their roles`),ue(new Set),y()}catch(x){console.error(x),a.error("Error deleting selected accounts")}finally{V(!1)}}},m=async()=>{if(!be.role_id){a.error("Role is required.");return}try{const s={user:be.user||de,role:be.role_id,college:be.college_id||null,department:be.department_id||null,date_start:be.date_start||null,date_ended:be.date_ended||null,status:"Active"},{data:x,status:v}=await g.post("/tbl_user_role/CRUD/",s);if(!x||v!==201){a.error("Failed to add role.");return}a.success("Role added successfully."),ie(X=>[...X,x]),b(!1),z({})}catch(s){console.error(s),a.error("Failed to add role.")}},me=async()=>{if(c)try{await g.put(`/tbl_user_role/${c.user_role_id}/`,{role:c.role,college:c.college_id,department:c.department_id,date_start:c.date_start,date_ended:c.date_ended}),a.success("Role updated successfully."),U(null),y()}catch(s){console.error(s),a.error("Failed to update role.")}},j=async(s,x)=>{const v=x==="Suspended"?"Active":"Suspended";try{const{data:X,status:Se}=await g.put(`/tbl_user_role/${s}/`,{status:v});if(!X||Se!==200){a.error(`Failed to ${v==="Active"?"reactivate":"suspend"} role.`);return}a.success(`Role ${v==="Active"?"reactivated":"suspended"}.`),y()}catch(X){console.error(X),a.error(`Failed to ${v==="Active"?"reactivate":"suspend"} role.`)}},h=async s=>{if(confirm("Are you sure you want to delete this role?"))try{const x=await g.delete(`/tbl_user_role/${s}/`);x.status===200||x.status===204?(a.success("Role deleted successfully."),ie(v=>v.filter(X=>X.user_role_id!==s))):a.error("Failed to delete role.")}catch(x){console.error(x),a.error("Failed to delete role.")}},A=s=>{var X;const x=(X=s.target.files)==null?void 0:X[0];if(!x)return;const v=new FileReader;v.onload=async Se=>{var De,He,at,S,ae,Ie,Oe,Ae,Ye,Ze,Je,ze,xe;ge(!0),a.info("Importing accounts... Please wait.",{autoClose:!1,toastId:"import-progress"});const Te=new Uint8Array((De=Se.target)==null?void 0:De.result),qe=At(Te,{type:"array"}),$e=qe.Sheets[qe.SheetNames[0]],le=tt.sheet_to_json($e,{defval:""});let ke=0,fe=0,Pe=0;const Ve=[];for(let Fe=0;Fe<le.length;Fe++){const Le=le[Fe],Ke=Fe+2;try{const Xe=Number(Le.user_id??Le.id),Be=String(Le.first_name??"").trim(),_t=String(Le.last_name??"").trim(),ht=String(Le.middle_name??"").trim(),wt=String(Le.email_address??"").trim(),jt=String(Le.contact_number??"").trim(),it=String(Le.status??"Active");if(!Xe){Ve.push(`Row ${Ke}: Missing user_id`),Pe++;continue}if(!Be){Ve.push(`Row ${Ke}: Missing first_name for user ${Xe}`),Pe++;continue}if(!_t){Ve.push(`Row ${Ke}: Missing last_name for user ${Xe}`),Pe++;continue}if(!wt){Ve.push(`Row ${Ke}: Missing email_address for user ${Xe}`),Pe++;continue}if(!jt){Ve.push(`Row ${Ke}: Missing contact_number for user ${Xe}`),Pe++;continue}const oe=o.find(rt=>rt.user_id===Xe),ve=`${_t}@${Xe}`;if(oe){const rt={};Be&&(rt.first_name=Be),_t&&(rt.last_name=_t),ht&&(rt.middle_name=ht),wt&&(rt.email_address=wt),jt&&(rt.contact_number=jt),it&&(rt.status=it),await g.put(`/accounts/${Xe}/`,rt),fe++}else await g.post("/create-account/",{user_id:Xe,first_name:Be,last_name:_t,middle_name:ht,email_address:wt,contact_number:jt,status:it,password:ve,created_at:new Date().toISOString()}),ke++;const We=String(Le.roles??"").trim(),ot=String(Le.colleges??"").trim(),nt=String(Le.departments??"").trim(),st=String(Le.date_starts??"").trim(),ct=String(Le.date_endeds??"").trim();if(We){const rt=We.split(";").map(dt=>Number(dt.trim())).filter(dt=>dt>0),pt=ot.split(";").map(dt=>dt.trim()),gt=nt.split(";").map(dt=>dt.trim()),yt=st.split(";").map(dt=>Ee(dt.trim())),Qe=ct.split(";").map(dt=>Ee(dt.trim()));if(rt.length!==pt.length||rt.length!==gt.length){Ve.push(`Row ${Ke}: Mismatch in role data counts (roles: ${rt.length}, colleges: ${pt.length}, departments: ${gt.length})`);continue}for(let dt=0;dt<rt.length;dt++){const xt=rt[dt],$t=pt[dt]||null,St=gt[dt]||null,vt=yt[dt],kt=Qe[dt];if(!i.find(mt=>mt.role_id===xt)){Ve.push(`Row ${Ke}: Invalid role ID ${xt} for user ${Xe}`);continue}if(!$t&&!St){Ve.push(`Row ${Ke}: Role ${xt} for user ${Xe} must have either college or department`);continue}if($t&&!R.find(mt=>mt.college_id===$t)){Ve.push(`Row ${Ke}: Invalid college ID "${$t}" for user ${Xe}`);continue}if(St&&!O.find(mt=>mt.department_id===St)){Ve.push(`Row ${Ke}: Invalid department ID "${St}" for user ${Xe}`);continue}if(vt&&!/^\d{4}-\d{2}-\d{2}$/.test(vt)){Ve.push(`Row ${Ke}: Invalid date_start format for user ${Xe}, role ${xt}`);continue}if(kt&&!/^\d{4}-\d{2}-\d{2}$/.test(kt)){Ve.push(`Row ${Ke}: Invalid date_ended format for user ${Xe}, role ${xt}`);continue}const Mt=P.find(mt=>mt.user===Xe&&mt.role===xt&&mt.college===$t&&mt.department===St);if(Mt){if(vt||kt)try{await g.put(`/tbl_user_role/${Mt.user_role_id}/`,{date_start:vt||Mt.date_start,date_ended:kt||Mt.date_ended})}catch(mt){const Pt=((at=(He=mt.response)==null?void 0:He.data)==null?void 0:at.detail)||((ae=(S=mt.response)==null?void 0:S.data)==null?void 0:ae.error)||mt.message||"Unknown error";Ve.push(`Row ${Ke}: Failed to update role ${xt} for user ${Xe} - ${Pt}`)}continue}try{await g.post("/tbl_user_role/CRUD/",{user:Xe,role:xt,college:$t,department:St,date_start:vt,date_ended:kt,status:"Active"})}catch(mt){const Pt=((Oe=(Ie=mt.response)==null?void 0:Ie.data)==null?void 0:Oe.detail)||((Ye=(Ae=mt.response)==null?void 0:Ae.data)==null?void 0:Ye.error)||mt.message||"Unknown error";Ve.push(`Row ${Ke}: Failed to add role ${xt} for user ${Xe} - ${Pt}`)}}}}catch(Xe){const Be=((Je=(Ze=Xe.response)==null?void 0:Ze.data)==null?void 0:Je.detail)||((xe=(ze=Xe.response)==null?void 0:ze.data)==null?void 0:xe.error)||Xe.message||"Unknown error";Ve.push(`Row ${Ke}: ${Be}`),Pe++}}a.dismiss("import-progress");const Me=[];ke>0&&Me.push(`${ke} new account(s) created`),fe>0&&Me.push(`${fe} account(s) updated`),Pe>0&&Me.push(`${Pe} account(s) failed`),Me.length>0&&a.success(Me.join(", ")),Ve.length>0&&(console.error("Import errors:",Ve),a.error(e.jsxs("div",{style:{maxHeight:"300px",overflowY:"auto"},children:[e.jsx("strong",{children:"Import errors:"}),e.jsx("ul",{style:{margin:"10px 0",paddingLeft:"20px",fontSize:"12px"},children:Ve.slice(0,10).map((Fe,Le)=>e.jsx("li",{children:Fe},Le))})]}),{autoClose:1e4})),await y(),ge(!1),W(!1)},v.readAsArrayBuffer(x)},he=s=>{var X;const x=(X=s.target.files)==null?void 0:X[0];if(!x)return;const v=new FileReader;v.onload=async Se=>{var Pe;ge(!0),a.info("Importing roles... Please wait.",{autoClose:!1,toastId:"import-roles-progress"});const Te=new Uint8Array((Pe=Se.target)==null?void 0:Pe.result),qe=At(Te,{type:"array"}),$e=qe.Sheets[qe.SheetNames[0]],le=tt.sheet_to_json($e);let ke=0,fe=0;for(const Ve of le){const{user:Me,role:De,college:He,department:at,date_start:S,date_ended:ae}=Ve;if(!Me||!De){console.warn("Skipping invalid row:",Ve),fe++;continue}try{const Ie=Ee(S),Oe=Ee(ae),Ae=P.find(Ye=>Ye.user===Me&&Ye.role===De&&Ye.college===(He||null)&&Ye.department===(at||null));Ae?(Ie||Oe)&&await g.put(`/tbl_user_role/${Ae.user_role_id}/`,{date_start:Ie||Ae.date_start,date_ended:Oe||Ae.date_ended}):await g.post("/tbl_user_role/CRUD/",{user:Me,role:De,college:He||null,department:at||null,date_start:Ie||null,date_ended:Oe||null,status:"Active"}),ke++}catch(Ie){console.error(Ie),fe++}}a.dismiss("import-roles-progress"),ke>0&&a.success(`Successfully imported ${ke} role(s)`),fe>0&&a.warning(`Failed to import ${fe} role(s)`),await y(),ge(!1),E(!1)},v.readAsArrayBuffer(x)},p=()=>{const s=tt.aoa_to_sheet([["user_id","first_name","last_name","middle_name","email_address","contact_number","status","roles","colleges","departments","date_starts","date_endeds"],[2025000001,"Juan","Dela Cruz","A.","juan@example.com","09123456789","Active","1;2","CITC;CITC","DIT;","2025-01-01","2025-12-31"],[2025000002,"Maria","Santos","B.","maria@example.com","09987654321","Active","3","","DIT","2025-01-01","2025-12-31"]]);tt.sheet_add_aoa(s,[[""],["INSTRUCTIONS:"],["- Multiple roles can be added by separating values with semicolons (;)"],["- roles: Use role IDs (e.g., 1;2;3 for three roles)"],["- Roles: 1 (Dean), 3 (Scheduler), 4 (Bayanihan Leader), 5 (Proctor)"],["- colleges: Use college IDs or leave empty (e.g., CITC;CAS)"],["- departments: Use department IDs or leave empty (e.g., DIT;DCIT;)"],["- Each role must have either a college OR department (or both)"],["- date_starts and date_endeds: Use format YYYY-MM-DD or leave empty"],["- Make sure the number of values in roles, colleges, departments, date_starts, and date_endeds match"]],{origin:"A5"});const x=tt.book_new();tt.book_append_sheet(x,s,"ImportTemplate"),It(x,"Accounts_Import_Template.xlsx")},B=()=>{const s=tt.aoa_to_sheet([["user","role","college","department","date_start","date_ended"],[2025000001,1,"CITC","DIT","2025-01-01","2025-12-31"],[2025000001,2,"CITC","","2025-01-01","2025-12-31"]]);tt.sheet_add_aoa(s,[[""],["INSTRUCTIONS:"],["- user: User ID number"],["- role: Role ID number"],["- college: College ID (can be empty if department is provided)"],["- department: Department ID (can be empty if college is provided)"],["- Each role must have either college OR department (or both)"],["- date_start and date_ended: Use format YYYY-MM-DD or leave empty"]],{origin:"A5"});const x=tt.book_new();tt.book_append_sheet(x,s,"RolesTemplate"),It(x,"UserRoles_Import_Template.xlsx")},re=s=>P.filter(x=>x.user===s),Z=o.filter(s=>{const x=`${s.first_name} ${s.last_name} ${s.middle_name||""}`.toLowerCase(),v=s.user_id.toString(),X=s.email_address.toLowerCase(),Se=ne.toLowerCase(),Te=re(s.user_id),qe=Te.map(ke=>{var fe;return((fe=ke.role_name)==null?void 0:fe.toLowerCase())||""}).join(" "),$e=!ne||v.includes(Se)||x.includes(Se)||X.includes(Se)||qe.includes(Se),le=!H||Te.some(ke=>ke.college_id===H);return $e&&le});t.useEffect(()=>{ue(s=>{const x=new Set;return Z.forEach(v=>{s.has(v.user_id)&&x.add(v.user_id)}),x})},[Z]);const we=Z.length===0?!1:Z.every(s=>J.has(s.user_id)),Re=()=>{Z.length!==0&&ue(s=>{const x=new Set(s);return we?Z.forEach(v=>x.delete(v.user_id)):Z.forEach(v=>x.add(v.user_id)),x})},d=s=>{ue(x=>{const v=new Set(x);return v.has(s)?v.delete(s):v.add(s),v})},_=()=>{K(s=>[...s,{role_id:0,college_id:null,department_id:null,date_start:null,date_ended:null}])},Y=s=>{K(x=>x.filter((v,X)=>X!==s))},ye=(s,x,v)=>{K(X=>X.map((Se,Te)=>Te===s?{...Se,[x]:v}:Se))},Ee=s=>{if(!s)return null;const x=Number(s);if(isNaN(x)&&/^\d{4}-\d{2}-\d{2}$/.test(String(s)))return String(s);if(isNaN(x))return null;const v=new Date(1899,11,30),X=new Date(v.getTime()+x*24*60*60*1e3),Se=X.getFullYear(),Te=String(X.getMonth()+1).padStart(2,"0"),qe=String(X.getDate()).padStart(2,"0");return`${Se}-${Te}-${qe}`};return e.jsxs("div",{className:"colleges-container accounts-container",children:[e.jsxs("div",{className:"colleges-header",children:[e.jsx("h2",{className:"colleges-title",children:"User Management"}),e.jsxs("div",{className:"search-bar",children:[e.jsx("input",{type:"text",placeholder:"Search by ID, name, email, or role...",value:ne,onChange:s=>ce(s.target.value)}),e.jsx("button",{type:"button",className:"search-button",children:e.jsx(Rt,{})})]})]}),e.jsxs("div",{className:"colleges-actions",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("button",{type:"button",className:"action-button add-new",onClick:()=>{k(!1),f(!0),N({user_id:0,first_name:"",last_name:"",middle_name:"",email_address:"",contact_number:"",status:"Active",created_at:new Date().toISOString()}),K([{role_id:0,college_id:null,department_id:null,date_start:null,date_ended:null}])},children:e.jsx(Ct,{})}),e.jsx("button",{type:"button",className:"action-button import",onClick:()=>W(!0),children:e.jsx(Lt,{})}),e.jsx("div",{className:"input-group",style:{marginBottom:0},children:e.jsxs("select",{value:H,onChange:s=>Q(s.target.value),style:{backgroundColor:"white",color:"#333",padding:"8px 15px",fontSize:"0.9rem",borderRadius:"50px",border:"1px solid #ccc"},children:[e.jsx("option",{value:"",children:"All Colleges"}),R.map(s=>e.jsx("option",{value:s.college_id,children:s.college_name},s.college_id))]})})]}),e.jsx("div",{style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:8},children:e.jsx("button",{type:"button",className:"action-button delete",onClick:Ce,disabled:u||J.size===0,title:J.size>0?`Delete ${J.size} selected`:"Delete selected",children:e.jsx(bt,{})})})]}),e.jsx("div",{className:"colleges-table-container",children:e.jsxs("table",{className:"accounts-table colleges-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Full Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Contact"}),e.jsx("th",{children:"Role/s"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{children:"Actions"}),e.jsx("input",{type:"checkbox",checked:we,onChange:Re,disabled:pe||Z.length===0,"aria-label":"Select all accounts",title:"Select all",style:{marginLeft:"auto"}})]})})]})}),e.jsx("tbody",{children:pe?e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{textAlign:"center",padding:"20px"},children:"Loading users..."})}):Z.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,style:{textAlign:"center",padding:"20px"},children:"No users found."})}):Z.map((s,x)=>{const v=re(s.user_id),X=J.has(s.user_id);return e.jsxs("tr",{style:{backgroundColor:X?"#f8d7da":"transparent"},children:[e.jsx("td",{children:x+1}),e.jsx("td",{children:s.user_id}),e.jsxs("td",{children:[s.last_name,", ",s.first_name," ",s.middle_name??""]}),e.jsx("td",{children:s.email_address}),e.jsx("td",{children:s.contact_number}),e.jsx("td",{children:v.length>0?e.jsx("pre",{style:{whiteSpace:"pre-wrap",margin:0,fontSize:"0.85em"},children:v.map(Se=>{const Te=[Se.college_id,Se.department_id].filter(Boolean).join(" / ");return`${Se.role_name}${Te?` - ${Te}`:""}`}).join(`
`)}):"-"}),e.jsx("td",{style:{color:s.status==="Suspended"?"red":"green",fontWeight:"bold"},children:s.status}),e.jsx("td",{children:new Date(s.created_at).toLocaleDateString()}),e.jsxs("td",{className:"action-buttons",style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("button",{type:"button",className:"action-button import",style:{fontSize:"0.85em",padding:"5px 10px"},onClick:()=>{$(s.user_id),M(!0)},children:"View"}),e.jsx("input",{type:"checkbox",checked:J.has(s.user_id),onChange:()=>d(s.user_id),"aria-label":`Select account ${s.user_id}`,style:{marginLeft:"auto"}})]})]},s.user_id)})})]})}),w&&de!==null&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"user-details-modal fixed-modal",children:[e.jsx("h3",{className:"modal-title",children:"User Details"}),(()=>{const s=o.find(x=>x.user_id===de);return s?e.jsxs("div",{className:"account-summary-card horizontal-layout",children:[e.jsxs("div",{className:"account-column",children:[e.jsxs("p",{children:[e.jsx("strong",{className:"account-label",children:"User ID:"})," ",s.user_id]}),e.jsxs("p",{children:[e.jsx("strong",{className:"account-label",children:"Full Name:"})," ",s.last_name,", ",s.first_name," ",s.middle_name||""]}),e.jsxs("p",{children:[e.jsx("strong",{className:"account-label",children:"Email:"})," ",s.email_address]})]}),e.jsxs("div",{className:"account-column",children:[e.jsxs("p",{children:[e.jsx("strong",{className:"account-label",children:"Contact:"})," ",s.contact_number]}),e.jsxs("p",{children:[e.jsx("strong",{className:"account-label",children:"Status:"}),e.jsx("span",{className:`account-status ${s.status==="Suspended"?"suspended":"active"}`,children:s.status})]}),e.jsxs("div",{className:"account-actions",children:[e.jsxs("button",{type:"button",className:"icon-button edit-button",onClick:()=>{N(s),k(!0),f(!0)},title:"Edit Account",children:[e.jsx(ms,{})," Edit Account"]}),e.jsxs("button",{type:"button",className:"icon-button delete-button",onClick:()=>je(s.user_id),title:"Delete Account",children:[e.jsx(bt,{})," Delete Account"]})]})]})]}):null})(),e.jsx("h4",{className:"modal-subtitle",children:"Assigned Roles"}),e.jsxs("table",{className:"accounts-table user-roles-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Role"}),e.jsx("th",{children:"Office"}),e.jsx("th",{children:"Start"}),e.jsx("th",{children:"End"}),e.jsx("th",{children:"Created At"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:P.filter(s=>s.user===de).map(s=>{var x,v;return e.jsxs("tr",{children:[e.jsx("td",{children:s.role_name||"-"}),e.jsx("td",{children:[s.college_name,s.department_name].filter(Boolean).join(" / ")||"-"}),e.jsx("td",{className:"role-date start",children:((x=s.date_start)==null?void 0:x.split("T")[0])||"-"}),e.jsx("td",{className:"role-date end",children:((v=s.date_ended)==null?void 0:v.split("T")[0])||"-"}),e.jsx("td",{children:s.created_at?new Date(s.created_at).toLocaleString("en-US",{month:"2-digit",day:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}):"—"}),e.jsx("td",{children:e.jsx("span",{className:`role-status ${s.status==="Suspended"?"suspended":"active"}`,children:s.status||"Active"})}),e.jsxs("td",{className:"role-actions",children:[e.jsx("button",{className:"icon-button edit-button",onClick:()=>U(s),title:"Edit Role",children:e.jsx(ms,{})}),e.jsx("button",{className:`icon-button ${s.status==="Suspended"?"reactivate-button":"delete-button"}`,onClick:()=>j(s.user_role_id,s.status||"Active"),title:s.status==="Suspended"?"Reactivate Role":"Suspend Role",children:s.status==="Suspended"?e.jsx(la,{}):e.jsx(na,{})}),e.jsx("button",{className:"icon-button delete-button",onClick:()=>h(s.user_role_id),title:"Delete Role",children:e.jsx(bt,{})})]})]},s.user_role_id)})})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"modal-button cancel",onClick:()=>M(!1),children:"Close"}),e.jsx("button",{className:"modal-button save",onClick:()=>{z({user:de}),b(!0)},children:"Add Role"})]})]})}),n&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal",style:{maxWidth:"700px",maxHeight:"90vh",overflowY:"auto"},children:[e.jsx("h4",{style:{textAlign:"center"},children:se?"Edit Account":"Add New Account"}),["user_id","first_name","last_name","middle_name","email_address","contact_number"].map(s=>e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:s,children:s==="user_id"?"USER ID":s.replace("_"," ").toUpperCase()}),e.jsx("input",{id:s,type:"text",value:T[s]??"",onChange:x=>N(v=>{let X;if(s==="user_id"){const Se=x.target.value.trim();X=Se===""?null:Number(Se)}else X=x.target.value;return{...v,[s]:X}}),disabled:se&&s==="user_id"})]},s)),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{htmlFor:"status",children:"STATUS"}),e.jsxs("select",{id:"status",value:T.status,onChange:s=>N(x=>({...x,status:s.target.value})),children:[e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Suspended",children:"Suspended"})]})]}),!se&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{borderTop:"2px solid #ddd",marginTop:"20px",paddingTop:"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"15px"},children:[e.jsx("h4",{style:{margin:0},children:"Roles (Required)"}),e.jsxs("button",{type:"button",className:"action-button add-new",style:{fontSize:"0.85em",padding:"5px 10px"},onClick:_,children:[e.jsx(Ct,{})," Add Role"]})]}),_e.map((s,x)=>e.jsxs("div",{style:{border:"1px solid #ddd",padding:"15px",marginBottom:"15px",borderRadius:"5px",position:"relative"},children:[e.jsx("button",{type:"button",onClick:()=>Y(x),style:{position:"absolute",top:"10px",right:"10px",background:"#d9534f",color:"white",border:"none",borderRadius:"50px",width:"50px",height:"25px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(ys,{})}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Role"}),e.jsxs("select",{value:s.role_id||"",onChange:v=>{const X=Number(v.target.value),Se=G(X);ye(x,"role_id",X),Se.college||ye(x,"college_id",null),Se.department||ye(x,"department_id",null)},children:[e.jsx("option",{value:"",children:"Select Role"}),i.map(v=>e.jsx("option",{value:v.role_id,children:v.role_name},v.role_id))]})]}),G(s.role_id).college&&e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"College"}),e.jsxs("select",{value:s.college_id||"",onChange:v=>ye(x,"college_id",v.target.value||null),children:[e.jsx("option",{value:"",children:"None"}),R.map(v=>e.jsx("option",{value:v.college_id,children:v.college_name},v.college_id))]})]}),G(s.role_id).department&&e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Department"}),e.jsxs("select",{value:s.department_id||"",onChange:v=>ye(x,"department_id",v.target.value||null),children:[e.jsx("option",{value:"",children:"None"}),O.map(v=>e.jsxs("option",{value:v.department_id,children:["(",v.department_id,") ",v.department_name]},v.department_id))]})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Start Date"}),e.jsxs("div",{className:"date-input-wrapper",children:[e.jsx(Bt,{className:"calendar-icon"}),e.jsx("input",{type:"date",value:s.date_start||"",onChange:v=>ye(x,"date_start",v.target.value||null)})]})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"End Date"}),e.jsxs("div",{className:"date-input-wrapper",children:[e.jsx(Bt,{className:"calendar-icon"}),e.jsx("input",{type:"date",value:s.date_ended||"",onChange:v=>ye(x,"date_ended",v.target.value||null)})]})]})]},x))]}),e.jsxs("p",{style:{fontSize:"12px",color:"#666",marginTop:"10px"},children:["Default password will be: ",e.jsxs("strong",{children:[T.last_name,"@",T.user_id]})]})]}),e.jsxs("div",{className:"modal-buttons",children:[e.jsx("button",{type:"button",className:"modal-button save",onClick:I,children:"Save"}),e.jsx("button",{type:"button",className:"modal-button cancel",onClick:()=>f(!1),children:"Cancel"})]})]})}),r&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal",style:{width:600},children:[e.jsx("h3",{children:"Add New Role"}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Role"}),e.jsxs("select",{value:be.role_id??"",onChange:s=>{const x=s.target.value?Number(s.target.value):void 0,v=G(x);z(X=>({...X,role_id:x,role:x,college_id:v.college?X.college_id:void 0,department_id:v.department?X.department_id:void 0}))},children:[e.jsx("option",{value:"",children:"Select Role"}),i.map(s=>e.jsx("option",{value:s.role_id,children:s.role_name},s.role_id))]})]}),G(be.role_id).college&&e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"College"}),e.jsxs("select",{value:be.college_id||"",onChange:s=>z(x=>({...x,college_id:s.target.value||null})),children:[e.jsx("option",{value:"",children:"None"}),R.map(s=>e.jsx("option",{value:s.college_id,children:s.college_name},s.college_id))]})]}),G(be.role_id).department&&e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Department"}),e.jsxs("select",{value:be.department_id||"",onChange:s=>z(x=>({...x,department_id:s.target.value||null})),children:[e.jsx("option",{value:"",children:"None"}),O.map(s=>e.jsxs("option",{value:s.department_id,children:["(",s.department_id,") ",s.department_name]},s.department_id))]})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Start Date"}),e.jsxs("div",{className:"date-input-wrapper",children:[e.jsx(Bt,{className:"calendar-icon"}),e.jsx("input",{type:"date",value:((Ne=be.date_start)==null?void 0:Ne.split("T")[0])||"",onChange:s=>z(x=>({...x,date_start:s.target.value}))})]})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"End Date"}),e.jsxs("div",{className:"date-input-wrapper",children:[e.jsx(Bt,{className:"calendar-icon"}),e.jsx("input",{type:"date",value:((Ue=be.date_ended)==null?void 0:Ue.split("T")[0])||"",onChange:s=>z(x=>({...x,date_ended:s.target.value}))})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"modal-button save",onClick:m,children:"Save"}),e.jsx("button",{className:"modal-button cancel",onClick:()=>b(!1),children:"Cancel"})]})]})}),c&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal",style:{width:600},children:[e.jsx("h3",{children:"Edit Role"}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Role"}),e.jsxs("select",{value:(c==null?void 0:c.role)??"",onChange:s=>{const x=s.target.value?Number(s.target.value):void 0,v=G(x);U(X=>X&&{...X,role:x,role_id:x,college_id:v.college?X.college_id:void 0,department_id:v.department?X.department_id:void 0})},children:[e.jsx("option",{value:"",children:"Select Role"}),i.map(s=>e.jsx("option",{value:s.role_id,children:s.role_name},s.role_id))]})]}),G(c==null?void 0:c.role).college&&e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"College"}),e.jsxs("select",{value:(c==null?void 0:c.college_id)||"",onChange:s=>U(x=>x&&{...x,college_id:s.target.value||null}),children:[e.jsx("option",{value:"",children:"None"}),R.map(s=>e.jsx("option",{value:s.college_id,children:s.college_name},s.college_id))]})]}),G(c==null?void 0:c.role).department&&e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Department"}),e.jsxs("select",{value:(c==null?void 0:c.department_id)||"",onChange:s=>U(x=>x&&{...x,department_id:s.target.value||null}),children:[e.jsx("option",{value:"",children:"None"}),O.map(s=>e.jsx("option",{value:s.department_id,children:s.department_name},s.department_id))]})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Start Date"}),e.jsxs("div",{className:"date-input-wrapper",children:[e.jsx(Bt,{className:"calendar-icon"}),e.jsx("input",{type:"date",value:((et=c.date_start)==null?void 0:et.split("T")[0])||"",onChange:s=>U(x=>x&&{...x,date_start:s.target.value})})]})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"End Date"}),e.jsxs("div",{className:"date-input-wrapper",children:[e.jsx(Bt,{className:"calendar-icon"}),e.jsx("input",{type:"date",value:((Ge=c.date_ended)==null?void 0:Ge.split("T")[0])||"",onChange:s=>U(x=>x&&{...x,date_ended:s.target.value})})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"modal-button save",onClick:me,children:"Save"}),e.jsx("button",{className:"modal-button cancel",onClick:()=>U(null),children:"Cancel"})]})]})}),L&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal",style:{background:"#fff",padding:"25px",borderRadius:"12px",width:"420px",maxWidth:"95%",boxShadow:"0px 4px 20px rgba(0,0,0,0.15)",display:"flex",flexDirection:"column"},children:[e.jsx("h3",{style:{textAlign:"center",marginBottom:"20px",color:"#333"},children:"Import Accounts from Excel"}),e.jsxs("div",{style:{backgroundColor:"#f1f3f5",padding:"15px",borderRadius:"8px",marginTop:"20px",fontSize:"13px",lineHeight:"1.4",color:"#333"},children:[e.jsx("strong",{style:{color:"#000"},children:"Excel Format Requirements:"}),e.jsxs("ul",{style:{marginTop:"10px",paddingLeft:"20px"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"roles:"}),' IDs separated by semicolons (e.g., "1;2;3")']}),e.jsxs("li",{children:[e.jsx("strong",{children:"colleges:"}),' IDs separated by semicolons (e.g., "CITC;CAS")']}),e.jsxs("li",{children:[e.jsx("strong",{children:"departments:"}),' IDs separated by semicolons (e.g., "DIT;DCIT;")']}),e.jsxs("li",{children:[e.jsx("strong",{children:"date_starts/date_endeds:"})," YYYY-MM-DD format, separated by semicolons"]}),e.jsx("li",{children:"Blank colleges/departments allowed, but each role must have at least one"}),e.jsx("li",{children:"All role-related columns must have the same number of values"})]})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("label",{style:{color:"#000",fontWeight:600,display:"block",marginBottom:"6px"},children:"Upload Excel File"}),e.jsx("input",{type:"file",accept:".xlsx,.xls",onChange:A,disabled:te,style:{width:"100%",padding:"8px",borderRadius:"6px",border:"1px solid #ccc",opacity:te?.5:1,cursor:te?"not-allowed":"pointer"}})]}),e.jsxs("p",{style:{fontSize:"12px",color:"#444",marginBottom:"20px"},children:["Default password format: ",e.jsx("strong",{children:"LastName@UserID"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"10px"},children:[e.jsxs("button",{type:"button",className:"modal-button download",onClick:p,style:{background:"#2d6cdf",color:"#fff",padding:"10px 15px",borderRadius:"8px",border:"none",display:"flex",alignItems:"center",gap:"6px",cursor:"pointer",fontWeight:600},children:[e.jsx(Et,{})," Download Template"]}),e.jsx("button",{type:"button",className:"modal-button cancel",onClick:()=>W(!1),style:{background:"#ddd",padding:"10px 15px",borderRadius:"8px",border:"none",cursor:"pointer",fontWeight:600},children:"Close"})]})]})}),q&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal",children:[e.jsx("h4",{style:{textAlign:"center"},children:"Import Roles from Excel"}),e.jsx("div",{style:{backgroundColor:"#f8f9fa",padding:"15px",borderRadius:"5px",marginBottom:"15px",fontSize:"13px"},children:e.jsxs("div",{style:{backgroundColor:"#f1f3f5",padding:"15px",borderRadius:"8px",marginBottom:"-50px",fontSize:"13px",lineHeight:"1.4",color:"#333"},children:[e.jsx("strong",{style:{color:"#000"},children:"Excel Format Requirements:"}),e.jsxs("ul",{style:{marginTop:"1px",paddingLeft:"20px"},children:[e.jsxs("li",{children:[e.jsx("strong",{children:"user:"})," User ID (number)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"role:"})," Role ID (number)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"college:"})," College ID (can be empty if department provided)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"department:"})," Department ID (can be empty if college provided)"]}),e.jsx("li",{children:"Each role must have at least one: college OR department (or both)"})]})]})}),e.jsxs("div",{className:"input-group",children:[e.jsx("label",{children:"Upload Excel File"}),e.jsx("input",{type:"file",accept:".xlsx, .xls",onChange:he,disabled:te,style:{opacity:te?.5:1,cursor:te?"not-allowed":"pointer"}})]}),e.jsxs("div",{className:"modal-buttons",children:[e.jsxs("button",{type:"button",className:"modal-button download",onClick:B,children:[e.jsx(Et,{})," Download Template"]}),e.jsx("button",{type:"button",className:"modal-button cancel",onClick:()=>E(!1),children:"Close"})]})]})}),e.jsx(ft,{position:"top-right",autoClose:3e3}),te&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:9999},children:e.jsxs("div",{style:{backgroundColor:"white",padding:"30px",borderRadius:"10px",textAlign:"center"},children:[e.jsx("div",{style:{border:"4px solid #f3f3f3",borderTop:"4px solid #3498db",borderRadius:"50%",width:"50px",height:"50px",animation:"spin 1s linear infinite",margin:"0 auto 20px"}}),e.jsx("p",{style:{margin:0,fontSize:"16px",fontWeight:600},children:"Importing data..."}),e.jsx("p",{style:{margin:"10px 0 0",fontSize:"14px",color:"#666"},children:"Please wait, this may take a moment."})]})})]})},Nt={className:"icon",size:25},eo=[{key:"dashboard",label:"Dashboard",icon:e.jsx(Ss,{...Nt})},{key:"colleges",label:"Colleges",icon:e.jsx(ra,{...Nt})},{key:"departments",label:"Departments",icon:e.jsx(os,{...Nt})},{key:"programs",label:"Programs",icon:e.jsx(ia,{...Nt})},{key:"courses",label:"Courses",icon:e.jsx(ca,{...Nt})},{key:"section-courses",label:"Section Courses",icon:e.jsx(da,{...Nt})},{key:"terms",label:"Terms",icon:e.jsx(Bt,{...Nt})},{key:"buildings",label:"Buildings",icon:e.jsx(ua,{...Nt})},{key:"rooms",label:"Rooms",icon:e.jsx(ma,{...Nt})},{key:"exam-period",label:"Exam Period",icon:e.jsx(ha,{...Nt})},{key:"set-Modality",label:"Set Modality",icon:e.jsx(es,{...Nt})},{key:"User Management",label:"User Management",icon:e.jsx(as,{...Nt})},{key:"profile",label:"Profile",icon:e.jsx(vs,{...Nt})}],to=()=>{const[o,l]=t.useState(null),[i,F]=t.useState("dashboard"),[R,C]=t.useState(!1),[O,ee]=t.useState(new Date),[P,ie]=t.useState(!1),ne=Ot();t.useEffect(()=>{(async()=>{const M=JSON.parse(localStorage.getItem("user")||"null")||JSON.parse(sessionStorage.getItem("user")||"null");if(!M)return ne("/admin-login");try{const f=(await g.get(`/users/${M.user_id}/`)).data;l({...f,full_name:`${f.first_name} ${f.middle_name??""} ${f.last_name}`.trim(),avatar_url:f.avatar_url||"../../static/Images/default-pp.jpg"})}catch(n){console.error(n),l({...M,full_name:`${M.first_name} ${M.middle_name??""} ${M.last_name}`.trim(),avatar_url:M.avatar_url||"../../static/Images/default-pp.jpg"})}})()},[ne]),t.useEffect(()=>{const w=setInterval(()=>ee(new Date),1e3);return()=>clearInterval(w)},[]);const ce=()=>{localStorage.removeItem("user"),sessionStorage.removeItem("user"),ne("/")},H=O.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0}),[Q,pe,D]=H.split(/:| /),te=O.toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"});if(!o)return e.jsx("div",{style:{color:"black"},children:"Please Wait..."});const ge=()=>{switch(i){case"colleges":return e.jsx(qa,{});case"departments":return e.jsx(Ha,{});case"programs":return e.jsx(Wa,{user:o});case"courses":return e.jsx(Ga,{});case"section-courses":return e.jsx(Va,{});case"terms":return e.jsx(Ja,{});case"buildings":return e.jsx(Ka,{});case"rooms":return e.jsx(Za,{});case"exam-period":return e.jsx(Xa,{});case"User Management":return e.jsx(Qa,{user:o});case"set-Modality":return e.jsx(Cs,{user:o});case"profile":return e.jsx(Ns,{user:o});case"dashboard":default:return e.jsx("div",{className:"dashboard-grid",children:i==="dashboard"&&e.jsxs("div",{className:"dashboard-grid",children:[e.jsxs("div",{className:"card welcome-card",children:[e.jsxs("h3",{children:["Welcome, ",e.jsxs("span",{className:"robert-name",children:[o.first_name,"!"]})]}),e.jsx("p",{children:"Organize your work and improve your performance here"})]}),e.jsxs("div",{className:"card datetime-card",children:[e.jsx("div",{className:"date-display-simple",children:te}),e.jsxs("div",{className:"time-display",children:[e.jsxs("span",{children:[Q,":"]}),e.jsx("span",{children:pe}),e.jsx("span",{className:"ampm",children:D})]})]}),e.jsxs("div",{className:"card faculty-info-card",children:[e.jsx("img",{src:o.avatar_url,alt:"Avatar",className:"faculty-avatar"}),e.jsx("h4",{children:o.full_name}),e.jsx("p",{children:"Admin"})]}),e.jsxs("div",{className:"full-width-section",children:[e.jsx("h2",{children:"Shortcut"}),e.jsxs("div",{className:"try-things-grid",children:[e.jsx("div",{className:"try-thing-card",children:e.jsx(ls,{})}),e.jsx("div",{className:"try-thing-card",children:e.jsx(ns,{})})]})]})]})})}};return e.jsx("div",{className:"app-container",children:e.jsxs("div",{className:"main-content-wrapper",children:[e.jsxs("aside",{className:`sidebar ${R?"open":"closed"}`,onMouseEnter:()=>C(!0),onMouseLeave:()=>C(!1),children:[e.jsxs("div",{className:"sidebar-header",children:[e.jsx("img",{src:"../../static/logo/Exam.png",alt:"Logo",className:"logo-img"}),R&&e.jsx("span",{className:"logo-text",children:"ExamSync"})]}),e.jsx("nav",{className:"sidebar-nav",children:e.jsxs("ul",{children:[eo.map(({key:w,label:M,icon:n})=>e.jsx("li",{className:i===w?"active":"",children:e.jsxs("button",{type:"button",onClick:()=>F(w),children:[n," ",R&&e.jsx("span",{children:M})]})},w)),e.jsx("li",{children:e.jsxs("button",{type:"button",onClick:()=>ie(!0),children:[e.jsx(ws,{})," ",R&&e.jsx("span",{children:"Logout"})]})})]})}),P&&e.jsx("div",{className:"myModal-overlay",children:e.jsxs("div",{className:"myModal-box",children:[e.jsx("h3",{children:"Are you sure you want to logout?"}),e.jsxs("div",{className:"myModal-actions",children:[e.jsx("button",{type:"button",className:"myModal-btn myModal-btn-confirm",onClick:ce,children:"Logout"}),e.jsx("button",{type:"button",className:"myModal-btn myModal-btn-cancel",onClick:()=>ie(!1),children:"Cancel"})]})]})})]}),e.jsxs("main",{className:`main-content ${R?"sidebar-open":"sidebar-closed"}`,children:[e.jsx("div",{className:"content-header",children:e.jsx("h1",{children:i.charAt(0).toUpperCase()+i.slice(1).replace(/-/g," ")})}),ge()]})]})})},so=()=>{const[o,l]=t.useState(""),[i,F]=t.useState(""),[R,C]=t.useState(!1),[O,ee]=t.useState(!1),[P,ie]=t.useState(!1),[ne]=pa(),ce=Ot(),H=ne.get("uid"),Q=ne.get("token"),pe=async D=>{if(D.preventDefault(),!H||!Q){a.error("Invalid or expired reset link.");return}if(o!==i){a.error("Passwords do not match.");return}if(o.length<6){a.error("Password must be at least 6 characters.");return}ie(!0);try{(await g.post("auth/confirm-password-change/",{uid:H,token:Q,new_password:o})).status===200?(a.success("Password reset successful!"),setTimeout(()=>ce("/admin-login"),2e3)):a.error("Failed to reset password.")}catch(te){console.error("Password reset error:",te.message),a.error("Invalid or expired link. Please request a new reset email.")}finally{ie(!1)}};return e.jsxs("div",{className:"reset-password-page",children:[e.jsx("div",{className:"reset-password-overlay"}),e.jsxs("div",{className:"reset-password-container",children:[e.jsx("h2",{children:"Reset Your Password"}),e.jsxs("form",{className:"reset-password-form",onSubmit:pe,children:[e.jsx("label",{children:"New Password"}),e.jsxs("div",{className:"password-input-wrapper",children:[e.jsx("input",{type:R?"text":"password",required:!0,value:o,onChange:D=>l(D.target.value),disabled:P,placeholder:"Enter new password"}),e.jsx("span",{onClick:()=>C(!R),className:"toggle-password-visibility",children:R?e.jsx(Qt,{}):e.jsx(Ut,{})})]}),e.jsx("label",{children:"Confirm Password"}),e.jsxs("div",{className:"password-input-wrapper",children:[e.jsx("input",{type:O?"text":"password",required:!0,value:i,onChange:D=>F(D.target.value),disabled:P,placeholder:"Confirm new password"}),e.jsx("span",{onClick:()=>ee(!O),className:"toggle-password-visibility",children:O?e.jsx(Qt,{}):e.jsx(Ut,{})})]}),e.jsx("button",{type:"submit",className:"btn",disabled:P,children:P?"Resetting...":"Reset Password"})]}),e.jsx(ft,{position:"top-center",autoClose:3e3})]})]})};function ao(){return e.jsxs(ga,{children:[e.jsx(Gt,{path:"/",element:e.jsx(Sa,{})}),e.jsx(Gt,{path:"/admin-login",element:e.jsx(wa,{})}),e.jsx(Gt,{path:"/reset-password",element:e.jsx(so,{})}),e.jsx(Gt,{path:"/faculty-dashboard",element:e.jsx(Ya,{})}),e.jsx(Gt,{path:"/admin-dashboard",element:e.jsx(to,{})})]})}xa.createRoot(document.getElementById("root")).render(e.jsx(fa.StrictMode,{children:e.jsx(_a,{children:e.jsx(ao,{})})}));
